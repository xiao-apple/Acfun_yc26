<%@ page contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
<base href="/acfun/">
<meta charset=UTF-8">
<title>文章投稿</title>
<link rel="stylesheet" href="css/core.css">

<link rel="stylesheet" href="css/font-awesome.css">

<link rel="stylesheet" href="css/style.css">

<link rel="stylesheet" media="screen and (min-width: 1440px)"
	href="css/wide.css">
<link rel="stylesheet" href="css/member.css">
<link id="style-theme-member" rel="stylesheet" href="css/theme.css">
<link rel="stylesheet" href="css/umeditor.css" id="style-require-editor">
<script type="text/javascript" src="ueditor/ueditor.config.js"></script>
<script type="text/javascript" src="ueditor/ueditor.all.min.js"></script>
</head>
<body spellcheck="false">
	<div id="stage">
		<div style="display: none;" id="area-info"></div>
		<div id="area-window">
			<div id="win-info" class="win">
				<div class="mainer"></div>
			</div>
			<div style="opacity: 0; display: none; left: 881.5px; top: 141px;"
				id="win-hint" class="win win-hint info">
				<div class="mainer">
					请填写文章标题。标题中不得包含令人反感的信息，且长度应在5到50个字符之间。<br>请优先使用简体中文作为标题，尽量避免使用日文假名或英文字母
				</div>
				<div class="tail top"></div>
			</div>
		</div>
		<div id="guide-space" class="simple"></div>
		<div id="guide" class="simple float">
			<div id="guide-top-bar">
				<a id="guide-fix" target="_blank"></a>
				<div class="inner">
					<a id="guide-logo" href="http://www.acfun.cn/" title="天下漫友是一家"></a>
					<div id="area-user-guide">
						<a id="a-app-guide" href="http://www.acfun.cn/app/"
							target="_blank" class="tool"><i class="icon icon-app-phone"></i>
							<p class="app-text">客户端</p>
							<div class="app-show">
								<img alt="" src="img/app-code.png" class="app-code">
								<p class="app-tip">扫描下载最新版客户端</p>
								<img alt="" src="img/app-word.png" class="app-word" height="19"
									width="141">
								<div class="tail"></div>
							</div></a><a id="a-login-guide" href="page/login.jsp" target="_blank"
							class="tool hidden"><i class="icon icon-user"></i>
							<p>登录/注册</p></a><a id="a-avatar-guide" href="page/profile.jsp"
							target="_blank" class="thumb"><img src="" class="avatar">
							<p class="info-hint">5</p></a><a id="a-history-guide"
							href="page/history.jsp" target="_blank" class="tool"><i
							class="icon icon-history"></i>
							<p>看过</p></a><a id="a-post-guide" href="page/upload-video.jsp"
							target="_blank" class="tool"><i class="icon icon-upload"></i>
							<p>投稿</p></a><a id="a-favor-guide" href="page/favourite.jsp"
							target="_blank" class="tool"><i class="icon icon-folder-open"></i>
							<p>收藏</p></a><span class="clearfix"></span>
					</div>
					<div style="opacity: 1; top: 46px;" id="win-info-guide" class="win hidden">
						<div class="mainer">
							<div class="a">
								<div class="l">
									<a id="a-name-guide" href="page/splash.jsp"
										target="_blank" title="前往我的个人中心" ></a>
								</div>
								<div class="r">
									<a id="a-logout-guide"
										href="login.jsp"
										title="退出登录"><i class="icon icon-power-off"></i>退出登录</a>
								</div>
								<span class="clearfix"></span>
							</div>
							<div class="b">
								<p class="alert">
									<i class="icon icon-info-circle"></i>暂未有任何推送或未读信息。
								</p>
							</div>
							<div class="c">
								<a href="page/mail.jsp" target="_blank">查看更多</a>
							</div>
							<div class="tail"></div>
						</div>
					</div>
					<div id="win-history-guide" class="win hidden">
						<div class="mainer">
							<div class="b"></div>
							<div class="c">
								<a href="page/history.jsp" target="_blank">查看更多</a>
							</div>
							<div class="tail"></div>
						</div>
					</div>
					<div id="win-post-guide" class="win hidden">
						<div class="mainer">
							<div class="b">
								<a href="page/upload-video.jsp" target="_blank">投视频</a><a
									href="page/post-article.jsp" target="_blank">投文章</a>
							</div>
							<div class="tail"></div>
						</div>
					</div>
				</div>
			</div>
			<div id="guide-middle">
				<div id="guide-winhint" class="win win-hint left">
					<div class="mainer"></div>
					<div class="arrow"></div>
				</div>
				<div id="guide-inner"></div>
			</div>
			<div id="guide-bar">
				<div class="inner">
					<div class="l">
						<a href="http://www.acfun.cn/" title="天下漫友是一家" class="first only">首页</a><a
							href="http://www.acfun.cn/v/list144/index.htm" class="only">番剧</a><a
							href="http://www.acfun.cn/v/list1/index.htm" data-channel="anime">动画</a><a
							href="http://www.acfun.cn/v/list58/index.htm"
							data-channel="music">音乐</a><a
							href="http://www.acfun.cn/v/list123/index.htm"
							data-channel="dance">舞蹈</a><a class=""
							href="http://www.acfun.cn/v/list59/index.htm" data-channel="game">游戏</a><a
							href="http://www.acfun.cn/v/list60/index.htm" data-channel="joy">娱乐</a><a
							href="http://www.acfun.cn/v/list70/index.htm" data-channel="tech">科技</a><a
							href="http://www.acfun.cn/v/list68/index.htm" data-channel="film">影视</a><a
							href="http://www.acfun.cn/v/list69/index.htm"
							data-channel="sport">体育</a><a
							href="http://www.acfun.cn/v/list124/index.htm"
							data-channel="lsgirl">彼♀女</a><a class=""
							href="http://www.acfun.cn/v/list125/index.htm"
							data-channel="fishpond">鱼♂塘</a><a
							href="http://www.acfun.cn/v/list110/index.htm"
							data-channel="article">文章</a><a href="http://www.acfun.cn/rank/"
							target="_blank" data-channel="extra" class="last">更多</a><span
							class="clearfix"></span>
					</div>
					<div class="r">
						<form id="area-search-guide" target="_blank" method="get"
							action="/search/">
							<input name="query" placeholder="请输入搜索词" autocomplete="off"
								x-webkit-speech="" class="ipt-search" type="text"><i
								class="icon icon-search"></i><input value="搜 索" title="搜索"
								class="btn-search" type="submit"><span class="clearfix"></span>
							<ul class="menu menu-search"></ul>
						</form>
					</div>
					<span class="clearfix"></span>
				</div>
			</div>
			<div class="" id="sub-guide">
				<div id="sub-guide-inner">
					<div class="unit channel-anime hidden c1 sc2 wc1 swc1">
						<a href="http://www.acfun.cn/v/list106/index.htm">动画短片</a><a
							href="http://www.acfun.cn/v/list107/index.htm">MAD·AMV</a><a
							href="http://www.acfun.cn/v/list108/index.htm">MMD·3D</a><a
							href="http://www.acfun.cn/v/list133/index.htm">2.5次元</a><a
							href="http://www.acfun.cn/v/list67/index.htm">新番连载</a><a
							href="http://www.acfun.cn/v/list120/index.htm">国产动画</a><a
							href="http://www.acfun.cn/v/list109/index.htm">旧番补档</a><a
							href="http://www.acfun.cn/v/list159/index.htm">动画资讯</a><span
							class="clearfix"></span>
					</div>
					<div class="unit channel-music hidden c2 sc2 wc1 swc1">
						<a href="http://www.acfun.cn/v/list136/index.htm">原创·翻唱</a><a
							href="http://www.acfun.cn/v/list137/index.htm">演奏</a><a
							href="http://www.acfun.cn/v/list103/index.htm">Vocaloid</a><a
							href="http://www.acfun.cn/v/list138/index.htm">日系音乐</a><a
							href="http://www.acfun.cn/v/list139/index.htm">综合音乐</a><a
							href="http://www.acfun.cn/v/list140/index.htm">演唱会</a><span
							class="clearfix"></span>
					</div>
					<div class="unit channel-dance hidden c2 sc2 wc2 swc2">
						<a href="http://www.acfun.cn/v/list134/index.htm">宅舞</a><a
							href="http://www.acfun.cn/v/list135/index.htm">综合舞蹈</a><span
							class="clearfix"></span>
					</div>
					<div style="opacity: 1; left: 147.4px;"
						class="unit channel-game c2 sc2 wc2 swc2 active">
						<a href="http://www.acfun.cn/v/list83/index.htm">游戏集锦</a><a
							href="http://www.acfun.cn/v/list145/index.htm">电子竞技</a><a
							href="http://www.acfun.cn/v/list84/index.htm">主机单机</a><a
							href="http://www.acfun.cn/v/list85/index.htm">英雄联盟</a><a
							href="http://www.acfun.cn/v/list170/index.htm">守望先锋</a><a
							href="http://www.acfun.cn/v/list165/index.htm">桌游卡牌</a><a
							href="http://www.acfun.cn/v/list72/index.htm">Mugen</a><a
							href="http://www.acfun.cn/v/list175/index.htm">游戏直播</a><span
							class="clearfix"></span>
					</div>
					<div class="unit channel-joy hidden c2 sc2 wc2 swc2">
						<a href="http://www.acfun.cn/v/list86/index.htm">生活娱乐</a><a
							href="http://www.acfun.cn/v/list87/index.htm">鬼畜调教</a><a
							href="http://www.acfun.cn/v/list88/index.htm">萌宠</a><a
							href="http://www.acfun.cn/v/list89/index.htm">美食</a><a
							href="http://www.acfun.cn/v/list98/index.htm">综艺</a><a
							href="http://www.acfun.cn/v/list174/index.htm">娱乐直播</a><span
							class="clearfix"></span>
					</div>
					<div class="unit channel-tech hidden c2 sc2 wc2 swc2">
						<a href="http://www.acfun.cn/v/list147/index.htm">SF</a><a
							href="http://www.acfun.cn/v/list148/index.htm">黑科技</a><a
							href="http://www.acfun.cn/v/list91/index.htm">数码</a><a
							href="http://www.acfun.cn/v/list149/index.htm">广告</a><a
							href="http://www.acfun.cn/v/list150/index.htm">白科技</a><a
							href="http://www.acfun.cn/v/list151/index.htm">自我发电</a><a
							href="http://www.acfun.cn/v/list90/index.htm">科学技术</a><a
							href="http://www.acfun.cn/v/list122/index.htm">汽车</a><span
							class="clearfix"></span>
					</div>
					<div class="unit channel-sport hidden c3 sc3 wc3 swc2">
						<a href="http://www.acfun.cn/v/list152/index.htm">综合体育</a><a
							href="http://www.acfun.cn/v/list94/index.htm">足球</a><a
							href="http://www.acfun.cn/v/list95/index.htm">篮球</a><a
							href="http://www.acfun.cn/v/list153/index.htm">搏击</a><a
							href="http://www.acfun.cn/v/list154/index.htm">11区体育</a><a
							href="http://www.acfun.cn/v/list93/index.htm">惊奇体育</a><span
							class="clearfix"></span>
					</div>
					<div class="unit channel-lsgirl hidden c3 sc3 wc3 swc2">
						<a href="http://www.acfun.cn/v/list127/index.htm">造型</a><a
							href="http://www.acfun.cn/v/list128/index.htm">西皮</a><a
							href="http://www.acfun.cn/v/list129/index.htm">爱豆</a><a
							href="http://www.acfun.cn/v/list130/index.htm">其他</a><span
							class="clearfix"></span>
					</div>
					<div style="opacity: 1; left: 471.4px;"
						class="unit channel-fishpond c3 sc3 wc3 swc2 hidden">
						<a href="http://www.acfun.cn/v/list92/index.htm">军事</a><a
							href="http://www.acfun.cn/v/list131/index.htm">历史</a><a
							href="http://www.acfun.cn/v/list132/index.htm">焦点</a><span
							class="clearfix"></span>
					</div>
					<div class="unit channel-film hidden c3 sc3 wc2 swc2">
						<a href="http://www.acfun.cn/v/list96/index.htm">电影</a><a
							href="http://www.acfun.cn/v/list162/index.htm">日剧</a><a
							href="http://www.acfun.cn/v/list163/index.htm">美剧</a><a
							href="http://www.acfun.cn/v/list141/index.htm">国产剧</a><a
							href="http://www.acfun.cn/v/list121/index.htm">网络剧</a><a
							href="http://www.acfun.cn/v/list142/index.htm">韩剧</a><a
							href="http://www.acfun.cn/v/list99/index.htm">布袋·特摄</a><a
							href="http://www.acfun.cn/v/list100/index.htm">纪录片</a><a
							href="http://www.acfun.cn/v/list143/index.htm">其他</a><span
							class="clearfix"></span>
					</div>
					<div class="unit channel-article hidden c3 sc3 wc3 swc3">
						<a href="http://www.acfun.cn/v/list110/index.htm">文章综合</a><a
							href="http://www.acfun.cn/v/list73/index.htm">工作·情感</a><a
							href="http://www.acfun.cn/v/list74/index.htm">动漫文化</a><a
							href="http://www.acfun.cn/v/list75/index.htm">漫画·小说</a><a
							href="http://www.acfun.cn/v/list164/index.htm">游戏</a><span
							class="clearfix"></span>
					</div>
					<div class="unit channel-album hidden c3 sc3 wc3 swc3">
						<a href="http://www.acfun.cn/a/aa5003806">AcFun专题-视频</a><a
							href="http://www.acfun.cn/a/aa5003830">AcFun专题-文章</a><span
							class="clearfix"></span>
					</div>
					<div class="unit channel-extra hidden c3 sc3 wc3 swc3">
						<a href="http://www.acfun.cn/rank/" target="_blank">排行榜</a><a
							href="https://www.douyu.com/" target="_blank">斗鱼直播</a><a
							href="http://www.acfun.cn/map/" target="_blank">地图</a><a
							href="http://h.nimingban.com/" target="_blank">匿名版</a><span
							class="clearfix"></span>
					</div>
				</div>
			</div>
		</div>
		<div id="block-notice-guide" class="hidden">
			<div class="temp hidden">
				<div class="item">
					[text]<span title="不再提示" data-time="[time]" class="close"><i
						class="icon icon-times-circle-o"></i></span>
				</div>
			</div>
			<div class="inner"></div>
		</div>
		<div id="header">
			<div id="header-inner" class="inner">
				<a id="logo-home-member" href="http://www.acfun.cn/" title="认真你就输了"></a>
				<div id="block-message-header" class="block hidden">
					<div class="mainer"></div>
					<xmp id="temp-user-active" class="hidden">&lt;p
					style="word-break: break-all;"
					class="alert"&gt;[t]&lt;/p&gt;&lt;div class="l"&gt;&lt;a
					href="/activation.aspx?id=[uid]" target="_blank" class="btn
					success"&gt;&lt;i class="icon
					icon-check-circle-o"&gt;&lt;/i&gt;验证邮箱&lt;/a&gt;&lt;/div&gt;&lt;div
					class="r"&gt;&lt;a class="btn info"&gt;&lt;i class="icon
					icon-times-circle-o"&gt;&lt;/i&gt;关闭提示&lt;/a&gt;&lt;/div&gt;&lt;span
					class="clearfix"&gt;&lt;/span&gt;</xmp>
				</div>
			</div>
			<div style="left: 1180.5px;" id="btn-top-shortcut" class="">
				<a id="feedback"
					href="http://www.acfun.cn/feedback/#from=http://www.acfun.cn/member/"
					target="_blank" class="item feedback"><i
					class="icon icon-paper-plane"></i>
					<p class="hint">意见反馈</p></a>
				<div id="to-top" class="item top">
					<i class="icon icon-chevron-up"></i>
					<p class="hint">返回顶部</p>
				</div>
			</div>
		</div>
		<div style="min-height: 943px;" id="mainer">
			<div id="mainer-inner">
				<div id="block-main">
					<div id="area-main-left" class="l">
						<div id="block-user-left" data-active="active">
							<a href="page/profile.jsp" class="thumb"><img
								src="img/avatar.jpg" class="avatar"><span class="cover"><i
									class="icon icon-user"></i>编辑资料</span></a>
							<div class="d">
								<a href="http://www.acfun.cn/u/8150118.aspx" target="_blank"
									class="name"></a>
							</div>
							<div data-group="1" class="group">
								<a href="http://www.acfun.cn/info/#page=limit" target="_blank">正式会员</a>
							</div>

							<p title="点击以修改签名" class="desc">
								这个人很懒，什么都没有写…<i class="icon icon-edit"></i>
							</p>
							<div class="area-extra">
								
							</div>
						</div>
						<div style="height: 572px;" id="shadow-guide-left" class="hidden"></div>
						<div class="" id="list-guide-left">
							<div class="part-guide-left">
								<div class="banner">
									<a href="page/splash.jsp" class="tab fixed"><i
										class="icon icon-home"></i>欢迎</a>
								</div>
								<div class="mainer hidden">
									<a href="page/splash.jsp" class="tab"><i class="icon"></i>欢迎</a>
								</div>
							</div>
							<div class="part-guide-left">
								<div class="banner">
									<a href="page/favourite.jsp" class="tab fixed"><i
										class="icon icon-folder-open"></i>收藏夹</a><span
										id="hint-favourite-left" class="hidden">0</span>
								</div>
								<div class="mainer hidden">
									<a href="page/favourite.jsp" class="tab"><i class="icon"></i>稿件收藏<span
										class="hint hidden hint-favourite-left">(0)</span></a>
								</div>
							</div>
							<div class="part-guide-left">
								<div class="banner">
									<a href="page/history.jsp" class="tab fixed"><i
										class="icon icon-history"></i>历史</a>
								</div>
								<div class="mainer hidden">
									<a href="page/history.jsp" class="tab"><i class="icon"></i>历史</a>
								</div>
							</div>
							<div class="part-guide-left">
								<div class="banner">
									<a href="page/mail.jsp" class="tab fixed"><i
										class="icon icon-envelope-square"></i>私信</a><span
										id="hint-mail-left" class="hidden">0</span>
								</div>
								<div class="mainer hidden">
									<a href="page/mail.jsp" class="tab"><i class="icon"></i>私信<span
										class="hint hidden hint-mail-left">(0)</span></a>
								</div>
							</div>
							<div class="part-guide-left active">
								<div class="banner">
									<p id="fold" class="tab fixed">
										<i class="icon icon-upload"></i>投稿·管理
									</p>
								</div>
								<div id="list" class="mainer hidden">
									<a href="page/upload-video.jsp" class="tab"><i class="icon"></i>视频投稿</a><a
										href="page/post-article.jsp" class="tab"><i class="icon"></i>文章投稿</a><a
										href="page/post-history.jsp" class="tab"><i class="icon"></i>过往投稿</a>
								</div>
							</div>

							<div class="part-guide-left">
								<div class="banner">
									<a href="page/push.jsp" class="tab fixed"><i
										class="icon icon-at"></i>圈子</a><span id="hint-relation-left"
										class="hidden">0</span>
								</div>
								<div class="mainer hidden">
									<a href="page/push.jsp" class="tab"><i class="icon"></i>内容推送<span
										class="hint hidden hint-push-left">(0)</span></a><a
										href="page/mention.jsp" class="tab"><i class="icon"></i>提到我的<span
										class="hint hidden hint-mention-left">(0)</span></a><a
										href="page/following.jsp" class="tab"><i class="icon"></i>我关注的<span
										class="hint hidden hint-following-left">(0)</span></a><a
										href="page/followers.jsp" class="tab"><i class="icon"></i>关注我的<span
										class="hint hidden hint-followers-left">(0)</span></a>
								</div>
							</div>

						</div>
					</div>
					<div id="area-main-right" class="r">
						<div id="area-cont-right">
							<style id="style-post-article">
#block-first .mainer {
	width: 700px;
	*width: 684px;
	margin: 0
}

#block-first .unit .l {
	width: 80px;
	text-align: right
}

#block-first .unit .r {
	width: 590px;
}

#block-first .unit .r textarea, #block-first .unit .r input {
	width: 320px
}

#block-first .unit .r .hint {
	color: #999;
	font-size: 12px;
	margin: 8px 0
}

#block-first .divider {
	height: 1px;
	border: none;
	border-top: 1px dashed #ddd;
	margin: 8px auto
}

#btn-parter-post {
	margin: 4px 0
}

#hint-parter-post {
	color: #666
}

#editor-cont-post {
	margin: 4px 0
}

#btn-preview-post {
	display: inline-block;
	*display: inline;
	float: none;
	margin: 0
}

#img-preview-post {
	padding: 0;
	margin: 4px 8px 16px 0;
	background-color: #fff;
	border: 1px solid #fff;
	border-radius: 2px;
	box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
	display: block;
	cursor: pointer;
	width: 122px;
	height: 69.5px;
	float: right
}

#ipt-desc-post {
	height: 80px
}

select option[disabled] {
	background-color: #798;
	color: #fff
}

.hint-hover {
	color: #999;
	margin: 0 0 0 8px;
	cursor: default
}

.hint-hover-block {
	display: inline-block;
	*display: inline;
	margin: 8px auto 8px
}

.edui-container {
	z-index: 1 !important
}

@media screen and (min-width:1440px) {
	#block-first .mainer {
		width: 920px;
		margin: auto
	}
	#block-first .unit .r {
		width: 810px;
	}
	#block-first .unit .r input, #block-first .unit .r textarea {
		width: 540px
	}
	#img-preview-post {
		width: 130px;
		height: 74px
	}
}
</style>
							<div id="block-title-banner">
								<p>文章投稿</p>
								<div>
									<a href="http://www.acfun.cn/member/">AcFun</a><span class="d">Article
										Post</span>
								</div>
								<span class="clearfix"></span>
							</div>
							<div id="block-banner-right" class="block banner">
								<a href="page/upload-video.jsp" class="tab"><i class="icon"></i>视频投稿</a><a
									href="page/post-article.jsp" class="tab active"><i
									class="icon"></i>文章投稿</a><a href="page/post-history.jsp"
									class="tab"><i class="icon"></i>过往投稿</a>
							</div>
							<div id="block-first" class="block">
								<div class="mainer form">
									<div class="unit">
										<div class="l">
											<p class="subtitle">标题</p>
										</div>
										<div class="r">
											<input required="required" placeholder="请输入文章标题"
												id="ipt-titles-post" data-name="文章标题" class="title" value="">
										</div>
										<span class="clearfix"></span>
									</div>
									<p class="divider"></p>
									<div class="unit">
										<div class="l">
											<p class="subtitle">简介</p>
										</div>
										<div class="r">
											<textarea required="required" placeholder="请输入文章简介"
												id="ipt-desc-post" data-name="文章简介"></textarea>
											<p class="hint">请填写文章简介。简介中不得包含令人反感的信息，且长度应在10到255个字符之间。</p>
										</div>
										<span class="clearfix"></span>
									</div>
									<p class="divider"></p>
									<div class="unit">
										<div class="l">
											<p class="subtitle">标签</p>
										</div>
										<div class="r">
											<input id="ipt-tags-post" data-name="文章标签" class="tag"
												placeholder="请输入标签，多个标签以&&隔开" required="required"><span
												class="hint-hover" value=""><i
												class="icon icon-question-circle"></i>详细</span>
										</div>
										<span class="clearfix"></span>
									</div>

									<p class="divider"></p>
									<div class="unit">
										<div class="l">
											<p class="subtitle">频道</p>
										</div>
										<div class="r">
											<select id="ipt-channel-post"><option value="63"
													disabled="disabled">文章</option>
										</div>
										<span class="clearfix"></span>
									</div>
									<p class="divider"></p>
									<div class="unit">
										<div class="l">
											<p class="subtitle">封面图片</p>
										</div>
										<div class="r">
											<input id="upload" name="file" accept="image/*" type="file"
												style="display: none" /> <img src="img/cover-day.png"
												id="img-preview-post">
											<button id="btn-preview-post" class="btn primary">
												<i class="icon icon-picture-o"></i>上传本地图片
											</button>
											<p class="hint">
												请选择您的文章封面图片。封面图片不得包含令人反感的信息，尺寸为480*270像素。<br>请勿使用与内容无关，或分辨率不为16:9的图片作为封面图片。
											</p>
										</div>
										<span class="clearfix"></span>
									</div>
									<p class="divider"></p>
									<div class="unit">
										<div class="l">
											<p class="subtitle">正文</p>
										</div>
										<div class="r">
											<div style="width: 100%; z-index: 1;" class="edui-container">

												<textarea id="container" name="container"
													style="height: 280px; margin: 0 auto;"></textarea>
												<script id="text" type="text/javascript">
													UE.getEditor('container');
												</script>
												<div class="edui-dialog-container"></div>


											</div>
											<p class="hint">请填写文章正文。正文不得包含令人反感的信息，且长度应在10到65535个字符之间。</p>
										</div>
										<span class="clearfix"></span>
									</div>
									<div class="unit">
										<p class="alert alert-success">确认文章信息无误后，点击下方左侧“提交投稿”按钮提交投稿。</p>
									</div>
									<p class="divider"></p>
									<div class="unit-tool">
										<div class="l">
											<a class="btn success do"><i
												class="icon icon-check-circle-o"></i>提交投稿</a>
										</div>
										<div class="r">
											<a
												href="http://www.acfun.cn/feedback/#from=/member/index.aspx"
												target="_blank" class="btn info"><i
												class="icon icon-arrow-circle-right"></i>意见反馈</a>
										</div>
										<span class="clearfix"></span>
									</div>
								</div>
							</div>

							<script>(function(exports,undefined){"use strict";var modules={};function require(ids,callback){var module,defs=[];for(var i=0;i<ids.length;++i){module=modules[ids[i]]||resolve(ids[i]);if(!module){throw'module definition dependecy not found: '+ids[i];}defs.push(module)}callback.apply(null,defs)}function define(id,dependencies,definition){if(typeof id!=='string'){throw'invalid module definition, module id must be defined and be a string';}if(dependencies===undefined){throw'invalid module definition, dependencies must be specified';}if(definition===undefined){throw'invalid module definition, definition function must be specified';}require(dependencies,function(){modules[id]=definition.apply(null,arguments)})}function defined(id){return!!modules[id]}function resolve(id){var target=exports;var fragments=id.split(/[.\/]/);for(var fi=0;fi<fragments.length;++fi){if(!target[fragments[fi]]){return}target=target[fragments[fi]]}return target}function expose(ids){for(var i=0;i<ids.length;i++){var target=exports;var id=ids[i];var fragments=id.split(/[.\/]/);for(var fi=0;fi<fragments.length-1;++fi){if(target[fragments[fi]]===undefined){target[fragments[fi]]={}}target=target[fragments[fi]]}target[fragments[fragments.length-1]]=modules[id]}}define('moxie/core/utils/Basic',[],function(){var typeOf=function(o){var undef;if(o===undef){return'undefined'}else if(o===null){return'null'}else if(o.nodeType){return'node'}return({}).toString.call(o).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()};var extend=function(target){var undef;each(arguments,function(arg,i){if(i>0){each(arg,function(value,key){if(value!==undef){if(typeOf(target[key])===typeOf(value)&&!!~inArray(typeOf(value),['array','object'])){extend(target[key],value)}else{target[key]=value}}})}});return target};var each=function(obj,callback){var length,key,i,undef;if(obj){try{length=obj.length}catch(ex){length=undef}if(length===undef){for(key in obj){if(obj.hasOwnProperty(key)){if(callback(obj[key],key)===false){return}}}}else{for(i=0;i<length;i++){if(callback(obj[i],i)===false){return}}}}};var isEmptyObj=function(obj){var prop;if(!obj||typeOf(obj)!=='object'){return true}for(prop in obj){return false}return true};var inSeries=function(queue,cb){var i=0,length=queue.length;if(typeOf(cb)!=='function'){cb=function(){}}if(!queue||!queue.length){cb()}function callNext(i){if(typeOf(queue[i])==='function'){queue[i](function(error){++i<length&&!error?callNext(i):cb(error)})}}callNext(i)};var inParallel=function(queue,cb){var count=0,num=queue.length,cbArgs=new Array(num);each(queue,function(fn,i){fn(function(error){if(error){return cb(error)}var args=[].slice.call(arguments);args.shift();cbArgs[i]=args;count++;if(count===num){cbArgs.unshift(null);cb.apply(this,cbArgs)}})})};var inArray=function(needle,array){if(array){if(Array.prototype.indexOf){return Array.prototype.indexOf.call(array,needle)}for(var i=0,length=array.length;i<length;i++){if(array[i]===needle){return i}}}return-1};var arrayDiff=function(needles,array){var diff=[];if(typeOf(needles)!=='array'){needles=[needles]}if(typeOf(array)!=='array'){array=[array]}for(var i in needles){if(inArray(needles[i],array)===-1){diff.push(needles[i])}}return diff.length?diff:false};var arrayIntersect=function(array1,array2){var result=[];each(array1,function(item){if(inArray(item,array2)!==-1){result.push(item)}});return result.length?result:null};var toArray=function(obj){var i,arr=[];for(i=0;i<obj.length;i++){arr[i]=obj[i]}return arr};var guid=(function(){var counter=0;return function(prefix){var guid=new Date().getTime().toString(32),i;for(i=0;i<5;i++){guid+=Math.floor(Math.random()*65535).toString(32)}return(prefix||'o_')+guid+(counter++).toString(32)}}());var trim=function(str){if(!str){return str}return String.prototype.trim?String.prototype.trim.call(str):str.toString().replace(/^\s*/,'').replace(/\s*$/,'')};var parseSizeStr=function(size){if(typeof(size)!=='string'){return size}var muls={t:1099511627776,g:1073741824,m:1048576,k:1024},mul;size=/^([0-9]+)([mgk]?)$/.exec(size.toLowerCase().replace(/[^0-9mkg]/g,''));mul=size[2];size=+size[1];if(muls.hasOwnProperty(mul)){size*=muls[mul]}return size};return{guid:guid,typeOf:typeOf,extend:extend,each:each,isEmptyObj:isEmptyObj,inSeries:inSeries,inParallel:inParallel,inArray:inArray,arrayDiff:arrayDiff,arrayIntersect:arrayIntersect,toArray:toArray,trim:trim,parseSizeStr:parseSizeStr}});define("moxie/core/I18n",["moxie/core/utils/Basic"],function(Basic){var i18n={};return{addI18n:function(pack){return Basic.extend(i18n,pack)},translate:function(str){return i18n[str]||str},_:function(str){return this.translate(str)},sprintf:function(str){var args=[].slice.call(arguments,1);return str.replace(/%[a-z]/g,function(){var value=args.shift();return Basic.typeOf(value)!=='undefined'?value:''})}}});define("moxie/core/utils/Mime",["moxie/core/utils/Basic","moxie/core/I18n"],function(Basic,I18n){var mimeData=""+"application/msword,doc dot,"+"application/pdf,pdf,"+"application/pgp-signature,pgp,"+"application/postscript,ps ai eps,"+"application/rtf,rtf,"+"application/vnd.ms-excel,xls xlb,"+"application/vnd.ms-powerpoint,ppt pps pot,"+"application/zip,zip,"+"application/x-shockwave-flash,swf swfl,"+"application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,"+"application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,"+"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,"+"application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,"+"application/vnd.openxmlformats-officedocument.presentationml.template,potx,"+"application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,"+"application/x-javascript,js,"+"application/json,json,"+"audio/mpeg,mp3 mpga mpega mp2,"+"audio/x-wav,wav,"+"audio/x-m4a,m4a,"+"audio/ogg,oga ogg,"+"audio/aiff,aiff aif,"+"audio/flac,flac,"+"audio/aac,aac,"+"audio/ac3,ac3,"+"audio/x-ms-wma,wma,"+"image/bmp,bmp,"+"image/gif,gif,"+"image/jpeg,jpg jpeg jpe,"+"image/photoshop,psd,"+"image/png,png,"+"image/svg+xml,svg svgz,"+"image/tiff,tiff tif,"+"text/plain,asc txt text diff log,"+"text/html,htm html xhtml,"+"text/css,css,"+"text/csv,csv,"+"text/rtf,rtf,"+"video/mpeg,mpeg mpg mpe m2v,"+"video/quicktime,qt mov,"+"video/mp4,mp4,"+"video/x-m4v,m4v,"+"video/x-flv,flv,"+"video/x-ms-wmv,wmv,"+"video/avi,avi,"+"video/webm,webm,"+"video/3gpp,3gpp 3gp,"+"video/3gpp2,3g2,"+"video/vnd.rn-realvideo,rv,"+"video/ogg,ogv,"+"video/x-matroska,mkv,"+"application/vnd.oasis.opendocument.formula-template,otf,"+"application/octet-stream,exe";var Mime={mimes:{},extensions:{},addMimeType:function(mimeData){var items=mimeData.split(/,/),i,ii,ext;for(i=0;i<items.length;i+=2){ext=items[i+1].split(/ /);for(ii=0;ii<ext.length;ii++){this.mimes[ext[ii]]=items[i]}this.extensions[items[i]]=ext}},extList2mimes:function(filters,addMissingExtensions){var self=this,ext,i,ii,type,mimes=[];for(i=0;i<filters.length;i++){ext=filters[i].extensions.split(/\s*,\s*/);for(ii=0;ii<ext.length;ii++){if(ext[ii]==='*'){return[]}type=self.mimes[ext[ii]];if(!type){if(addMissingExtensions&&/^\w+$/.test(ext[ii])){mimes.push('.'+ext[ii])}else{return[]}}else if(Basic.inArray(type,mimes)===-1){mimes.push(type)}}}return mimes},mimes2exts:function(mimes){var self=this,exts=[];Basic.each(mimes,function(mime){if(mime==='*'){exts=[];return false}var m=mime.match(/^(\w+)\/(\*|\w+)$/);if(m){if(m[2]==='*'){Basic.each(self.extensions,function(arr,mime){if((new RegExp('^'+m[1]+'/')).test(mime)){[].push.apply(exts,self.extensions[mime])}})}else if(self.extensions[mime]){[].push.apply(exts,self.extensions[mime])}}});return exts},mimes2extList:function(mimes){var accept=[],exts=[];if(Basic.typeOf(mimes)==='string'){mimes=Basic.trim(mimes).split(/\s*,\s*/)}exts=this.mimes2exts(mimes);accept.push({title:I18n.translate('Files'),extensions:exts.length?exts.join(','):'*'});accept.mimes=mimes;return accept},getFileExtension:function(fileName){var matches=fileName&&fileName.match(/\.([^.]+)$/);if(matches){return matches[1].toLowerCase()}return''},getFileMime:function(fileName){return this.mimes[this.getFileExtension(fileName)]||''}};Mime.addMimeType(mimeData);return Mime});define("moxie/core/utils/Env",["moxie/core/utils/Basic"],function(Basic){var UAParser=(function(undefined){var EMPTY='',UNKNOWN='?',FUNC_TYPE='function',UNDEF_TYPE='undefined',OBJ_TYPE='object',MAJOR='major',MODEL='model',NAME='name',TYPE='type',VENDOR='vendor',VERSION='version',ARCHITECTURE='architecture',CONSOLE='console',MOBILE='mobile',TABLET='tablet';var util={has:function(str1,str2){return str2.toLowerCase().indexOf(str1.toLowerCase())!==-1},lowerize:function(str){return str.toLowerCase()}};var mapper={rgx:function(){for(var result,i=0,j,k,p,q,matches,match,args=arguments;i<args.length;i+=2){var regex=args[i],props=args[i+1];if(typeof(result)===UNDEF_TYPE){result={};for(p in props){q=props[p];if(typeof(q)===OBJ_TYPE){result[q[0]]=undefined}else{result[q]=undefined}}}for(j=k=0;j<regex.length;j++){matches=regex[j].exec(this.getUA());if(!!matches){for(p=0;p<props.length;p++){match=matches[++k];q=props[p];if(typeof(q)===OBJ_TYPE&&q.length>0){if(q.length==2){if(typeof(q[1])==FUNC_TYPE){result[q[0]]=q[1].call(this,match)}else{result[q[0]]=q[1]}}else if(q.length==3){if(typeof(q[1])===FUNC_TYPE&&!(q[1].exec&&q[1].test)){result[q[0]]=match?q[1].call(this,match,q[2]):undefined}else{result[q[0]]=match?match.replace(q[1],q[2]):undefined}}else if(q.length==4){result[q[0]]=match?q[3].call(this,match.replace(q[1],q[2])):undefined}}else{result[q]=match?match:undefined}}break}}if(!!matches)break}return result},str:function(str,map){for(var i in map){if(typeof(map[i])===OBJ_TYPE&&map[i].length>0){for(var j=0;j<map[i].length;j++){if(util.has(map[i][j],str)){return(i===UNKNOWN)?undefined:i}}}else if(util.has(map[i],str)){return(i===UNKNOWN)?undefined:i}}return str}};var maps={browser:{oldsafari:{major:{'1':['/8','/1','/3'],'2':'/4','?':'/'},version:{'1.0':'/8','1.2':'/1','1.3':'/3','2.0':'/412','2.0.2':'/416','2.0.3':'/417','2.0.4':'/419','?':'/'}}},device:{sprint:{model:{'Evo Shift 4G':'7373KT'},vendor:{'HTC':'APA','Sprint':'Sprint'}}},os:{windows:{version:{'ME':'4.90','NT 3.11':'NT3.51','NT 4.0':'NT4.0','2000':'NT 5.0','XP':['NT 5.1','NT 5.2'],'Vista':'NT 6.0','7':'NT 6.1','8':'NT 6.2','8.1':'NT 6.3','RT':'ARM'}}}};var regexes={browser:[[/(opera\smini)\/((\d+)?[\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/((\d+)?[\w\.-]+)/i,/(opera).+version\/((\d+)?[\w\.]+)/i,/(opera)[\/\s]+((\d+)?[\w\.]+)/i],[NAME,VERSION,MAJOR],[/\s(opr)\/((\d+)?[\w\.]+)/i],[[NAME,'Opera'],VERSION,MAJOR],[/(kindle)\/((\d+)?[\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?((\d+)?[\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?((\d+)?[\w\.]*)/i,/(?:ms|\()(ie)\s((\d+)?[\w\.]+)/i,/(rekonq)((?:\/)[\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron)\/((\d+)?[\w\.-]+)/i],[NAME,VERSION,MAJOR],[/(trident).+rv[:\s]((\d+)?[\w\.]+).+like\sgecko/i],[[NAME,'IE'],VERSION,MAJOR],[/(yabrowser)\/((\d+)?[\w\.]+)/i],[[NAME,'Yandex'],VERSION,MAJOR],[/(comodo_dragon)\/((\d+)?[\w\.]+)/i],[[NAME,/_/g,' '],VERSION,MAJOR],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?((\d+)?[\w\.]+)/i],[NAME,VERSION,MAJOR],[/(dolfin)\/((\d+)?[\w\.]+)/i],[[NAME,'Dolphin'],VERSION,MAJOR],[/((?:android.+)crmo|crios)\/((\d+)?[\w\.]+)/i],[[NAME,'Chrome'],VERSION,MAJOR],[/((?:android.+))version\/((\d+)?[\w\.]+)\smobile\ssafari/i],[[NAME,'Android Browser'],VERSION,MAJOR],[/version\/((\d+)?[\w\.]+).+?mobile\/\w+\s(safari)/i],[VERSION,MAJOR,[NAME,'Mobile Safari']],[/version\/((\d+)?[\w\.]+).+?(mobile\s?safari|safari)/i],[VERSION,MAJOR,NAME],[/webkit.+?(mobile\s?safari|safari)((\/[\w\.]+))/i],[NAME,[MAJOR,mapper.str,maps.browser.oldsafari.major],[VERSION,mapper.str,maps.browser.oldsafari.version]],[/(konqueror)\/((\d+)?[\w\.]+)/i,/(webkit|khtml)\/((\d+)?[\w\.]+)/i],[NAME,VERSION,MAJOR],[/(navigator|netscape)\/((\d+)?[\w\.-]+)/i],[[NAME,'Netscape'],VERSION,MAJOR],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?((\d+)?[\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/((\d+)?[\w\.-]+)/i,/(mozilla)\/((\d+)?[\w\.]+).+rv\:.+gecko\/\d+/i,/(uc\s?browser|polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|qqbrowser)[\/\s]?((\d+)?[\w\.]+)/i,/(links)\s\(((\d+)?[\w\.]+)/i,/(gobrowser)\/?((\d+)?[\w\.]+)*/i,/(ice\s?browser)\/v?((\d+)?[\w\._]+)/i,/(mosaic)[\/\s]((\d+)?[\w\.]+)/i],[NAME,VERSION,MAJOR]],engine:[[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[NAME,VERSION],[/rv\:([\w\.]+).*(gecko)/i],[VERSION,NAME]],os:[[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[NAME,[VERSION,mapper.str,maps.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[NAME,'Windows'],[VERSION,mapper.str,maps.os.windows.version]],[/\((bb)(10);/i],[[NAME,'BlackBerry'],VERSION],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)\/([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego)[\/\s-]?([\w\.]+)*/i],[NAME,VERSION],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[NAME,'Symbian'],VERSION],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[NAME,'Firefox OS'],VERSION],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[NAME,VERSION],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[NAME,'Chromium OS'],VERSION],[/(sunos)\s?([\w\.]+\d)*/i],[[NAME,'Solaris'],VERSION],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[NAME,VERSION],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[NAME,'iOS'],[VERSION,/_/g,'.']],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i],[NAME,[VERSION,/_/g,'.']],[/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(macintosh|mac(?=_powerpc)|plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos)/i,/(unix)\s?([\w\.]+)*/i],[NAME,VERSION]]};var UAParser=function(uastring){var ua=uastring||((window&&window.navigator&&window.navigator.userAgent)?window.navigator.userAgent:EMPTY);this.getBrowser=function(){return mapper.rgx.apply(this,regexes.browser)};this.getEngine=function(){return mapper.rgx.apply(this,regexes.engine)};this.getOS=function(){return mapper.rgx.apply(this,regexes.os)};this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS()}};this.getUA=function(){return ua};this.setUA=function(uastring){ua=uastring;return this};this.setUA(ua)};return new UAParser().getResult()})();function version_compare(v1,v2,operator){var i=0,x=0,compare=0,vm={'dev':-6,'alpha':-5,'a':-5,'beta':-4,'b':-4,'RC':-3,'rc':-3,'#':-2,'p':1,'pl':1},prepVersion=function(v){v=(''+v).replace(/[_\-+]/g,'.');v=v.replace(/([^.\d]+)/g,'.$1.').replace(/\.{2,}/g,'.');return(!v.length?[-8]:v.split('.'))},numVersion=function(v){return!v?0:(isNaN(v)?vm[v]||-7:parseInt(v,10))};v1=prepVersion(v1);v2=prepVersion(v2);x=Math.max(v1.length,v2.length);for(i=0;i<x;i++){if(v1[i]==v2[i]){continue}v1[i]=numVersion(v1[i]);v2[i]=numVersion(v2[i]);if(v1[i]<v2[i]){compare=-1;break}else if(v1[i]>v2[i]){compare=1;break}}if(!operator){return compare}switch(operator){case'>':case'gt':return(compare>0);case'>=':case'ge':return(compare>=0);case'<=':case'le':return(compare<=0);case'==':case'=':case'eq':return(compare===0);case'<>':case'!=':case'ne':return(compare!==0);case'':case'<':case'lt':return(compare<0);default:return null}}var can=(function(){var caps={define_property:(function(){return false}()),create_canvas:(function(){var el=document.createElement('canvas');return!!(el.getContext&&el.getContext('2d'))}()),return_response_type:function(responseType){try{if(Basic.inArray(responseType,['','text','document'])!==-1){return true}else if(window.XMLHttpRequest){var xhr=new XMLHttpRequest();xhr.open('get','/');if('responseType'in xhr){xhr.responseType=responseType;if(xhr.responseType!==responseType){return false}return true}}}catch(ex){}return false},use_data_uri:(function(){var du=new Image();du.onload=function(){caps.use_data_uri=(du.width===1&&du.height===1)};setTimeout(function(){du.src="data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="},1);return false}()),use_data_uri_over32kb:function(){return caps.use_data_uri&&(Env.browser!=='IE'||Env.version>=9)},use_data_uri_of:function(bytes){return(caps.use_data_uri&&bytes<33000||caps.use_data_uri_over32kb())},use_fileinput:function(){var el=document.createElement('input');el.setAttribute('type','file');return!el.disabled}};return function(cap){var args=[].slice.call(arguments);args.shift();return Basic.typeOf(caps[cap])==='function'?caps[cap].apply(this,args):!!caps[cap]}}());var Env={can:can,browser:UAParser.browser.name,version:parseFloat(UAParser.browser.major),os:UAParser.os.name,osVersion:UAParser.os.version,verComp:version_compare,swf_url:"../flash/Moxie.swf",xap_url:"../silverlight/Moxie.xap",global_event_dispatcher:"moxie.core.EventTarget.instance.dispatchEvent"};Env.OS=Env.os;return Env});define('moxie/core/utils/Dom',['moxie/core/utils/Env'],function(Env){var get=function(id){if(typeof id!=='string'){return id}return document.getElementById(id)};var hasClass=function(obj,name){if(!obj.className){return false}var regExp=new RegExp("(^|\\s+)"+name+"(\\s+|$)");return regExp.test(obj.className)};var addClass=function(obj,name){if(!hasClass(obj,name)){obj.className=!obj.className?name:obj.className.replace(/\s+$/,'')+' '+name}};var removeClass=function(obj,name){if(obj.className){var regExp=new RegExp("(^|\\s+)"+name+"(\\s+|$)");obj.className=obj.className.replace(regExp,function($0,$1,$2){return $1===' '&&$2===' '?' ':''})}};var getStyle=function(obj,name){if(obj.currentStyle){return obj.currentStyle[name]}else if(window.getComputedStyle){return window.getComputedStyle(obj,null)[name]}};var getPos=function(node,root){var x=0,y=0,parent,doc=document,nodeRect,rootRect;node=node;root=root||doc.body;function getIEPos(node){var bodyElm,rect,x=0,y=0;if(node){rect=node.getBoundingClientRect();bodyElm=doc.compatMode==="CSS1Compat"?doc.documentElement:doc.body;x=rect.left+bodyElm.scrollLeft;y=rect.top+bodyElm.scrollTop}return{x:x,y:y}}if(node&&node.getBoundingClientRect&&Env.browser==='IE'&&(!doc.documentMode||doc.documentMode<8)){nodeRect=getIEPos(node);rootRect=getIEPos(root);return{x:nodeRect.x-rootRect.x,y:nodeRect.y-rootRect.y}}parent=node;while(parent&&parent!=root&&parent.nodeType){x+=parent.offsetLeft||0;y+=parent.offsetTop||0;parent=parent.offsetParent}parent=node.parentNode;while(parent&&parent!=root&&parent.nodeType){x-=parent.scrollLeft||0;y-=parent.scrollTop||0;parent=parent.parentNode}return{x:x,y:y}};var getSize=function(node){return{w:node.offsetWidth||node.clientWidth,h:node.offsetHeight||node.clientHeight}};return{get:get,hasClass:hasClass,addClass:addClass,removeClass:removeClass,getStyle:getStyle,getPos:getPos,getSize:getSize}});define('moxie/core/Exceptions',['moxie/core/utils/Basic'],function(Basic){function _findKey(obj,value){var key;for(key in obj){if(obj[key]===value){return key}}return null}return{RuntimeError:(function(){var namecodes={NOT_INIT_ERR:1,NOT_SUPPORTED_ERR:9,JS_ERR:4};function RuntimeError(code){this.code=code;this.name=_findKey(namecodes,code);this.message=this.name+": RuntimeError "+this.code}Basic.extend(RuntimeError,namecodes);RuntimeError.prototype=Error.prototype;return RuntimeError}()),OperationNotAllowedException:(function(){function OperationNotAllowedException(code){this.code=code;this.name='OperationNotAllowedException'}Basic.extend(OperationNotAllowedException,{NOT_ALLOWED_ERR:1});OperationNotAllowedException.prototype=Error.prototype;return OperationNotAllowedException}()),ImageError:(function(){var namecodes={WRONG_FORMAT:1,MAX_RESOLUTION_ERR:2};function ImageError(code){this.code=code;this.name=_findKey(namecodes,code);this.message=this.name+": ImageError "+this.code}Basic.extend(ImageError,namecodes);ImageError.prototype=Error.prototype;return ImageError}()),FileException:(function(){var namecodes={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,SYNTAX_ERR:8};function FileException(code){this.code=code;this.name=_findKey(namecodes,code);this.message=this.name+": FileException "+this.code}Basic.extend(FileException,namecodes);FileException.prototype=Error.prototype;return FileException}()),DOMException:(function(){var namecodes={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};function DOMException(code){this.code=code;this.name=_findKey(namecodes,code);this.message=this.name+": DOMException "+this.code}Basic.extend(DOMException,namecodes);DOMException.prototype=Error.prototype;return DOMException}()),EventException:(function(){function EventException(code){this.code=code;this.name='EventException'}Basic.extend(EventException,{UNSPECIFIED_EVENT_TYPE_ERR:0});EventException.prototype=Error.prototype;return EventException}())}});define('moxie/core/EventTarget',['moxie/core/Exceptions','moxie/core/utils/Basic'],function(x,Basic){function EventTarget(){var eventpool={};Basic.extend(this,{uid:null,init:function(){if(!this.uid){this.uid=Basic.guid('uid_')}},addEventListener:function(type,fn,priority,scope){var self=this,list;type=Basic.trim(type);if(/\s/.test(type)){Basic.each(type.split(/\s+/),function(type){self.addEventListener(type,fn,priority,scope)});return}type=type.toLowerCase();priority=parseInt(priority,10)||0;list=eventpool[this.uid]&&eventpool[this.uid][type]||[];list.push({fn:fn,priority:priority,scope:scope||this});if(!eventpool[this.uid]){eventpool[this.uid]={}}eventpool[this.uid][type]=list},hasEventListener:function(type){return type?!!(eventpool[this.uid]&&eventpool[this.uid][type]):!!eventpool[this.uid]},removeEventListener:function(type,fn){type=type.toLowerCase();var list=eventpool[this.uid]&&eventpool[this.uid][type],i;if(list){if(fn){for(i=list.length-1;i>=0;i--){if(list[i].fn===fn){list.splice(i,1);break}}}else{list=[]}if(!list.length){delete eventpool[this.uid][type];if(Basic.isEmptyObj(eventpool[this.uid])){delete eventpool[this.uid]}}}},removeAllEventListeners:function(){if(eventpool[this.uid]){delete eventpool[this.uid]}},dispatchEvent:function(type){var uid,list,args,tmpEvt,evt={},result=true,undef;if(Basic.typeOf(type)!=='string'){tmpEvt=type;if(Basic.typeOf(tmpEvt.type)==='string'){type=tmpEvt.type;if(tmpEvt.total!==undef&&tmpEvt.loaded!==undef){evt.total=tmpEvt.total;evt.loaded=tmpEvt.loaded}evt.async=tmpEvt.async||false}else{throw new x.EventException(x.EventException.UNSPECIFIED_EVENT_TYPE_ERR);}}if(type.indexOf('::')!==-1){(function(arr){uid=arr[0];type=arr[1]}(type.split('::')))}else{uid=this.uid}type=type.toLowerCase();list=eventpool[uid]&&eventpool[uid][type];if(list){list.sort(function(a,b){return b.priority-a.priority});args=[].slice.call(arguments);args.shift();evt.type=type;args.unshift(evt);var queue=[];Basic.each(list,function(handler){args[0].target=handler.scope;if(evt.async){queue.push(function(cb){setTimeout(function(){cb(handler.fn.apply(handler.scope,args)===false)},1)})}else{queue.push(function(cb){cb(handler.fn.apply(handler.scope,args)===false)})}});if(queue.length){Basic.inSeries(queue,function(err){result=!err})}}return result},bind:function(){this.addEventListener.apply(this,arguments)},unbind:function(){this.removeEventListener.apply(this,arguments)},unbindAll:function(){this.removeAllEventListeners.apply(this,arguments)},trigger:function(){return this.dispatchEvent.apply(this,arguments)},convertEventPropsToHandlers:function(handlers){var h;if(Basic.typeOf(handlers)!=='array'){handlers=[handlers]}for(var i=0;i<handlers.length;i++){h='on'+handlers[i];if(Basic.typeOf(this[h])==='function'){this.addEventListener(handlers[i],this[h])}else if(Basic.typeOf(this[h])==='undefined'){this[h]=null}}}})}EventTarget.instance=new EventTarget();return EventTarget});define('moxie/core/utils/Encode',[],function(){var utf8_encode=function(str){return unescape(encodeURIComponent(str))};var utf8_decode=function(str_data){return decodeURIComponent(escape(str_data))};var atob=function(data,utf8){if(typeof(window.atob)==='function'){return utf8?utf8_decode(window.atob(data)):window.atob(data)}var b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,dec="",tmp_arr=[];if(!data){return data}data+='';do{h1=b64.indexOf(data.charAt(i++));h2=b64.indexOf(data.charAt(i++));h3=b64.indexOf(data.charAt(i++));h4=b64.indexOf(data.charAt(i++));bits=h1<<18|h2<<12|h3<<6|h4;o1=bits>>16&0xff;o2=bits>>8&0xff;o3=bits&0xff;if(h3==64){tmp_arr[ac++]=String.fromCharCode(o1)}else if(h4==64){tmp_arr[ac++]=String.fromCharCode(o1,o2)}else{tmp_arr[ac++]=String.fromCharCode(o1,o2,o3)}}while(i<data.length);dec=tmp_arr.join('');return utf8?utf8_decode(dec):dec};var btoa=function(data,utf8){if(utf8){utf8_encode(data)}if(typeof(window.btoa)==='function'){return window.btoa(data)}var b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,enc="",tmp_arr=[];if(!data){return data}do{o1=data.charCodeAt(i++);o2=data.charCodeAt(i++);o3=data.charCodeAt(i++);bits=o1<<16|o2<<8|o3;h1=bits>>18&0x3f;h2=bits>>12&0x3f;h3=bits>>6&0x3f;h4=bits&0x3f;tmp_arr[ac++]=b64.charAt(h1)+b64.charAt(h2)+b64.charAt(h3)+b64.charAt(h4)}while(i<data.length);enc=tmp_arr.join('');var r=data.length%3;return(r?enc.slice(0,r-3):enc)+'==='.slice(r||3)};return{utf8_encode:utf8_encode,utf8_decode:utf8_decode,atob:atob,btoa:btoa}});define('moxie/runtime/Runtime',["moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/EventTarget"],function(Basic,Dom,EventTarget){var runtimeConstructors={},runtimes={};function Runtime(options,type,caps,modeCaps,preferredMode){var self=this,_shim,_uid=Basic.guid(type+'_'),defaultMode=preferredMode||'browser';options=options||{};runtimes[_uid]=this;caps=Basic.extend({access_binary:false,access_image_binary:false,display_media:false,do_cors:false,drag_and_drop:false,filter_by_extension:true,resize_image:false,report_upload_progress:false,return_response_headers:false,return_response_type:false,return_status_code:true,send_custom_headers:false,select_file:false,select_folder:false,select_multiple:true,send_binary_string:false,send_browser_cookies:true,send_multipart:true,slice_blob:false,stream_upload:false,summon_file_dialog:false,upload_filesize:true,use_http_method:true},caps);if(options.preferred_caps){defaultMode=Runtime.getMode(modeCaps,options.preferred_caps,defaultMode)}_shim=(function(){var objpool={};return{exec:function(uid,comp,fn,args){if(_shim[comp]){if(!objpool[uid]){objpool[uid]={context:this,instance:new _shim[comp]()}}if(objpool[uid].instance[fn]){return objpool[uid].instance[fn].apply(this,args)}}},removeInstance:function(uid){delete objpool[uid]},removeAllInstances:function(){var self=this;Basic.each(objpool,function(obj,uid){if(Basic.typeOf(obj.instance.destroy)==='function'){obj.instance.destroy.call(obj.context)}self.removeInstance(uid)})}}}());Basic.extend(this,{initialized:false,uid:_uid,type:type,mode:Runtime.getMode(modeCaps,(options.required_caps),defaultMode),shimid:_uid+'_container',clients:0,options:options,can:function(cap,value){var refCaps=arguments[2]||caps;if(Basic.typeOf(cap)==='string'&&Basic.typeOf(value)==='undefined'){cap=Runtime.parseCaps(cap)}if(Basic.typeOf(cap)==='object'){for(var key in cap){if(!this.can(key,cap[key],refCaps)){return false}}return true}if(Basic.typeOf(refCaps[cap])==='function'){return refCaps[cap].call(this,value)}else{return(value===refCaps[cap])}},getShimContainer:function(){var container,shimContainer=Dom.get(this.shimid);if(!shimContainer){container=this.options.container?Dom.get(this.options.container):document.body;shimContainer=document.createElement('div');shimContainer.id=this.shimid;shimContainer.className='moxie-shim moxie-shim-'+this.type;Basic.extend(shimContainer.style,{position:'absolute',top:'0px',left:'0px',width:'1px',height:'1px',overflow:'hidden'});container.appendChild(shimContainer);container=null}return shimContainer},getShim:function(){return _shim},shimExec:function(component,action){var args=[].slice.call(arguments,2);return self.getShim().exec.call(this,this.uid,component,action,args)},exec:function(component,action){var args=[].slice.call(arguments,2);if(self[component]&&self[component][action]){return self[component][action].apply(this,args)}return self.shimExec.apply(this,arguments)},destroy:function(){if(!self){return}var shimContainer=Dom.get(this.shimid);if(shimContainer){shimContainer.parentNode.removeChild(shimContainer)}if(_shim){_shim.removeAllInstances()}this.unbindAll();delete runtimes[this.uid];this.uid=null;_uid=self=_shim=shimContainer=null}});if(this.mode&&options.required_caps&&!this.can(options.required_caps)){this.mode=false}}Runtime.order='html5,flash,silverlight,html4';Runtime.getRuntime=function(uid){return runtimes[uid]?runtimes[uid]:false};Runtime.addConstructor=function(type,constructor){constructor.prototype=EventTarget.instance;runtimeConstructors[type]=constructor};Runtime.getConstructor=function(type){return runtimeConstructors[type]||null};Runtime.getInfo=function(uid){var runtime=Runtime.getRuntime(uid);if(runtime){return{uid:runtime.uid,type:runtime.type,mode:runtime.mode,can:function(){return runtime.can.apply(runtime,arguments)}}}return null};Runtime.parseCaps=function(capStr){var capObj={};if(Basic.typeOf(capStr)!=='string'){return capStr||{}}Basic.each(capStr.split(','),function(key){capObj[key]=true});return capObj};Runtime.can=function(type,caps){var runtime,constructor=Runtime.getConstructor(type),mode;if(constructor){runtime=new constructor({required_caps:caps});mode=runtime.mode;runtime.destroy();return!!mode}return false};Runtime.thatCan=function(caps,runtimeOrder){var types=(runtimeOrder||Runtime.order).split(/\s*,\s*/);for(var i in types){if(Runtime.can(types[i],caps)){return types[i]}}return null};Runtime.getMode=function(modeCaps,requiredCaps,defaultMode){var mode=null;if(Basic.typeOf(defaultMode)==='undefined'){defaultMode='browser'}if(requiredCaps&&!Basic.isEmptyObj(modeCaps)){Basic.each(requiredCaps,function(value,cap){if(modeCaps.hasOwnProperty(cap)){var capMode=modeCaps[cap](value);if(typeof(capMode)==='string'){capMode=[capMode]}if(!mode){mode=capMode}else if(!(mode=Basic.arrayIntersect(mode,capMode))){return(mode=false)}}});if(mode){return Basic.inArray(defaultMode,mode)!==-1?defaultMode:mode[0]}else if(mode===false){return false}}return defaultMode};Runtime.capTrue=function(){return true};Runtime.capFalse=function(){return false};Runtime.capTest=function(expr){return function(){return!!expr}};return Runtime});define('moxie/runtime/RuntimeClient',['moxie/core/Exceptions','moxie/core/utils/Basic','moxie/runtime/Runtime'],function(x,Basic,Runtime){return function RuntimeClient(){var runtime;Basic.extend(this,{connectRuntime:function(options){var comp=this,ruid;function initialize(items){var type,constructor;if(!items.length){comp.trigger('RuntimeError',new x.RuntimeError(x.RuntimeError.NOT_INIT_ERR));runtime=null;return}type=items.shift();constructor=Runtime.getConstructor(type);if(!constructor){initialize(items);return}runtime=new constructor(options);runtime.bind('Init',function(){runtime.initialized=true;setTimeout(function(){runtime.clients++;comp.trigger('RuntimeInit',runtime)},1)});runtime.bind('Error',function(){runtime.destroy();initialize(items)});if(!runtime.mode){runtime.trigger('Error');return}runtime.init()}if(Basic.typeOf(options)==='string'){ruid=options}else if(Basic.typeOf(options.ruid)==='string'){ruid=options.ruid}if(ruid){runtime=Runtime.getRuntime(ruid);if(runtime){runtime.clients++;return runtime}else{throw new x.RuntimeError(x.RuntimeError.NOT_INIT_ERR);}}initialize((options.runtime_order||Runtime.order).split(/\s*,\s*/))},getRuntime:function(){if(runtime&&runtime.uid){return runtime}runtime=null;return null},disconnectRuntime:function(){if(runtime&&--runtime.clients<=0){runtime.destroy();runtime=null}}})}});define('moxie/file/Blob',['moxie/core/utils/Basic','moxie/core/utils/Encode','moxie/runtime/RuntimeClient'],function(Basic,Encode,RuntimeClient){var blobpool={};function Blob(ruid,blob){function _sliceDetached(start,end,type){var blob,data=blobpool[this.uid];if(Basic.typeOf(data)!=='string'||!data.length){return null}blob=new Blob(null,{type:type,size:end-start});blob.detach(data.substr(start,blob.size));return blob}RuntimeClient.call(this);if(ruid){this.connectRuntime(ruid)}if(!blob){blob={}}else if(Basic.typeOf(blob)==='string'){blob={data:blob}}Basic.extend(this,{uid:blob.uid||Basic.guid('uid_'),ruid:ruid,size:blob.size||0,type:blob.type||'',slice:function(start,end,type){if(this.isDetached()){return _sliceDetached.apply(this,arguments)}return this.getRuntime().exec.call(this,'Blob','slice',this.getSource(),start,end,type)},getSource:function(){if(!blobpool[this.uid]){return null}return blobpool[this.uid]},detach:function(data){if(this.ruid){this.getRuntime().exec.call(this,'Blob','destroy',blobpool[this.uid]);this.disconnectRuntime();this.ruid=null}data=data||'';var matches=data.match(/^data:([^;]*);base64,/);if(matches){this.type=matches[1];data=Encode.atob(data.substring(data.indexOf('base64,')+7))}this.size=data.length;blobpool[this.uid]=data},isDetached:function(){return!this.ruid&&Basic.typeOf(blobpool[this.uid])==='string'},destroy:function(){this.detach();delete blobpool[this.uid]}});if(blob.data){this.detach(blob.data)}else{blobpool[this.uid]=blob}}return Blob});define('moxie/file/File',['moxie/core/utils/Basic','moxie/core/utils/Mime','moxie/file/Blob'],function(Basic,Mime,Blob){function File(ruid,file){var name,type;if(!file){file={}}if(file.type&&file.type!==''){type=file.type}else{type=Mime.getFileMime(file.name)}if(file.name){name=file.name.replace(/\\/g,'/');name=name.substr(name.lastIndexOf('/')+1)}else{var prefix=type.split('/')[0];name=Basic.guid((prefix!==''?prefix:'file')+'_');if(Mime.extensions[type]){name+='.'+Mime.extensions[type][0]}}Blob.apply(this,arguments);Basic.extend(this,{type:type||'',name:name||Basic.guid('file_'),lastModifiedDate:file.lastModifiedDate||(new Date()).toLocaleString()})}File.prototype=Blob.prototype;return File});define('moxie/file/FileInput',['moxie/core/utils/Basic','moxie/core/utils/Mime','moxie/core/utils/Dom','moxie/core/Exceptions','moxie/core/EventTarget','moxie/core/I18n','moxie/file/File','moxie/runtime/Runtime','moxie/runtime/RuntimeClient'],function(Basic,Mime,Dom,x,EventTarget,I18n,File,Runtime,RuntimeClient){var dispatches=['ready','change','cancel','mouseenter','mouseleave','mousedown','mouseup'];function FileInput(options){var self=this,container,browseButton,defaults;if(Basic.inArray(Basic.typeOf(options),['string','node'])!==-1){options={browse_button:options}}browseButton=Dom.get(options.browse_button);if(!browseButton){throw new x.DOMException(x.DOMException.NOT_FOUND_ERR);}defaults={accept:[{title:I18n.translate('All Files'),extensions:'*'}],name:'file',multiple:false,required_caps:false,container:browseButton.parentNode||document.body};options=Basic.extend({},defaults,options);if(typeof(options.required_caps)==='string'){options.required_caps=Runtime.parseCaps(options.required_caps)}if(typeof(options.accept)==='string'){options.accept=Mime.mimes2extList(options.accept)}container=Dom.get(options.container);if(!container){container=document.body}if(Dom.getStyle(container,'position')==='static'){container.style.position='relative'}container=browseButton=null;RuntimeClient.call(self);Basic.extend(self,{uid:Basic.guid('uid_'),ruid:null,shimid:null,files:null,init:function(){self.convertEventPropsToHandlers(dispatches);self.bind('RuntimeInit',function(e,runtime){self.ruid=runtime.uid;self.shimid=runtime.shimid;self.bind("Ready",function(){self.trigger("Refresh")},999);self.bind("Change",function(){var files=runtime.exec.call(self,'FileInput','getFiles');self.files=[];Basic.each(files,function(file){if(file.size===0){return true}self.files.push(new File(self.ruid,file))})},999);self.bind('Refresh',function(){var pos,size,browseButton,shimContainer;browseButton=Dom.get(options.browse_button);shimContainer=Dom.get(runtime.shimid);if(browseButton){pos=Dom.getPos(browseButton,Dom.get(options.container));size=Dom.getSize(browseButton);if(shimContainer){Basic.extend(shimContainer.style,{top:pos.y+'px',left:pos.x+'px',width:size.w+'px',height:size.h+'px'})}}shimContainer=browseButton=null});runtime.exec.call(self,'FileInput','init',options)});self.connectRuntime(Basic.extend({},options,{required_caps:{select_file:true}}))},disable:function(state){var runtime=this.getRuntime();if(runtime){runtime.exec.call(this,'FileInput','disable',Basic.typeOf(state)==='undefined'?true:state)}},refresh:function(){self.trigger("Refresh")},destroy:function(){var runtime=this.getRuntime();if(runtime){runtime.exec.call(this,'FileInput','destroy');this.disconnectRuntime()}if(Basic.typeOf(this.files)==='array'){Basic.each(this.files,function(file){file.destroy()})}this.files=null}})}FileInput.prototype=EventTarget.instance;return FileInput});define('moxie/file/FileDrop',['moxie/core/I18n','moxie/core/utils/Dom','moxie/core/Exceptions','moxie/core/utils/Basic','moxie/file/File','moxie/runtime/RuntimeClient','moxie/core/EventTarget','moxie/core/utils/Mime'],function(I18n,Dom,x,Basic,File,RuntimeClient,EventTarget,Mime){var dispatches=['ready','dragenter','dragleave','drop','error'];function FileDrop(options){var self=this,defaults;if(typeof(options)==='string'){options={drop_zone:options}}defaults={accept:[{title:I18n.translate('All Files'),extensions:'*'}],required_caps:{drag_and_drop:true}};options=typeof(options)==='object'?Basic.extend({},defaults,options):defaults;options.container=Dom.get(options.drop_zone)||document.body;if(Dom.getStyle(options.container,'position')==='static'){options.container.style.position='relative'}if(typeof(options.accept)==='string'){options.accept=Mime.mimes2extList(options.accept)}RuntimeClient.call(self);Basic.extend(self,{uid:Basic.guid('uid_'),ruid:null,files:null,init:function(){self.convertEventPropsToHandlers(dispatches);self.bind('RuntimeInit',function(e,runtime){self.ruid=runtime.uid;self.bind("Drop",function(){var files=runtime.exec.call(self,'FileDrop','getFiles');self.files=[];Basic.each(files,function(file){self.files.push(new File(self.ruid,file))})},999);runtime.exec.call(self,'FileDrop','init',options);self.dispatchEvent('ready')});self.connectRuntime(options)},destroy:function(){var runtime=this.getRuntime();if(runtime){runtime.exec.call(this,'FileDrop','destroy');this.disconnectRuntime()}this.files=null}})}FileDrop.prototype=EventTarget.instance;return FileDrop});define('moxie/runtime/RuntimeTarget',['moxie/core/utils/Basic','moxie/runtime/RuntimeClient',"moxie/core/EventTarget"],function(Basic,RuntimeClient,EventTarget){function RuntimeTarget(){this.uid=Basic.guid('uid_');RuntimeClient.call(this);this.destroy=function(){this.disconnectRuntime();this.unbindAll()}}RuntimeTarget.prototype=EventTarget.instance;return RuntimeTarget});define('moxie/file/FileReader',['moxie/core/utils/Basic','moxie/core/utils/Encode','moxie/core/Exceptions','moxie/core/EventTarget','moxie/file/Blob','moxie/file/File','moxie/runtime/RuntimeTarget'],function(Basic,Encode,x,EventTarget,Blob,File,RuntimeTarget){var dispatches=['loadstart','progress','load','abort','error','loadend'];function FileReader(){var self=this,_fr;Basic.extend(this,{uid:Basic.guid('uid_'),readyState:FileReader.EMPTY,result:null,error:null,readAsBinaryString:function(blob){_read.call(this,'readAsBinaryString',blob)},readAsDataURL:function(blob){_read.call(this,'readAsDataURL',blob)},readAsText:function(blob){_read.call(this,'readAsText',blob)},abort:function(){this.result=null;if(Basic.inArray(this.readyState,[FileReader.EMPTY,FileReader.DONE])!==-1){return}else if(this.readyState===FileReader.LOADING){this.readyState=FileReader.DONE}if(_fr){_fr.getRuntime().exec.call(this,'FileReader','abort')}this.trigger('abort');this.trigger('loadend')},destroy:function(){this.abort();if(_fr){_fr.getRuntime().exec.call(this,'FileReader','destroy');_fr.disconnectRuntime()}self=_fr=null}});function _read(op,blob){_fr=new RuntimeTarget();function error(err){self.readyState=FileReader.DONE;self.error=err;self.trigger('error');loadEnd()}function loadEnd(){_fr.destroy();_fr=null;self.trigger('loadend')}function exec(runtime){_fr.bind('Error',function(e,err){error(err)});_fr.bind('Progress',function(e){self.result=runtime.exec.call(_fr,'FileReader','getResult');self.trigger(e)});_fr.bind('Load',function(e){self.readyState=FileReader.DONE;self.result=runtime.exec.call(_fr,'FileReader','getResult');self.trigger(e);loadEnd()});runtime.exec.call(_fr,'FileReader','read',op,blob)}this.convertEventPropsToHandlers(dispatches);if(this.readyState===FileReader.LOADING){return error(new x.DOMException(x.DOMException.INVALID_STATE_ERR))}this.readyState=FileReader.LOADING;this.trigger('loadstart');if(blob instanceof Blob){if(blob.isDetached()){var src=blob.getSource();switch(op){case'readAsText':case'readAsBinaryString':this.result=src;break;case'readAsDataURL':this.result='data:'+blob.type+';base64,'+Encode.btoa(src);break}this.readyState=FileReader.DONE;this.trigger('load');loadEnd()}else{exec(_fr.connectRuntime(blob.ruid))}}else{error(new x.DOMException(x.DOMException.NOT_FOUND_ERR))}}}FileReader.EMPTY=0;FileReader.LOADING=1;FileReader.DONE=2;FileReader.prototype=EventTarget.instance;return FileReader});define('moxie/core/utils/Url',[],function(){var parseUrl=function(url,currentUrl){var key=['source','scheme','authority','userInfo','user','pass','host','port','relative','path','directory','file','query','fragment'],i=key.length,ports={http:80,https:443},uri={},regex=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,m=regex.exec(url||'');while(i--){if(m[i]){uri[key[i]]=m[i]}}if(!uri.scheme){if(!currentUrl||typeof(currentUrl)==='string'){currentUrl=parseUrl(currentUrl||document.location.href)}uri.scheme=currentUrl.scheme;uri.host=currentUrl.host;uri.port=currentUrl.port;var path='';if(/^[^\/]/.test(uri.path)){path=currentUrl.path;if(!/(\/|\/[^\.]+)$/.test(path)){path=path.replace(/\/[^\/]+$/,'/')}else{path+='/'}}uri.path=path+(uri.path||'')}if(!uri.port){uri.port=ports[uri.scheme]||80}uri.port=parseInt(uri.port,10);if(!uri.path){uri.path="/"}delete uri.source;return uri};var resolveUrl=function(url){var ports={http:80,https:443},urlp=parseUrl(url);return urlp.scheme+'://'+urlp.host+(urlp.port!==ports[urlp.scheme]?':'+urlp.port:'')+urlp.path+(urlp.query?urlp.query:'')};var hasSameOrigin=function(url){function origin(url){return[url.scheme,url.host,url.port].join('/')}if(typeof url==='string'){url=parseUrl(url)}return origin(parseUrl())===origin(url)};return{parseUrl:parseUrl,resolveUrl:resolveUrl,hasSameOrigin:hasSameOrigin}});define('moxie/file/FileReaderSync',['moxie/core/utils/Basic','moxie/runtime/RuntimeClient','moxie/core/utils/Encode'],function(Basic,RuntimeClient,Encode){return function(){RuntimeClient.call(this);Basic.extend(this,{uid:Basic.guid('uid_'),readAsBinaryString:function(blob){return _read.call(this,'readAsBinaryString',blob)},readAsDataURL:function(blob){return _read.call(this,'readAsDataURL',blob)},readAsText:function(blob){return _read.call(this,'readAsText',blob)}});function _read(op,blob){if(blob.isDetached()){var src=blob.getSource();switch(op){case'readAsBinaryString':return src;case'readAsDataURL':return'data:'+blob.type+';base64,'+Encode.btoa(src);case'readAsText':var txt='';for(var i=0,length=src.length;i<length;i++){txt+=String.fromCharCode(src[i])}return txt}}else{var result=this.connectRuntime(blob.ruid).exec.call(this,'FileReaderSync','read',op,blob);this.disconnectRuntime();return result}}}});define("moxie/xhr/FormData",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/file/Blob"],function(x,Basic,Blob){function FormData(){var _blob,_fields=[];Basic.extend(this,{append:function(name,value){var self=this,valueType=Basic.typeOf(value);if(value instanceof Blob){_blob={name:name,value:value}}else if('array'===valueType){name+='[]';Basic.each(value,function(value){self.append(name,value)})}else if('object'===valueType){Basic.each(value,function(value,key){self.append(name+'['+key+']',value)})}else if('null'===valueType||'undefined'===valueType||'number'===valueType&&isNaN(value)){self.append(name,"false")}else{_fields.push({name:name,value:value.toString()})}},hasBlob:function(){return!!this.getBlob()},getBlob:function(){return _blob&&_blob.value||null},getBlobName:function(){return _blob&&_blob.name||null},each:function(cb){Basic.each(_fields,function(field){cb(field.value,field.name)});if(_blob){cb(_blob.value,_blob.name)}},destroy:function(){_blob=null;_fields=[]}})}return FormData});define("moxie/xhr/XMLHttpRequest",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/core/EventTarget","moxie/core/utils/Encode","moxie/core/utils/Url","moxie/runtime/Runtime","moxie/runtime/RuntimeTarget","moxie/file/Blob","moxie/file/FileReaderSync","moxie/xhr/FormData","moxie/core/utils/Env","moxie/core/utils/Mime"],function(Basic,x,EventTarget,Encode,Url,Runtime,RuntimeTarget,Blob,FileReaderSync,FormData,Env,Mime){var httpCode={100:'Continue',101:'Switching Protocols',102:'Processing',200:'OK',201:'Created',202:'Accepted',203:'Non-Authoritative Information',204:'No Content',205:'Reset Content',206:'Partial Content',207:'Multi-Status',226:'IM Used',300:'Multiple Choices',301:'Moved Permanently',302:'Found',303:'See Other',304:'Not Modified',305:'Use Proxy',306:'Reserved',307:'Temporary Redirect',400:'Bad Request',401:'Unauthorized',402:'Payment Required',403:'Forbidden',404:'Not Found',405:'Method Not Allowed',406:'Not Acceptable',407:'Proxy Authentication Required',408:'Request Timeout',409:'Conflict',410:'Gone',411:'Length Required',412:'Precondition Failed',413:'Request Entity Too Large',414:'Request-URI Too Long',415:'Unsupported Media Type',416:'Requested Range Not Satisfiable',417:'Expectation Failed',422:'Unprocessable Entity',423:'Locked',424:'Failed Dependency',426:'Upgrade Required',500:'Internal Server Error',501:'Not Implemented',502:'Bad Gateway',503:'Service Unavailable',504:'Gateway Timeout',505:'HTTP Version Not Supported',506:'Variant Also Negotiates',507:'Insufficient Storage',510:'Not Extended'};function XMLHttpRequestUpload(){this.uid=Basic.guid('uid_')}XMLHttpRequestUpload.prototype=EventTarget.instance;var dispatches=['loadstart','progress','abort','error','load','timeout','loadend'];var NATIVE=1,RUNTIME=2;function XMLHttpRequest(){var self=this,props={timeout:0,readyState:XMLHttpRequest.UNSENT,withCredentials:false,status:0,statusText:"",responseType:"",responseXML:null,responseText:null,response:null},_async=true,_url,_method,_headers={},_user,_password,_encoding=null,_mimeType=null,_sync_flag=false,_send_flag=false,_upload_events_flag=false,_upload_complete_flag=false,_error_flag=false,_same_origin_flag=false,_start_time,_timeoutset_time,_finalMime=null,_finalCharset=null,_options={},_xhr,_responseHeaders='',_responseHeadersBag;Basic.extend(this,props,{uid:Basic.guid('uid_'),upload:new XMLHttpRequestUpload(),open:function(method,url,async,user,password){var urlp;if(!method||!url){throw new x.DOMException(x.DOMException.SYNTAX_ERR);}if(/[\u0100-\uffff]/.test(method)||Encode.utf8_encode(method)!==method){throw new x.DOMException(x.DOMException.SYNTAX_ERR);}if(!!~Basic.inArray(method.toUpperCase(),['CONNECT','DELETE','GET','HEAD','OPTIONS','POST','PUT','TRACE','TRACK'])){_method=method.toUpperCase()}if(!!~Basic.inArray(_method,['CONNECT','TRACE','TRACK'])){throw new x.DOMException(x.DOMException.SECURITY_ERR);}url=Encode.utf8_encode(url);urlp=Url.parseUrl(url);_same_origin_flag=Url.hasSameOrigin(urlp);_url=Url.resolveUrl(url);if((user||password)&&!_same_origin_flag){throw new x.DOMException(x.DOMException.INVALID_ACCESS_ERR);}_user=user||urlp.user;_password=password||urlp.pass;_async=async||true;if(_async===false&&(_p('timeout')||_p('withCredentials')||_p('responseType')!=="")){throw new x.DOMException(x.DOMException.INVALID_ACCESS_ERR);}_sync_flag=!_async;_send_flag=false;_headers={};_reset.call(this);_p('readyState',XMLHttpRequest.OPENED);this.convertEventPropsToHandlers(['readystatechange']);this.dispatchEvent('readystatechange')},setRequestHeader:function(header,value){var uaHeaders=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"];if(_p('readyState')!==XMLHttpRequest.OPENED||_send_flag){throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);}if(/[\u0100-\uffff]/.test(header)||Encode.utf8_encode(header)!==header){throw new x.DOMException(x.DOMException.SYNTAX_ERR);}header=Basic.trim(header).toLowerCase();if(!!~Basic.inArray(header,uaHeaders)||/^(proxy\-|sec\-)/.test(header)){return false}if(!_headers[header]){_headers[header]=value}else{_headers[header]+=', '+value}return true},getAllResponseHeaders:function(){return _responseHeaders||''},getResponseHeader:function(header){header=header.toLowerCase();if(_error_flag||!!~Basic.inArray(header,['set-cookie','set-cookie2'])){return null}if(_responseHeaders&&_responseHeaders!==''){if(!_responseHeadersBag){_responseHeadersBag={};Basic.each(_responseHeaders.split(/\r\n/),function(line){var pair=line.split(/:\s+/);if(pair.length===2){pair[0]=Basic.trim(pair[0]);_responseHeadersBag[pair[0].toLowerCase()]={header:pair[0],value:Basic.trim(pair[1])}}})}if(_responseHeadersBag.hasOwnProperty(header)){return _responseHeadersBag[header].header+': '+_responseHeadersBag[header].value}}return null},overrideMimeType:function(mime){var matches,charset;if(!!~Basic.inArray(_p('readyState'),[XMLHttpRequest.LOADING,XMLHttpRequest.DONE])){throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);}mime=Basic.trim(mime.toLowerCase());if(/;/.test(mime)&&(matches=mime.match(/^([^;]+)(?:;\scharset\=)?(.*)$/))){mime=matches[1];if(matches[2]){charset=matches[2]}}if(!Mime.mimes[mime]){throw new x.DOMException(x.DOMException.SYNTAX_ERR);}_finalMime=mime;_finalCharset=charset},send:function(data,options){if(Basic.typeOf(options)==='string'){_options={ruid:options}}else if(!options){_options={}}else{_options=options}this.convertEventPropsToHandlers(dispatches);this.upload.convertEventPropsToHandlers(dispatches);if(this.readyState!==XMLHttpRequest.OPENED||_send_flag){throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);}if(data instanceof Blob){_options.ruid=data.ruid;_mimeType=data.type||'application/octet-stream'}else if(data instanceof FormData){if(data.hasBlob()){var blob=data.getBlob();_options.ruid=blob.ruid;_mimeType=blob.type||'application/octet-stream'}}else if(typeof data==='string'){_encoding='UTF-8';_mimeType='text/plain;charset=UTF-8';data=Encode.utf8_encode(data)}if(!this.withCredentials){this.withCredentials=(_options.required_caps&&_options.required_caps.send_browser_cookies)&&!_same_origin_flag}_upload_events_flag=(!_sync_flag&&this.upload.hasEventListener());_error_flag=false;_upload_complete_flag=!data;if(!_sync_flag){_send_flag=true}_doXHR.call(this,data)},abort:function(){_error_flag=true;_sync_flag=false;if(!~Basic.inArray(_p('readyState'),[XMLHttpRequest.UNSENT,XMLHttpRequest.OPENED,XMLHttpRequest.DONE])){_p('readyState',XMLHttpRequest.DONE);_send_flag=false;if(_xhr){_xhr.getRuntime().exec.call(_xhr,'XMLHttpRequest','abort',_upload_complete_flag)}else{throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);}_upload_complete_flag=true}else{_p('readyState',XMLHttpRequest.UNSENT)}},destroy:function(){if(_xhr){if(Basic.typeOf(_xhr.destroy)==='function'){_xhr.destroy()}_xhr=null}this.unbindAll();if(this.upload){this.upload.unbindAll();this.upload=null}}});function _p(prop,value){if(!props.hasOwnProperty(prop)){return}if(arguments.length===1){return Env.can('define_property')?props[prop]:self[prop]}else{if(Env.can('define_property')){props[prop]=value}else{self[prop]=value}}}function _doXHR(data){var self=this;_start_time=new Date().getTime();_xhr=new RuntimeTarget();function loadEnd(){_xhr.destroy();_xhr=null;self.dispatchEvent('loadend');self=null}function exec(runtime){_xhr.bind('LoadStart',function(e){_p('readyState',XMLHttpRequest.LOADING);self.dispatchEvent('readystatechange');self.dispatchEvent(e);if(_upload_events_flag){self.upload.dispatchEvent(e)}});_xhr.bind('Progress',function(e){if(_p('readyState')!==XMLHttpRequest.LOADING){_p('readyState',XMLHttpRequest.LOADING);self.dispatchEvent('readystatechange')}self.dispatchEvent(e)});_xhr.bind('UploadProgress',function(e){if(_upload_events_flag){self.upload.dispatchEvent({type:'progress',lengthComputable:false,total:e.total,loaded:e.loaded})}});_xhr.bind('Load',function(e){_p('readyState',XMLHttpRequest.DONE);_p('status',Number(runtime.exec.call(_xhr,'XMLHttpRequest','getStatus')||0));_p('statusText',httpCode[_p('status')]||"");_p('response',runtime.exec.call(_xhr,'XMLHttpRequest','getResponse',_p('responseType')));if(!!~Basic.inArray(_p('responseType'),['text',''])){_p('responseText',_p('response'))}else if(_p('responseType')==='document'){_p('responseXML',_p('response'))}_responseHeaders=runtime.exec.call(_xhr,'XMLHttpRequest','getAllResponseHeaders');self.dispatchEvent('readystatechange');if(_p('status')>0){if(_upload_events_flag){self.upload.dispatchEvent(e)}self.dispatchEvent(e)}else{_error_flag=true;self.dispatchEvent('error')}loadEnd()});_xhr.bind('Abort',function(e){self.dispatchEvent(e);loadEnd()});_xhr.bind('Error',function(e){_error_flag=true;_p('readyState',XMLHttpRequest.DONE);self.dispatchEvent('readystatechange');_upload_complete_flag=true;self.dispatchEvent(e);loadEnd()});runtime.exec.call(_xhr,'XMLHttpRequest','send',{url:_url,method:_method,async:_async,user:_user,password:_password,headers:_headers,mimeType:_mimeType,encoding:_encoding,responseType:self.responseType,withCredentials:self.withCredentials,options:_options},data)}if(typeof(_options.required_caps)==='string'){_options.required_caps=Runtime.parseCaps(_options.required_caps)}_options.required_caps=Basic.extend({},_options.required_caps,{return_response_type:self.responseType});if(data instanceof FormData){_options.required_caps.send_multipart=true}if(!_same_origin_flag){_options.required_caps.do_cors=true}if(_options.ruid){exec(_xhr.connectRuntime(_options))}else{_xhr.bind('RuntimeInit',function(e,runtime){exec(runtime)});_xhr.bind('RuntimeError',function(e,err){self.dispatchEvent('RuntimeError',err)});_xhr.connectRuntime(_options)}}function _reset(){_p('responseText',"");_p('responseXML',null);_p('response',null);_p('status',0);_p('statusText',"");_start_time=_timeoutset_time=null}}XMLHttpRequest.UNSENT=0;XMLHttpRequest.OPENED=1;XMLHttpRequest.HEADERS_RECEIVED=2;XMLHttpRequest.LOADING=3;XMLHttpRequest.DONE=4;XMLHttpRequest.prototype=EventTarget.instance;return XMLHttpRequest});define("moxie/runtime/Transporter",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(Basic,Encode,RuntimeClient,EventTarget){function Transporter(){var mod,_runtime,_data,_size,_pos,_chunk_size;RuntimeClient.call(this);Basic.extend(this,{uid:Basic.guid('uid_'),state:Transporter.IDLE,result:null,transport:function(data,type,options){var self=this;options=Basic.extend({chunk_size:204798},options);if((mod=options.chunk_size%3)){options.chunk_size+=3-mod}_chunk_size=options.chunk_size;_reset.call(this);_data=data;_size=data.length;if(Basic.typeOf(options)==='string'||options.ruid){_run.call(self,type,this.connectRuntime(options))}else{var cb=function(e,runtime){self.unbind("RuntimeInit",cb);_run.call(self,type,runtime)};this.bind("RuntimeInit",cb);this.connectRuntime(options)}},abort:function(){var self=this;self.state=Transporter.IDLE;if(_runtime){_runtime.exec.call(self,'Transporter','clear');self.trigger("TransportingAborted")}_reset.call(self)},destroy:function(){this.unbindAll();_runtime=null;this.disconnectRuntime();_reset.call(this)}});function _reset(){_size=_pos=0;_data=this.result=null}function _run(type,runtime){var self=this;_runtime=runtime;self.bind("TransportingProgress",function(e){_pos=e.loaded;if(_pos<_size&&Basic.inArray(self.state,[Transporter.IDLE,Transporter.DONE])===-1){_transport.call(self)}},999);self.bind("TransportingComplete",function(){_pos=_size;self.state=Transporter.DONE;_data=null;self.result=_runtime.exec.call(self,'Transporter','getAsBlob',type||'')},999);self.state=Transporter.BUSY;self.trigger("TransportingStarted");_transport.call(self)}function _transport(){var self=this,chunk,bytesLeft=_size-_pos;if(_chunk_size>bytesLeft){_chunk_size=bytesLeft}chunk=Encode.btoa(_data.substr(_pos,_chunk_size));_runtime.exec.call(self,'Transporter','receive',chunk,_size)}}Transporter.IDLE=0;Transporter.BUSY=1;Transporter.DONE=2;Transporter.prototype=EventTarget.instance;return Transporter});define("moxie/image/Image",["moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/file/FileReaderSync","moxie/xhr/XMLHttpRequest","moxie/runtime/Runtime","moxie/runtime/RuntimeClient","moxie/runtime/Transporter","moxie/core/utils/Env","moxie/core/EventTarget","moxie/file/Blob","moxie/file/File","moxie/core/utils/Encode"],function(Basic,Dom,x,FileReaderSync,XMLHttpRequest,Runtime,RuntimeClient,Transporter,Env,EventTarget,Blob,File,Encode){var dispatches=['progress','load','error','resize','embedded'];function Image(){RuntimeClient.call(this);Basic.extend(this,{uid:Basic.guid('uid_'),ruid:null,name:"",size:0,width:0,height:0,type:"",meta:{},clone:function(){this.load.apply(this,arguments)},load:function(){this.bind('Load Resize',function(){_updateInfo.call(this)},999);this.convertEventPropsToHandlers(dispatches);_load.apply(this,arguments)},downsize:function(width,height,crop,preserveHeaders){try{if(!this.size){throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);}if(this.width>Image.MAX_RESIZE_WIDTH||this.height>Image.MAX_RESIZE_HEIGHT){throw new x.ImageError(x.ImageError.MAX_RESOLUTION_ERR);}if(!width&&!height||Basic.typeOf(crop)==='undefined'){crop=false}width=width||this.width;height=height||this.height;preserveHeaders=(Basic.typeOf(preserveHeaders)==='undefined'?true:!!preserveHeaders);this.getRuntime().exec.call(this,'Image','downsize',width,height,crop,preserveHeaders)}catch(ex){this.trigger('error',ex)}},crop:function(width,height,preserveHeaders){this.downsize(width,height,true,preserveHeaders)},getAsCanvas:function(){if(!Env.can('create_canvas')){throw new x.RuntimeError(x.RuntimeError.NOT_SUPPORTED_ERR);}var runtime=this.connectRuntime(this.ruid);return runtime.exec.call(this,'Image','getAsCanvas')},getAsBlob:function(type,quality){if(!this.size){throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);}if(!type){type='image/jpeg'}if(type==='image/jpeg'&&!quality){quality=90}return this.getRuntime().exec.call(this,'Image','getAsBlob',type,quality)},getAsDataURL:function(type,quality){if(!this.size){throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);}return this.getRuntime().exec.call(this,'Image','getAsDataURL',type,quality)},getAsBinaryString:function(type,quality){var dataUrl=this.getAsDataURL(type,quality);return Encode.atob(dataUrl.substring(dataUrl.indexOf('base64,')+7))},embed:function(el){var self=this,imgCopy,type,quality,crop,options=arguments[1]||{},width=this.width,height=this.height,runtime;function onResize(){if(Env.can('create_canvas')){var canvas=imgCopy.getAsCanvas();if(canvas){el.appendChild(canvas);canvas=null;imgCopy.destroy();self.trigger('embedded');return}}var dataUrl=imgCopy.getAsDataURL(type,quality);if(!dataUrl){throw new x.ImageError(x.ImageError.WRONG_FORMAT);}if(Env.can('use_data_uri_of',dataUrl.length)){el.innerHTML='<img src="'+dataUrl+'" width="'+imgCopy.width+'" height="'+imgCopy.height+'" />';imgCopy.destroy();self.trigger('embedded')}else{var tr=new Transporter();tr.bind("TransportingComplete",function(){runtime=self.connectRuntime(this.result.ruid);self.bind("Embedded",function(){Basic.extend(runtime.getShimContainer().style,{top:'0px',left:'0px',width:imgCopy.width+'px',height:imgCopy.height+'px'});runtime=null},999);runtime.exec.call(self,"ImageView","display",this.result.uid,width,height);imgCopy.destroy()});tr.transport(Encode.atob(dataUrl.substring(dataUrl.indexOf('base64,')+7)),type,Basic.extend({},options,{required_caps:{display_media:true},runtime_order:'flash,silverlight',container:el}))}}try{if(!(el=Dom.get(el))){throw new x.DOMException(x.DOMException.INVALID_NODE_TYPE_ERR);}if(!this.size){throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);}if(this.width>Image.MAX_RESIZE_WIDTH||this.height>Image.MAX_RESIZE_HEIGHT){throw new x.ImageError(x.ImageError.MAX_RESOLUTION_ERR);}type=options.type||this.type||'image/jpeg';quality=options.quality||90;crop=Basic.typeOf(options.crop)!=='undefined'?options.crop:false;if(options.width){width=options.width;height=options.height||width}else{var dimensions=Dom.getSize(el);if(dimensions.w&&dimensions.h){width=dimensions.w;height=dimensions.h}}imgCopy=new Image();imgCopy.bind("Resize",function(){onResize.call(self)});imgCopy.bind("Load",function(){imgCopy.downsize(width,height,crop,false)});imgCopy.clone(this,false);return imgCopy}catch(ex){this.trigger('error',ex)}},destroy:function(){if(this.ruid){this.getRuntime().exec.call(this,'Image','destroy');this.disconnectRuntime()}this.unbindAll()}});function _updateInfo(info){if(!info){info=this.getRuntime().exec.call(this,'Image','getInfo')}this.size=info.size;this.width=info.width;this.height=info.height;this.type=info.type;this.meta=info.meta;if(this.name===''){this.name=info.name}}function _load(src){var srcType=Basic.typeOf(src);try{if(src instanceof Image){if(!src.size){throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);}_loadFromImage.apply(this,arguments)}else if(src instanceof Blob){if(!~Basic.inArray(src.type,['image/jpeg','image/png'])){throw new x.ImageError(x.ImageError.WRONG_FORMAT);}_loadFromBlob.apply(this,arguments)}else if(Basic.inArray(srcType,['blob','file'])!==-1){_load.call(this,new File(null,src),arguments[1])}else if(srcType==='string'){if(/^data:[^;]*;base64,/.test(src)){_load.call(this,new Blob(null,{data:src}),arguments[1])}else{_loadFromUrl.apply(this,arguments)}}else if(srcType==='node'&&src.nodeName.toLowerCase()==='img'){_load.call(this,src.src,arguments[1])}else{throw new x.DOMException(x.DOMException.TYPE_MISMATCH_ERR);}}catch(ex){this.trigger('error',ex)}}function _loadFromImage(img,exact){var runtime=this.connectRuntime(img.ruid);this.ruid=runtime.uid;runtime.exec.call(this,'Image','loadFromImage',img,(Basic.typeOf(exact)==='undefined'?true:exact))}function _loadFromBlob(blob,options){var self=this;self.name=blob.name||'';function exec(runtime){self.ruid=runtime.uid;runtime.exec.call(self,'Image','loadFromBlob',blob)}if(blob.isDetached()){this.bind('RuntimeInit',function(e,runtime){exec(runtime)});if(options&&typeof(options.required_caps)==='string'){options.required_caps=Runtime.parseCaps(options.required_caps)}this.connectRuntime(Basic.extend({required_caps:{access_image_binary:true,resize_image:true}},options))}else{exec(this.connectRuntime(blob.ruid))}}function _loadFromUrl(url,options){var self=this,xhr;xhr=new XMLHttpRequest();xhr.open('get',url);xhr.responseType='blob';xhr.onprogress=function(e){self.trigger(e)};xhr.onload=function(){_loadFromBlob.call(self,xhr.response,true)};xhr.onerror=function(e){self.trigger(e)};xhr.onloadend=function(){xhr.destroy()};xhr.bind('RuntimeError',function(e,err){self.trigger('RuntimeError',err)});xhr.send(null,options)}}Image.MAX_RESIZE_WIDTH=6500;Image.MAX_RESIZE_HEIGHT=6500;Image.prototype=EventTarget.instance;return Image});define("moxie/runtime/html5/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(Basic,x,Runtime,Env){var type="html5",extensions={};function Html5Runtime(options){var I=this,Test=Runtime.capTest,True=Runtime.capTrue;var caps=Basic.extend({access_binary:Test(window.FileReader||window.File&&window.File.getAsDataURL),access_image_binary:function(){return I.can('access_binary')&&!!extensions.Image},display_media:Test(Env.can('create_canvas')||Env.can('use_data_uri_over32kb')),do_cors:Test(window.XMLHttpRequest&&'withCredentials'in new XMLHttpRequest()),drag_and_drop:Test(function(){var div=document.createElement('div');return(('draggable'in div)||('ondragstart'in div&&'ondrop'in div))&&(Env.browser!=='IE'||Env.version>9)}()),filter_by_extension:Test(function(){return(Env.browser==='Chrome'&&Env.version>=28)||(Env.browser==='IE'&&Env.version>=10)}()),return_response_headers:True,return_response_type:function(responseType){if(responseType==='json'&&!!window.JSON){return true}return Env.can('return_response_type',responseType)},return_status_code:True,report_upload_progress:Test(window.XMLHttpRequest&&new XMLHttpRequest().upload),resize_image:function(){return I.can('access_binary')&&Env.can('create_canvas')},select_file:function(){return Env.can('use_fileinput')&&window.File},select_folder:function(){return I.can('select_file')&&Env.browser==='Chrome'&&Env.version>=21},select_multiple:function(){return I.can('select_file')&&!(Env.browser==='Safari'&&Env.os==='Windows')&&!(Env.os==='iOS'&&Env.verComp(Env.osVersion,"7.0.4",'<'))},send_binary_string:Test(window.XMLHttpRequest&&(new XMLHttpRequest().sendAsBinary||(window.Uint8Array&&window.ArrayBuffer))),send_custom_headers:Test(window.XMLHttpRequest),send_multipart:function(){return!!(window.XMLHttpRequest&&new XMLHttpRequest().upload&&window.FormData)||I.can('send_binary_string')},slice_blob:Test(window.File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),stream_upload:function(){return I.can('slice_blob')&&I.can('send_multipart')},summon_file_dialog:Test(function(){return(Env.browser==='Firefox'&&Env.version>=4)||(Env.browser==='Opera'&&Env.version>=12)||(Env.browser==='IE'&&Env.version>=10)||!!~Basic.inArray(Env.browser,['Chrome','Safari'])}()),upload_filesize:True},arguments[2]);Runtime.call(this,options,(arguments[1]||type),caps);Basic.extend(this,{init:function(){this.trigger("Init")},destroy:(function(destroy){return function(){destroy.call(I);destroy=I=null}}(this.destroy))});Basic.extend(this.getShim(),extensions)}Runtime.addConstructor(type,Html5Runtime);return extensions});define("moxie/runtime/html5/file/Blob",["moxie/runtime/html5/Runtime","moxie/file/Blob"],function(extensions,Blob){function HTML5Blob(){function w3cBlobSlice(blob,start,end){var blobSlice;if(window.File.prototype.slice){try{blob.slice();return blob.slice(start,end)}catch(e){return blob.slice(start,end-start)}}else if((blobSlice=window.File.prototype.webkitSlice||window.File.prototype.mozSlice)){return blobSlice.call(blob,start,end)}else{return null}}this.slice=function(){return new Blob(this.getRuntime().uid,w3cBlobSlice.apply(this,arguments))}}return(extensions.Blob=HTML5Blob)});define('moxie/core/utils/Events',['moxie/core/utils/Basic'],function(Basic){var eventhash={},uid='moxie_'+Basic.guid();function preventDefault(){this.returnValue=false}function stopPropagation(){this.cancelBubble=true}var addEvent=function(obj,name,callback,key){var func,events;name=name.toLowerCase();if(obj.addEventListener){func=callback;obj.addEventListener(name,func,false)}else if(obj.attachEvent){func=function(){var evt=window.event;if(!evt.target){evt.target=evt.srcElement}evt.preventDefault=preventDefault;evt.stopPropagation=stopPropagation;callback(evt)};obj.attachEvent('on'+name,func)}if(!obj[uid]){obj[uid]=Basic.guid()}if(!eventhash.hasOwnProperty(obj[uid])){eventhash[obj[uid]]={}}events=eventhash[obj[uid]];if(!events.hasOwnProperty(name)){events[name]=[]}events[name].push({func:func,orig:callback,key:key})};var removeEvent=function(obj,name,callback){var type,undef;name=name.toLowerCase();if(obj[uid]&&eventhash[obj[uid]]&&eventhash[obj[uid]][name]){type=eventhash[obj[uid]][name]}else{return}for(var i=type.length-1;i>=0;i--){if(type[i].orig===callback||type[i].key===callback){if(obj.removeEventListener){obj.removeEventListener(name,type[i].func,false)}else if(obj.detachEvent){obj.detachEvent('on'+name,type[i].func)}type[i].orig=null;type[i].func=null;type.splice(i,1);if(callback!==undef){break}}}if(!type.length){delete eventhash[obj[uid]][name]}if(Basic.isEmptyObj(eventhash[obj[uid]])){delete eventhash[obj[uid]];try{delete obj[uid]}catch(e){obj[uid]=undef}}};var removeAllEvents=function(obj,key){if(!obj||!obj[uid]){return}Basic.each(eventhash[obj[uid]],function(events,name){removeEvent(obj,name,key)})};return{addEvent:addEvent,removeEvent:removeEvent,removeAllEvents:removeAllEvents}});define("moxie/runtime/html5/file/FileInput",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime","moxie/core/utils/Env"],function(extensions,Basic,Dom,Events,Mime,Env){function FileInput(){var _files=[],_options;Basic.extend(this,{init:function(options){var comp=this,I=comp.getRuntime(),input,shimContainer,mimes,browseButton,zIndex,top;_options=options;_files=[];mimes=_options.accept.mimes||Mime.extList2mimes(_options.accept,I.can('filter_by_extension'));shimContainer=I.getShimContainer();shimContainer.innerHTML='<input id="'+I.uid+'" type="file" style="font-size:999px;opacity:0;"'+(_options.multiple&&I.can('select_multiple')?'multiple':'')+(_options.directory&&I.can('select_folder')?'webkitdirectory directory':'')+(mimes?' accept="'+mimes.join(',')+'"':'')+' />';input=Dom.get(I.uid);Basic.extend(input.style,{position:'absolute',top:0,left:0,width:'100%',height:'100%'});browseButton=Dom.get(_options.browse_button);if(I.can('summon_file_dialog')){if(Dom.getStyle(browseButton,'position')==='static'){browseButton.style.position='relative'}zIndex=parseInt(Dom.getStyle(browseButton,'z-index'),10)||1;browseButton.style.zIndex=zIndex;shimContainer.style.zIndex=zIndex-1;Events.addEvent(browseButton,'click',function(e){var input=Dom.get(I.uid);if(input&&!input.disabled){input.click()}e.preventDefault()},comp.uid)}top=I.can('summon_file_dialog')?browseButton:shimContainer;Events.addEvent(top,'mouseover',function(){comp.trigger('mouseenter')},comp.uid);Events.addEvent(top,'mouseout',function(){comp.trigger('mouseleave')},comp.uid);Events.addEvent(top,'mousedown',function(){comp.trigger('mousedown')},comp.uid);Events.addEvent(Dom.get(_options.container),'mouseup',function(){comp.trigger('mouseup')},comp.uid);input.onchange=function onChange(){_files=[];if(_options.directory){Basic.each(this.files,function(file){if(file.name!=="."){_files.push(file)}})}else{_files=[].slice.call(this.files)}if(Env.browser!=='IE'){this.value=''}else{var clone=this.cloneNode(true);this.parentNode.replaceChild(clone,this);clone.onchange=onChange}comp.trigger('change')};comp.trigger({type:'ready',async:true});shimContainer=null},getFiles:function(){return _files},disable:function(state){var I=this.getRuntime(),input;if((input=Dom.get(I.uid))){input.disabled=!!state}},destroy:function(){var I=this.getRuntime(),shim=I.getShim(),shimContainer=I.getShimContainer();Events.removeAllEvents(shimContainer,this.uid);Events.removeAllEvents(_options&&Dom.get(_options.container),this.uid);Events.removeAllEvents(_options&&Dom.get(_options.browse_button),this.uid);if(shimContainer){shimContainer.innerHTML=''}shim.removeInstance(this.uid);_files=_options=shimContainer=shim=null}})}return(extensions.FileInput=FileInput)});define("moxie/runtime/html5/file/FileDrop",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime"],function(extensions,Basic,Dom,Events,Mime){function FileDrop(){var _files=[],_allowedExts=[],_options;Basic.extend(this,{init:function(options){var comp=this,dropZone;_options=options;_allowedExts=_extractExts(_options.accept);dropZone=_options.container;Events.addEvent(dropZone,'dragover',function(e){e.preventDefault();e.stopPropagation();e.dataTransfer.dropEffect='copy'},comp.uid);Events.addEvent(dropZone,'drop',function(e){e.preventDefault();e.stopPropagation();_files=[];if(e.dataTransfer.items&&e.dataTransfer.items[0].webkitGetAsEntry){_readItems(e.dataTransfer.items,function(){comp.trigger("drop")})}else{Basic.each(e.dataTransfer.files,function(file){if(_isAcceptable(file)){_files.push(file)}});comp.trigger("drop")}},comp.uid);Events.addEvent(dropZone,'dragenter',function(e){e.preventDefault();e.stopPropagation();comp.trigger("dragenter")},comp.uid);Events.addEvent(dropZone,'dragleave',function(e){e.preventDefault();e.stopPropagation();comp.trigger("dragleave")},comp.uid)},getFiles:function(){return _files},destroy:function(){Events.removeAllEvents(_options&&Dom.get(_options.container),this.uid);_files=_allowedExts=_options=null}});function _extractExts(accept){var exts=[];for(var i=0;i<accept.length;i++){[].push.apply(exts,accept[i].extensions.split(/\s*,\s*/))}return Basic.inArray('*',exts)===-1?exts:[]}function _isAcceptable(file){var ext=Mime.getFileExtension(file.name);return!ext||!_allowedExts.length||Basic.inArray(ext,_allowedExts)!==-1}function _readItems(items,cb){var entries=[];Basic.each(items,function(item){var entry=item.webkitGetAsEntry();if(entry){if(entry.isFile){var file=item.getAsFile();if(_isAcceptable(file)){_files.push(file)}}else{entries.push(entry)}}});if(entries.length){_readEntries(entries,cb)}else{cb()}}function _readEntries(entries,cb){var queue=[];Basic.each(entries,function(entry){queue.push(function(cbcb){_readEntry(entry,cbcb)})});Basic.inSeries(queue,function(){cb()})}function _readEntry(entry,cb){if(entry.isFile){entry.file(function(file){if(_isAcceptable(file)){_files.push(file)}cb()},function(){cb()})}else if(entry.isDirectory){_readDirEntry(entry,cb)}else{cb()}}function _readDirEntry(dirEntry,cb){var entries=[],dirReader=dirEntry.createReader();function getEntries(cbcb){dirReader.readEntries(function(moreEntries){if(moreEntries.length){[].push.apply(entries,moreEntries);getEntries(cbcb)}else{cbcb()}},cbcb)}getEntries(function(){_readEntries(entries,cb)})}}return(extensions.FileDrop=FileDrop)});define("moxie/runtime/html5/file/FileReader",["moxie/runtime/html5/Runtime","moxie/core/utils/Encode","moxie/core/utils/Basic"],function(extensions,Encode,Basic){function FileReader(){var _fr,_convertToBinary=false;Basic.extend(this,{read:function(op,blob){var target=this;_fr=new window.FileReader();_fr.addEventListener('progress',function(e){target.trigger(e)});_fr.addEventListener('load',function(e){target.trigger(e)});_fr.addEventListener('error',function(e){target.trigger(e,_fr.error)});_fr.addEventListener('loadend',function(){_fr=null});if(Basic.typeOf(_fr[op])==='function'){_convertToBinary=false;_fr[op](blob.getSource())}else if(op==='readAsBinaryString'){_convertToBinary=true;_fr.readAsDataURL(blob.getSource())}},getResult:function(){return _fr&&_fr.result?(_convertToBinary?_toBinary(_fr.result):_fr.result):null},abort:function(){if(_fr){_fr.abort()}},destroy:function(){_fr=null}});function _toBinary(str){return Encode.atob(str.substring(str.indexOf('base64,')+7))}}return(extensions.FileReader=FileReader)});define("moxie/runtime/html5/xhr/XMLHttpRequest",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/utils/Mime","moxie/core/utils/Url","moxie/file/File","moxie/file/Blob","moxie/xhr/FormData","moxie/core/Exceptions","moxie/core/utils/Env"],function(extensions,Basic,Mime,Url,File,Blob,FormData,x,Env){function XMLHttpRequest(){var self=this,_xhr,_filename;Basic.extend(this,{send:function(meta,data){var target=this,isGecko2_5_6=(Env.browser==='Mozilla'&&Env.version>=4&&Env.version<7),isAndroidBrowser=Env.browser==='Android Browser',mustSendAsBinary=false;_filename=meta.url.replace(/^.+?\/([\w\-\.]+)$/,'$1').toLowerCase();_xhr=_getNativeXHR();_xhr.open(meta.method,meta.url,meta.async,meta.user,meta.password);if(data instanceof Blob){if(data.isDetached()){mustSendAsBinary=true}data=data.getSource()}else if(data instanceof FormData){if(data.hasBlob()){if(data.getBlob().isDetached()){data=_prepareMultipart.call(target,data);mustSendAsBinary=true}else if((isGecko2_5_6||isAndroidBrowser)&&Basic.typeOf(data.getBlob().getSource())==='blob'&&window.FileReader){_preloadAndSend.call(target,meta,data);return}}if(data instanceof FormData){var fd=new window.FormData();data.each(function(value,name){if(value instanceof Blob){fd.append(name,value.getSource())}else{fd.append(name,value)}});data=fd}}if(_xhr.upload){if(meta.withCredentials){_xhr.withCredentials=true}_xhr.addEventListener('load',function(e){target.trigger(e)});_xhr.addEventListener('error',function(e){target.trigger(e)});_xhr.addEventListener('progress',function(e){target.trigger(e)});_xhr.upload.addEventListener('progress',function(e){target.trigger({type:'UploadProgress',loaded:e.loaded,total:e.total})})}else{_xhr.onreadystatechange=function onReadyStateChange(){switch(_xhr.readyState){case 1:break;case 2:break;case 3:var total,loaded;try{if(Url.hasSameOrigin(meta.url)){total=_xhr.getResponseHeader('Content-Length')||0}if(_xhr.responseText){loaded=_xhr.responseText.length}}catch(ex){total=loaded=0}target.trigger({type:'progress',lengthComputable:!!total,total:parseInt(total,10),loaded:loaded});break;case 4:_xhr.onreadystatechange=function(){};if(_xhr.status===0){target.trigger('error')}else{target.trigger('load')}break}}}if(!Basic.isEmptyObj(meta.headers)){Basic.each(meta.headers,function(value,header){_xhr.setRequestHeader(header,value)})}if(""!==meta.responseType&&'responseType'in _xhr){if('json'===meta.responseType&&!Env.can('return_response_type','json')){_xhr.responseType='text'}else{_xhr.responseType=meta.responseType}}if(!mustSendAsBinary){_xhr.send(data)}else{if(_xhr.sendAsBinary){_xhr.sendAsBinary(data)}else{(function(){var ui8a=new Uint8Array(data.length);for(var i=0;i<data.length;i++){ui8a[i]=(data.charCodeAt(i)&0xff)}_xhr.send(ui8a.buffer)}())}}target.trigger('loadstart')},getStatus:function(){try{if(_xhr){return _xhr.status}}catch(ex){}return 0},getResponse:function(responseType){var I=this.getRuntime();try{switch(responseType){case'blob':var file=new File(I.uid,_xhr.response);var disposition=_xhr.getResponseHeader('Content-Disposition');if(disposition){var match=disposition.match(/filename=([\'\"'])([^\1]+)\1/);if(match){_filename=match[2]}}file.name=_filename;if(!file.type){file.type=Mime.getFileMime(_filename)}return file;case'json':if(!Env.can('return_response_type','json')){return _xhr.status===200&&!!window.JSON?JSON.parse(_xhr.responseText):null}return _xhr.response;case'document':return _getDocument(_xhr);default:return _xhr.responseText!==''?_xhr.responseText:null}}catch(ex){return null}},getAllResponseHeaders:function(){try{return _xhr.getAllResponseHeaders()}catch(ex){}return''},abort:function(){if(_xhr){_xhr.abort()}},destroy:function(){self=_filename=null}});function _preloadAndSend(meta,data){var target=this,blob,fr;blob=data.getBlob().getSource();fr=new window.FileReader();fr.onload=function(){data.append(data.getBlobName(),new Blob(null,{type:blob.type,data:fr.result}));self.send.call(target,meta,data)};fr.readAsBinaryString(blob)}function _getNativeXHR(){if(window.XMLHttpRequest&&!(Env.browser==='IE'&&Env.version<8)){return new window.XMLHttpRequest()}else{return(function(){var progIDs=['Msxml2.XMLHTTP.6.0','Microsoft.XMLHTTP'];for(var i=0;i<progIDs.length;i++){try{return new ActiveXObject(progIDs[i])}catch(ex){}}})()}}function _getDocument(xhr){var rXML=xhr.responseXML;var rText=xhr.responseText;if(Env.browser==='IE'&&rText&&rXML&&!rXML.documentElement&&/[^\/]+\/[^\+]+\+xml/.test(xhr.getResponseHeader("Content-Type"))){rXML=new window.ActiveXObject("Microsoft.XMLDOM");rXML.async=false;rXML.validateOnParse=false;rXML.loadXML(rText)}if(rXML){if((Env.browser==='IE'&&rXML.parseError!==0)||!rXML.documentElement||rXML.documentElement.tagName==="parsererror"){return null}}return rXML}function _prepareMultipart(fd){var boundary='----moxieboundary'+new Date().getTime(),dashdash='--',crlf='\r\n',multipart='',I=this.getRuntime();if(!I.can('send_binary_string')){throw new x.RuntimeError(x.RuntimeError.NOT_SUPPORTED_ERR);}_xhr.setRequestHeader('Content-Type','multipart/form-data; boundary='+boundary);fd.each(function(value,name){if(value instanceof Blob){multipart+=dashdash+boundary+crlf+'Content-Disposition: form-data; name="'+name+'"; filename="'+unescape(encodeURIComponent(value.name||'blob'))+'"'+crlf+'Content-Type: '+(value.type||'application/octet-stream')+crlf+crlf+value.getSource()+crlf}else{multipart+=dashdash+boundary+crlf+'Content-Disposition: form-data; name="'+name+'"'+crlf+crlf+unescape(encodeURIComponent(value))+crlf}});multipart+=dashdash+boundary+dashdash+crlf;return multipart}}return(extensions.XMLHttpRequest=XMLHttpRequest)});define("moxie/runtime/html5/utils/BinaryReader",[],function(){return function(){var II=false,bin;function read(idx,size){var mv=II?0:-8*(size-1),sum=0,i;for(i=0;i<size;i++){sum|=(bin.charCodeAt(idx+i)<<Math.abs(mv+i*8))}return sum}function putstr(segment,idx,length){length=arguments.length===3?length:bin.length-idx-1;bin=bin.substr(0,idx)+segment+bin.substr(length+idx)}function write(idx,num,size){var str='',mv=II?0:-8*(size-1),i;for(i=0;i<size;i++){str+=String.fromCharCode((num>>Math.abs(mv+i*8))&255)}putstr(str,idx,size)}return{II:function(order){if(order===undefined){return II}else{II=order}},init:function(binData){II=false;bin=binData},SEGMENT:function(idx,length,segment){switch(arguments.length){case 1:return bin.substr(idx,bin.length-idx-1);case 2:return bin.substr(idx,length);case 3:putstr(segment,idx,length);break;default:return bin}},BYTE:function(idx){return read(idx,1)},SHORT:function(idx){return read(idx,2)},LONG:function(idx,num){if(num===undefined){return read(idx,4)}else{write(idx,num,4)}},SLONG:function(idx){var num=read(idx,4);return(num>2147483647?num-4294967296:num)},STRING:function(idx,size){var str='';for(size+=idx;idx<size;idx++){str+=String.fromCharCode(read(idx,1))}return str}}}});define("moxie/runtime/html5/image/JPEGHeaders",["moxie/runtime/html5/utils/BinaryReader"],function(BinaryReader){return function JPEGHeaders(data){var headers=[],read,idx,marker,length=0;read=new BinaryReader();read.init(data);if(read.SHORT(0)!==0xFFD8){return}idx=2;while(idx<=data.length){marker=read.SHORT(idx);if(marker>=0xFFD0&&marker<=0xFFD7){idx+=2;continue}if(marker===0xFFDA||marker===0xFFD9){break}length=read.SHORT(idx+2)+2;if(marker>=0xFFE1&&marker<=0xFFEF){headers.push({hex:marker,name:'APP'+(marker&0x000F),start:idx,length:length,segment:read.SEGMENT(idx,length)})}idx+=length}read.init(null);return{headers:headers,restore:function(data){var max,i;read.init(data);idx=read.SHORT(2)==0xFFE0?4+read.SHORT(4):2;for(i=0,max=headers.length;i<max;i++){read.SEGMENT(idx,0,headers[i].segment);idx+=headers[i].length}data=read.SEGMENT();read.init(null);return data},strip:function(data){var headers,jpegHeaders,i;jpegHeaders=new JPEGHeaders(data);headers=jpegHeaders.headers;jpegHeaders.purge();read.init(data);i=headers.length;while(i--){read.SEGMENT(headers[i].start,headers[i].length,'')}data=read.SEGMENT();read.init(null);return data},get:function(name){var array=[];for(var i=0,max=headers.length;i<max;i++){if(headers[i].name===name.toUpperCase()){array.push(headers[i].segment)}}return array},set:function(name,segment){var array=[],i,ii,max;if(typeof(segment)==='string'){array.push(segment)}else{array=segment}for(i=ii=0,max=headers.length;i<max;i++){if(headers[i].name===name.toUpperCase()){headers[i].segment=array[ii];headers[i].length=array[ii].length;ii++}if(ii>=array.length){break}}},purge:function(){headers=[];read.init(null);read=null}}}});define("moxie/runtime/html5/image/ExifParser",["moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader"],function(Basic,BinaryReader){return function ExifParser(){var data,tags,Tiff,offsets={},tagDescs;data=new BinaryReader();tags={tiff:{0x0112:'Orientation',0x010E:'ImageDescription',0x010F:'Make',0x0110:'Model',0x0131:'Software',0x8769:'ExifIFDPointer',0x8825:'GPSInfoIFDPointer'},exif:{0x9000:'ExifVersion',0xA001:'ColorSpace',0xA002:'PixelXDimension',0xA003:'PixelYDimension',0x9003:'DateTimeOriginal',0x829A:'ExposureTime',0x829D:'FNumber',0x8827:'ISOSpeedRatings',0x9201:'ShutterSpeedValue',0x9202:'ApertureValue',0x9207:'MeteringMode',0x9208:'LightSource',0x9209:'Flash',0x920A:'FocalLength',0xA402:'ExposureMode',0xA403:'WhiteBalance',0xA406:'SceneCaptureType',0xA404:'DigitalZoomRatio',0xA408:'Contrast',0xA409:'Saturation',0xA40A:'Sharpness'},gps:{0x0000:'GPSVersionID',0x0001:'GPSLatitudeRef',0x0002:'GPSLatitude',0x0003:'GPSLongitudeRef',0x0004:'GPSLongitude'}};tagDescs={'ColorSpace':{1:'sRGB',0:'Uncalibrated'},'MeteringMode':{0:'Unknown',1:'Average',2:'CenterWeightedAverage',3:'Spot',4:'MultiSpot',5:'Pattern',6:'Partial',255:'Other'},'LightSource':{1:'Daylight',2:'Fliorescent',3:'Tungsten',4:'Flash',9:'Fine weather',10:'Cloudy weather',11:'Shade',12:'Daylight fluorescent (D 5700 - 7100K)',13:'Day white fluorescent (N 4600 -5400K)',14:'Cool white fluorescent (W 3900 - 4500K)',15:'White fluorescent (WW 3200 - 3700K)',17:'Standard light A',18:'Standard light B',19:'Standard light C',20:'D55',21:'D65',22:'D75',23:'D50',24:'ISO studio tungsten',255:'Other'},'Flash':{0x0000:'Flash did not fire.',0x0001:'Flash fired.',0x0005:'Strobe return light not detected.',0x0007:'Strobe return light detected.',0x0009:'Flash fired, compulsory flash mode',0x000D:'Flash fired, compulsory flash mode, return light not detected',0x000F:'Flash fired, compulsory flash mode, return light detected',0x0010:'Flash did not fire, compulsory flash mode',0x0018:'Flash did not fire, auto mode',0x0019:'Flash fired, auto mode',0x001D:'Flash fired, auto mode, return light not detected',0x001F:'Flash fired, auto mode, return light detected',0x0020:'No flash function',0x0041:'Flash fired, red-eye reduction mode',0x0045:'Flash fired, red-eye reduction mode, return light not detected',0x0047:'Flash fired, red-eye reduction mode, return light detected',0x0049:'Flash fired, compulsory flash mode, red-eye reduction mode',0x004D:'Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected',0x004F:'Flash fired, compulsory flash mode, red-eye reduction mode, return light detected',0x0059:'Flash fired, auto mode, red-eye reduction mode',0x005D:'Flash fired, auto mode, return light not detected, red-eye reduction mode',0x005F:'Flash fired, auto mode, return light detected, red-eye reduction mode'},'ExposureMode':{0:'Auto exposure',1:'Manual exposure',2:'Auto bracket'},'WhiteBalance':{0:'Auto white balance',1:'Manual white balance'},'SceneCaptureType':{0:'Standard',1:'Landscape',2:'Portrait',3:'Night scene'},'Contrast':{0:'Normal',1:'Soft',2:'Hard'},'Saturation':{0:'Normal',1:'Low saturation',2:'High saturation'},'Sharpness':{0:'Normal',1:'Soft',2:'Hard'},'GPSLatitudeRef':{N:'North latitude',S:'South latitude'},'GPSLongitudeRef':{E:'East longitude',W:'West longitude'}};function extractTags(IFD_offset,tags2extract){var length=data.SHORT(IFD_offset),i,ii,tag,type,count,tagOffset,offset,value,values=[],hash={};for(i=0;i<length;i++){offset=tagOffset=IFD_offset+12*i+2;tag=tags2extract[data.SHORT(offset)];if(tag===undefined){continue}type=data.SHORT(offset+=2);count=data.LONG(offset+=2);offset+=4;values=[];switch(type){case 1:case 7:if(count>4){offset=data.LONG(offset)+offsets.tiffHeader}for(ii=0;ii<count;ii++){values[ii]=data.BYTE(offset+ii)}break;case 2:if(count>4){offset=data.LONG(offset)+offsets.tiffHeader}hash[tag]=data.STRING(offset,count-1);continue;case 3:if(count>2){offset=data.LONG(offset)+offsets.tiffHeader}for(ii=0;ii<count;ii++){values[ii]=data.SHORT(offset+ii*2)}break;case 4:if(count>1){offset=data.LONG(offset)+offsets.tiffHeader}for(ii=0;ii<count;ii++){values[ii]=data.LONG(offset+ii*4)}break;case 5:offset=data.LONG(offset)+offsets.tiffHeader;for(ii=0;ii<count;ii++){values[ii]=data.LONG(offset+ii*4)/data.LONG(offset+ii*4+4)}break;case 9:offset=data.LONG(offset)+offsets.tiffHeader;for(ii=0;ii<count;ii++){values[ii]=data.SLONG(offset+ii*4)}break;case 10:offset=data.LONG(offset)+offsets.tiffHeader;for(ii=0;ii<count;ii++){values[ii]=data.SLONG(offset+ii*4)/data.SLONG(offset+ii*4+4)}break;default:continue}value=(count==1?values[0]:values);if(tagDescs.hasOwnProperty(tag)&&typeof value!='object'){hash[tag]=tagDescs[tag][value]}else{hash[tag]=value}}return hash}function getIFDOffsets(){var idx=offsets.tiffHeader;data.II(data.SHORT(idx)==0x4949);if(data.SHORT(idx+=2)!==0x002A){return false}offsets.IFD0=offsets.tiffHeader+data.LONG(idx+=2);Tiff=extractTags(offsets.IFD0,tags.tiff);if('ExifIFDPointer'in Tiff){offsets.exifIFD=offsets.tiffHeader+Tiff.ExifIFDPointer;delete Tiff.ExifIFDPointer}if('GPSInfoIFDPointer'in Tiff){offsets.gpsIFD=offsets.tiffHeader+Tiff.GPSInfoIFDPointer;delete Tiff.GPSInfoIFDPointer}return true}function setTag(ifd,tag,value){var offset,length,tagOffset,valueOffset=0;if(typeof(tag)==='string'){var tmpTags=tags[ifd.toLowerCase()];for(var hex in tmpTags){if(tmpTags[hex]===tag){tag=hex;break}}}offset=offsets[ifd.toLowerCase()+'IFD'];length=data.SHORT(offset);for(var i=0;i<length;i++){tagOffset=offset+12*i+2;if(data.SHORT(tagOffset)==tag){valueOffset=tagOffset+8;break}}if(!valueOffset){return false}data.LONG(valueOffset,value);return true}return{init:function(segment){offsets={tiffHeader:10};if(segment===undefined||!segment.length){return false}data.init(segment);if(data.SHORT(0)===0xFFE1&&data.STRING(4,5).toUpperCase()==="EXIF\0"){return getIFDOffsets()}return false},TIFF:function(){return Tiff},EXIF:function(){var Exif;Exif=extractTags(offsets.exifIFD,tags.exif);if(Exif.ExifVersion&&Basic.typeOf(Exif.ExifVersion)==='array'){for(var i=0,exifVersion='';i<Exif.ExifVersion.length;i++){exifVersion+=String.fromCharCode(Exif.ExifVersion[i])}Exif.ExifVersion=exifVersion}return Exif},GPS:function(){var GPS;GPS=extractTags(offsets.gpsIFD,tags.gps);if(GPS.GPSVersionID&&Basic.typeOf(GPS.GPSVersionID)==='array'){GPS.GPSVersionID=GPS.GPSVersionID.join('.')}return GPS},setExif:function(tag,value){if(tag!=='PixelXDimension'&&tag!=='PixelYDimension'){return false}return setTag('exif',tag,value)},getBinary:function(){return data.SEGMENT()},purge:function(){data.init(null);data=Tiff=null;offsets={}}}}});define("moxie/runtime/html5/image/JPEG",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEGHeaders","moxie/runtime/html5/utils/BinaryReader","moxie/runtime/html5/image/ExifParser"],function(Basic,x,JPEGHeaders,BinaryReader,ExifParser){function JPEG(binstr){var _binstr,_br,_hm,_ep,_info,hasExif;function _getDimensions(){var idx=0,marker,length;while(idx<=_binstr.length){marker=_br.SHORT(idx+=2);if(marker>=0xFFC0&&marker<=0xFFC3){idx+=5;return{height:_br.SHORT(idx),width:_br.SHORT(idx+=2)}}length=_br.SHORT(idx+=2);idx+=length-2}return null}_binstr=binstr;_br=new BinaryReader();_br.init(_binstr);if(_br.SHORT(0)!==0xFFD8){throw new x.ImageError(x.ImageError.WRONG_FORMAT);}_hm=new JPEGHeaders(binstr);_ep=new ExifParser();hasExif=!!_ep.init(_hm.get('app1')[0]);_info=_getDimensions.call(this);Basic.extend(this,{type:'image/jpeg',size:_binstr.length,width:_info&&_info.width||0,height:_info&&_info.height||0,setExif:function(tag,value){if(!hasExif){return false}if(Basic.typeOf(tag)==='object'){Basic.each(tag,function(value,tag){_ep.setExif(tag,value)})}else{_ep.setExif(tag,value)}_hm.set('app1',_ep.getBinary())},writeHeaders:function(){if(!arguments.length){return(_binstr=_hm.restore(_binstr))}return _hm.restore(arguments[0])},stripHeaders:function(binstr){return _hm.strip(binstr)},purge:function(){_purge.call(this)}});if(hasExif){this.meta={tiff:_ep.TIFF(),exif:_ep.EXIF(),gps:_ep.GPS()}}function _purge(){if(!_ep||!_hm||!_br){return}_ep.purge();_hm.purge();_br.init(null);_binstr=_info=_hm=_ep=_br=null}}return JPEG});define("moxie/runtime/html5/image/PNG",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader"],function(x,Basic,BinaryReader){function PNG(binstr){var _binstr,_br,_hm,_ep,_info;_binstr=binstr;_br=new BinaryReader();_br.init(_binstr);(function(){var idx=0,i=0,signature=[0x8950,0x4E47,0x0D0A,0x1A0A];for(i=0;i<signature.length;i++,idx+=2){if(signature[i]!=_br.SHORT(idx)){throw new x.ImageError(x.ImageError.WRONG_FORMAT);}}}());function _getDimensions(){var chunk,idx;chunk=_getChunkAt.call(this,8);if(chunk.type=='IHDR'){idx=chunk.start;return{width:_br.LONG(idx),height:_br.LONG(idx+=4)}}return null}function _purge(){if(!_br){return}_br.init(null);_binstr=_info=_hm=_ep=_br=null}_info=_getDimensions.call(this);Basic.extend(this,{type:'image/png',size:_binstr.length,width:_info.width,height:_info.height,purge:function(){_purge.call(this)}});_purge.call(this);function _getChunkAt(idx){var length,type,start,CRC;length=_br.LONG(idx);type=_br.STRING(idx+=4,4);start=idx+=4;CRC=_br.LONG(idx+length);return{length:length,type:type,start:start,CRC:CRC}}}return PNG});define("moxie/runtime/html5/image/ImageInfo",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEG","moxie/runtime/html5/image/PNG"],function(Basic,x,JPEG,PNG){return function(binstr){var _cs=[JPEG,PNG],_img;_img=(function(){for(var i=0;i<_cs.length;i++){try{return new _cs[i](binstr)}catch(ex){}}throw new x.ImageError(x.ImageError.WRONG_FORMAT);}());Basic.extend(this,{type:'',size:0,width:0,height:0,setExif:function(){},writeHeaders:function(data){return data},stripHeaders:function(data){return data},purge:function(){}});Basic.extend(this,_img);this.purge=function(){_img.purge();_img=null}}});define("moxie/runtime/html5/image/MegaPixel",[],function(){function renderImageToCanvas(img,canvas,options){var iw=img.naturalWidth,ih=img.naturalHeight;var width=options.width,height=options.height;var x=options.x||0,y=options.y||0;var ctx=canvas.getContext('2d');if(detectSubsampling(img)){iw/=2;ih/=2}var d=1024;var tmpCanvas=document.createElement('canvas');tmpCanvas.width=tmpCanvas.height=d;var tmpCtx=tmpCanvas.getContext('2d');var vertSquashRatio=detectVerticalSquash(img,iw,ih);var sy=0;while(sy<ih){var sh=sy+d>ih?ih-sy:d;var sx=0;while(sx<iw){var sw=sx+d>iw?iw-sx:d;tmpCtx.clearRect(0,0,d,d);tmpCtx.drawImage(img,-sx,-sy);var dx=(sx*width/iw+x)<<0;var dw=Math.ceil(sw*width/iw);var dy=(sy*height/ih/vertSquashRatio+y)<<0;var dh=Math.ceil(sh*height/ih/vertSquashRatio);ctx.drawImage(tmpCanvas,0,0,sw,sh,dx,dy,dw,dh);sx+=d}sy+=d}tmpCanvas=tmpCtx=null}function detectSubsampling(img){var iw=img.naturalWidth,ih=img.naturalHeight;if(iw*ih>1024*1024){var canvas=document.createElement('canvas');canvas.width=canvas.height=1;var ctx=canvas.getContext('2d');ctx.drawImage(img,-iw+1,0);return ctx.getImageData(0,0,1,1).data[3]===0}else{return false}}function detectVerticalSquash(img,iw,ih){var canvas=document.createElement('canvas');canvas.width=1;canvas.height=ih;var ctx=canvas.getContext('2d');ctx.drawImage(img,0,0);var data=ctx.getImageData(0,0,1,ih).data;var sy=0;var ey=ih;var py=ih;while(py>sy){var alpha=data[(py-1)*4+3];if(alpha===0){ey=py}else{sy=py}py=(ey+sy)>>1}canvas=null;var ratio=(py/ih);return(ratio===0)?1:ratio}return{isSubsampled:detectSubsampling,renderTo:renderImageToCanvas}});define("moxie/runtime/html5/image/Image",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/Exceptions","moxie/core/utils/Encode","moxie/file/File","moxie/runtime/html5/image/ImageInfo","moxie/runtime/html5/image/MegaPixel","moxie/core/utils/Mime","moxie/core/utils/Env"],function(extensions,Basic,x,Encode,File,ImageInfo,MegaPixel,Mime,Env){function HTML5Image(){var me=this,_img,_imgInfo,_canvas,_binStr,_blob,_modified=false,_preserveHeaders=true;Basic.extend(this,{loadFromBlob:function(blob){var comp=this,I=comp.getRuntime(),asBinary=arguments.length>1?arguments[1]:true;if(!I.can('access_binary')){throw new x.RuntimeError(x.RuntimeError.NOT_SUPPORTED_ERR);}_blob=blob;if(blob.isDetached()){_binStr=blob.getSource();_preload.call(this,_binStr);return}else{_readAsDataUrl.call(this,blob.getSource(),function(dataUrl){if(asBinary){_binStr=_toBinary(dataUrl)}_preload.call(comp,dataUrl)})}},loadFromImage:function(img,exact){this.meta=img.meta;_blob=new File(null,{name:img.name,size:img.size,type:img.type});_preload.call(this,exact?(_binStr=img.getAsBinaryString()):img.getAsDataURL())},getInfo:function(){var I=this.getRuntime(),info;if(!_imgInfo&&_binStr&&I.can('access_image_binary')){_imgInfo=new ImageInfo(_binStr)}info={width:_getImg().width||0,height:_getImg().height||0,type:_blob.type||Mime.getFileMime(_blob.name),size:_binStr&&_binStr.length||_blob.size||0,name:_blob.name||'',meta:_imgInfo&&_imgInfo.meta||this.meta||{}};return info},downsize:function(){_downsize.apply(this,arguments)},getAsCanvas:function(){if(_canvas){_canvas.id=this.uid+'_canvas'}return _canvas},getAsBlob:function(type,quality){if(type!==this.type){_downsize.call(this,this.width,this.height,false)}return new File(null,{name:_blob.name||'',type:type,data:me.getAsBinaryString.call(this,type,quality)})},getAsDataURL:function(type){var quality=arguments[1]||90;if(!_modified){return _img.src}if('image/jpeg'!==type){return _canvas.toDataURL('image/png')}else{try{return _canvas.toDataURL('image/jpeg',quality/100)}catch(ex){return _canvas.toDataURL('image/jpeg')}}},getAsBinaryString:function(type,quality){if(!_modified){if(!_binStr){_binStr=_toBinary(me.getAsDataURL(type,quality))}return _binStr}if('image/jpeg'!==type){_binStr=_toBinary(me.getAsDataURL(type,quality))}else{var dataUrl;if(!quality){quality=90}try{dataUrl=_canvas.toDataURL('image/jpeg',quality/100)}catch(ex){dataUrl=_canvas.toDataURL('image/jpeg')}_binStr=_toBinary(dataUrl);if(_imgInfo){_binStr=_imgInfo.stripHeaders(_binStr);if(_preserveHeaders){if(_imgInfo.meta&&_imgInfo.meta.exif){_imgInfo.setExif({PixelXDimension:this.width,PixelYDimension:this.height})}_binStr=_imgInfo.writeHeaders(_binStr)}_imgInfo.purge();_imgInfo=null}}_modified=false;return _binStr},destroy:function(){me=null;_purge.call(this);this.getRuntime().getShim().removeInstance(this.uid)}});function _getImg(){if(!_canvas&&!_img){throw new x.ImageError(x.DOMException.INVALID_STATE_ERR);}return _canvas||_img}function _toBinary(str){return Encode.atob(str.substring(str.indexOf('base64,')+7))}function _toDataUrl(str,type){return'data:'+(type||'')+';base64,'+Encode.btoa(str)}function _preload(str){var comp=this;_img=new Image();_img.onerror=function(){_purge.call(this);comp.trigger('error',new x.ImageError(x.ImageError.WRONG_FORMAT))};_img.onload=function(){comp.trigger('load')};_img.src=/^data:[^;]*;base64,/.test(str)?str:_toDataUrl(str,_blob.type)}function _readAsDataUrl(file,callback){var comp=this,fr;if(window.FileReader){fr=new FileReader();fr.onload=function(){callback(this.result)};fr.onerror=function(){comp.trigger('error',new x.FileException(x.FileException.NOT_READABLE_ERR))};fr.readAsDataURL(file)}else{return callback(file.getAsDataURL())}}function _downsize(width,height,crop,preserveHeaders){var self=this,scale,mathFn,x=0,y=0,img,destWidth,destHeight,orientation;_preserveHeaders=preserveHeaders;orientation=(this.meta&&this.meta.tiff&&this.meta.tiff.Orientation)||1;if(Basic.inArray(orientation,[5,6,7,8])!==-1){var tmp=width;width=height;height=tmp}img=_getImg();mathFn=!crop?Math.min:Math.max;scale=mathFn(width/img.width,height/img.height);if(scale>1&&(!crop||preserveHeaders)){this.trigger('Resize');return}if(!_canvas){_canvas=document.createElement("canvas")}destWidth=Math.round(img.width*scale);destHeight=Math.round(img.height*scale);if(crop){_canvas.width=width;_canvas.height=height;if(destWidth>width){x=Math.round((destWidth-width)/2)}if(destHeight>height){y=Math.round((destHeight-height)/2)}}else{_canvas.width=destWidth;_canvas.height=destHeight}if(!_preserveHeaders){_rotateToOrientaion(_canvas.width,_canvas.height,orientation)}_drawToCanvas.call(this,img,_canvas,-x,-y,destWidth,destHeight);this.width=_canvas.width;this.height=_canvas.height;_modified=true;self.trigger('Resize')}function _drawToCanvas(img,canvas,x,y,w,h){if(Env.OS==='iOS'){MegaPixel.renderTo(img,canvas,{width:w,height:h,x:x,y:y})}else{var ctx=canvas.getContext('2d');ctx.drawImage(img,x,y,w,h)}}function _rotateToOrientaion(width,height,orientation){switch(orientation){case 5:case 6:case 7:case 8:_canvas.width=height;_canvas.height=width;break;default:_canvas.width=width;_canvas.height=height}var ctx=_canvas.getContext('2d');switch(orientation){case 2:ctx.translate(width,0);ctx.scale(-1,1);break;case 3:ctx.translate(width,height);ctx.rotate(Math.PI);break;case 4:ctx.translate(0,height);ctx.scale(1,-1);break;case 5:ctx.rotate(0.5*Math.PI);ctx.scale(1,-1);break;case 6:ctx.rotate(0.5*Math.PI);ctx.translate(0,-height);break;case 7:ctx.rotate(0.5*Math.PI);ctx.translate(width,-height);ctx.scale(-1,1);break;case 8:ctx.rotate(-0.5*Math.PI);ctx.translate(-width,0);break}}function _purge(){if(_imgInfo){_imgInfo.purge();_imgInfo=null}_binStr=_img=_canvas=_blob=null;_modified=false}}return(extensions.Image=HTML5Image)});define("moxie/runtime/flash/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(Basic,Env,Dom,x,Runtime){var type='flash',extensions={};function getShimVersion(){var version;try{version=navigator.plugins['Shockwave Flash'];version=version.description}catch(e1){try{version=new ActiveXObject('ShockwaveFlash.ShockwaveFlash').GetVariable('$version')}catch(e2){version='0.0'}}version=version.match(/\d+/g);return parseFloat(version[0]+'.'+version[1])}function FlashRuntime(options){var I=this,initTimer;options=Basic.extend({swf_url:Env.swf_url},options);Runtime.call(this,options,type,{access_binary:function(value){return value&&I.mode==='browser'},access_image_binary:function(value){return value&&I.mode==='browser'},display_media:Runtime.capTrue,do_cors:Runtime.capTrue,drag_and_drop:false,report_upload_progress:function(){return I.mode==='client'},resize_image:Runtime.capTrue,return_response_headers:false,return_response_type:function(responseType){if(responseType==='json'&&!!window.JSON){return true}return!Basic.arrayDiff(responseType,['','text','document'])||I.mode==='browser'},return_status_code:function(code){return I.mode==='browser'||!Basic.arrayDiff(code,[200,404])},select_file:Runtime.capTrue,select_multiple:Runtime.capTrue,send_binary_string:function(value){return value&&I.mode==='browser'},send_browser_cookies:function(value){return value&&I.mode==='browser'},send_custom_headers:function(value){return value&&I.mode==='browser'},send_multipart:Runtime.capTrue,slice_blob:Runtime.capTrue,stream_upload:function(value){return value&&I.mode==='browser'},summon_file_dialog:false,upload_filesize:function(size){return Basic.parseSizeStr(size)<=2097152||I.mode==='client'},use_http_method:function(methods){return!Basic.arrayDiff(methods,['GET','POST'])}},{access_binary:function(value){return value?'browser':'client'},access_image_binary:function(value){return value?'browser':'client'},report_upload_progress:function(value){return value?'browser':'client'},return_response_type:function(responseType){return Basic.arrayDiff(responseType,['','text','json','document'])?'browser':['client','browser']},return_status_code:function(code){return Basic.arrayDiff(code,[200,404])?'browser':['client','browser']},send_binary_string:function(value){return value?'browser':'client'},send_browser_cookies:function(value){return value?'browser':'client'},send_custom_headers:function(value){return value?'browser':'client'},stream_upload:function(value){return value?'client':'browser'},upload_filesize:function(size){return Basic.parseSizeStr(size)>=2097152?'client':'browser'}},'client');if(getShimVersion()<10){this.mode=false}Basic.extend(this,{getShim:function(){return Dom.get(this.uid)},shimExec:function(component,action){var args=[].slice.call(arguments,2);return I.getShim().exec(this.uid,component,action,args)},init:function(){var html,el,container;container=this.getShimContainer();Basic.extend(container.style,{position:'absolute',top:'-8px',left:'-8px',width:'9px',height:'9px',overflow:'hidden'});html='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+options.swf_url+'" ';if(Env.browser==='IE'){html+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '}html+='width="100%" height="100%" style="outline:0">'+'<param name="movie" value="'+options.swf_url+'" />'+'<param name="flashvars" value="uid='+escape(this.uid)+'&target='+Env.global_event_dispatcher+'" />'+'<param name="wmode" value="transparent" />'+'<param name="allowscriptaccess" value="always" />'+'</object>';if(Env.browser==='IE'){el=document.createElement('div');container.appendChild(el);el.outerHTML=html;el=container=null}else{container.innerHTML=html}initTimer=setTimeout(function(){if(I&&!I.initialized){I.trigger("Error",new x.RuntimeError(x.RuntimeError.NOT_INIT_ERR))}},5000)},destroy:(function(destroy){return function(){destroy.call(I);clearTimeout(initTimer);options=initTimer=destroy=I=null}}(this.destroy))},extensions)}Runtime.addConstructor(type,FlashRuntime);return extensions});define("moxie/runtime/flash/file/Blob",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(extensions,Blob){var FlashBlob={slice:function(blob,start,end,type){var self=this.getRuntime();if(start<0){start=Math.max(blob.size+start,0)}else if(start>0){start=Math.min(start,blob.size)}if(end<0){end=Math.max(blob.size+end,0)}else if(end>0){end=Math.min(end,blob.size)}blob=self.shimExec.call(this,'Blob','slice',start,end,type||'');if(blob){blob=new Blob(self.uid,blob)}return blob}};return(extensions.Blob=FlashBlob)});define("moxie/runtime/flash/file/FileInput",["moxie/runtime/flash/Runtime"],function(extensions){var FileInput={init:function(options){this.getRuntime().shimExec.call(this,'FileInput','init',{name:options.name,accept:options.accept,multiple:options.multiple});this.trigger('ready')}};return(extensions.FileInput=FileInput)});define("moxie/runtime/flash/file/FileReader",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(extensions,Encode){var _result='';function _formatData(data,op){switch(op){case'readAsText':return Encode.atob(data,'utf8');case'readAsBinaryString':return Encode.atob(data);case'readAsDataURL':return data}return null}var FileReader={read:function(op,blob){var target=this,self=target.getRuntime();if(op==='readAsDataURL'){_result='data:'+(blob.type||'')+';base64,'}target.bind('Progress',function(e,data){if(data){_result+=_formatData(data,op)}});return self.shimExec.call(this,'FileReader','readAsBase64',blob.uid)},getResult:function(){return _result},destroy:function(){_result=null}};return(extensions.FileReader=FileReader)});define("moxie/runtime/flash/file/FileReaderSync",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(extensions,Encode){function _formatData(data,op){switch(op){case'readAsText':return Encode.atob(data,'utf8');case'readAsBinaryString':return Encode.atob(data);case'readAsDataURL':return data}return null}var FileReaderSync={read:function(op,blob){var result,self=this.getRuntime();result=self.shimExec.call(this,'FileReaderSync','readAsBase64',blob.uid);if(!result){return null}if(op==='readAsDataURL'){result='data:'+(blob.type||'')+';base64,'+result}return _formatData(result,op,blob.type)}};return(extensions.FileReaderSync=FileReaderSync)});define("moxie/runtime/flash/xhr/XMLHttpRequest",["moxie/runtime/flash/Runtime","moxie/core/utils/Basic","moxie/file/Blob","moxie/file/File","moxie/file/FileReaderSync","moxie/xhr/FormData","moxie/runtime/Transporter"],function(extensions,Basic,Blob,File,FileReaderSync,FormData,Transporter){var XMLHttpRequest={send:function(meta,data){var target=this,self=target.getRuntime();function send(){meta.transport=self.mode;self.shimExec.call(target,'XMLHttpRequest','send',meta,data)}function appendBlob(name,blob){self.shimExec.call(target,'XMLHttpRequest','appendBlob',name,blob.uid);data=null;send()}function attachBlob(blob,cb){var tr=new Transporter();tr.bind("TransportingComplete",function(){cb(this.result)});tr.transport(blob.getSource(),blob.type,{ruid:self.uid})}if(!Basic.isEmptyObj(meta.headers)){Basic.each(meta.headers,function(value,header){self.shimExec.call(target,'XMLHttpRequest','setRequestHeader',header,value.toString())})}if(data instanceof FormData){var blobField;data.each(function(value,name){if(value instanceof Blob){blobField=name}else{self.shimExec.call(target,'XMLHttpRequest','append',name,value)}});if(!data.hasBlob()){data=null;send()}else{var blob=data.getBlob();if(blob.isDetached()){attachBlob(blob,function(attachedBlob){blob.destroy();appendBlob(blobField,attachedBlob)})}else{appendBlob(blobField,blob)}}}else if(data instanceof Blob){if(data.isDetached()){attachBlob(data,function(attachedBlob){data.destroy();data=attachedBlob.uid;send()})}else{data=data.uid;send()}}else{send()}},getResponse:function(responseType){var frs,blob,self=this.getRuntime();blob=self.shimExec.call(this,'XMLHttpRequest','getResponseAsBlob');if(blob){blob=new File(self.uid,blob);if('blob'===responseType){return blob}try{frs=new FileReaderSync();if(!!~Basic.inArray(responseType,["","text"])){return frs.readAsText(blob)}else if('json'===responseType&&!!window.JSON){return JSON.parse(frs.readAsText(blob))}}finally{blob.destroy()}}return null},abort:function(upload_complete_flag){var self=this.getRuntime();self.shimExec.call(this,'XMLHttpRequest','abort');this.dispatchEvent('readystatechange');this.dispatchEvent('abort')}};return(extensions.XMLHttpRequest=XMLHttpRequest)});define("moxie/runtime/flash/runtime/Transporter",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(extensions,Blob){var Transporter={getAsBlob:function(type){var self=this.getRuntime(),blob=self.shimExec.call(this,'Transporter','getAsBlob',type);if(blob){return new Blob(self.uid,blob)}return null}};return(extensions.Transporter=Transporter)});define("moxie/runtime/flash/image/Image",["moxie/runtime/flash/Runtime","moxie/core/utils/Basic","moxie/runtime/Transporter","moxie/file/Blob","moxie/file/FileReaderSync"],function(extensions,Basic,Transporter,Blob,FileReaderSync){var Image={loadFromBlob:function(blob){var comp=this,self=comp.getRuntime();function exec(srcBlob){self.shimExec.call(comp,'Image','loadFromBlob',srcBlob.uid);comp=self=null}if(blob.isDetached()){var tr=new Transporter();tr.bind("TransportingComplete",function(){exec(tr.result.getSource())});tr.transport(blob.getSource(),blob.type,{ruid:self.uid})}else{exec(blob.getSource())}},loadFromImage:function(img){var self=this.getRuntime();return self.shimExec.call(this,'Image','loadFromImage',img.uid)},getAsBlob:function(type,quality){var self=this.getRuntime(),blob=self.shimExec.call(this,'Image','getAsBlob',type,quality);if(blob){return new Blob(self.uid,blob)}return null},getAsDataURL:function(){var self=this.getRuntime(),blob=self.Image.getAsBlob.apply(this,arguments),frs;if(!blob){return null}frs=new FileReaderSync();return frs.readAsDataURL(blob)}};return(extensions.Image=Image)});define("moxie/runtime/silverlight/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(Basic,Env,Dom,x,Runtime){var type="silverlight",extensions={};function isInstalled(version){var isVersionSupported=false,control=null,actualVer,actualVerArray,reqVerArray,requiredVersionPart,actualVersionPart,index=0;try{try{control=new ActiveXObject('AgControl.AgControl');if(control.IsVersionSupported(version)){isVersionSupported=true}control=null}catch(e){var plugin=navigator.plugins["Silverlight Plug-In"];if(plugin){actualVer=plugin.description;if(actualVer==="1.0.30226.2"){actualVer="2.0.30226.2"}actualVerArray=actualVer.split(".");while(actualVerArray.length>3){actualVerArray.pop()}while(actualVerArray.length<4){actualVerArray.push(0)}reqVerArray=version.split(".");while(reqVerArray.length>4){reqVerArray.pop()}do{requiredVersionPart=parseInt(reqVerArray[index],10);actualVersionPart=parseInt(actualVerArray[index],10);index++}while(index<reqVerArray.length&&requiredVersionPart===actualVersionPart);if(requiredVersionPart<=actualVersionPart&&!isNaN(requiredVersionPart)){isVersionSupported=true}}}}catch(e2){isVersionSupported=false}return isVersionSupported}function SilverlightRuntime(options){var I=this,initTimer;options=Basic.extend({xap_url:Env.xap_url},options);Runtime.call(this,options,type,{access_binary:Runtime.capTrue,access_image_binary:Runtime.capTrue,display_media:Runtime.capTrue,do_cors:Runtime.capTrue,drag_and_drop:false,report_upload_progress:Runtime.capTrue,resize_image:Runtime.capTrue,return_response_headers:function(value){return value&&I.mode==='client'},return_response_type:function(responseType){if(responseType!=='json'){return true}else{return!!window.JSON}},return_status_code:function(code){return I.mode==='client'||!Basic.arrayDiff(code,[200,404])},select_file:Runtime.capTrue,select_multiple:Runtime.capTrue,send_binary_string:Runtime.capTrue,send_browser_cookies:function(value){return value&&I.mode==='browser'},send_custom_headers:function(value){return value&&I.mode==='client'},send_multipart:Runtime.capTrue,slice_blob:Runtime.capTrue,stream_upload:true,summon_file_dialog:false,upload_filesize:Runtime.capTrue,use_http_method:function(methods){return I.mode==='client'||!Basic.arrayDiff(methods,['GET','POST'])}},{return_response_headers:function(value){return value?'client':'browser'},return_status_code:function(code){return Basic.arrayDiff(code,[200,404])?'client':['client','browser']},send_browser_cookies:function(value){return value?'browser':'client'},send_custom_headers:function(value){return value?'client':'browser'},use_http_method:function(methods){return Basic.arrayDiff(methods,['GET','POST'])?'client':['client','browser']}});if(!isInstalled('2.0.31005.0')||Env.browser==='Opera'){this.mode=false}Basic.extend(this,{getShim:function(){return Dom.get(this.uid).content.Moxie},shimExec:function(component,action){var args=[].slice.call(arguments,2);return I.getShim().exec(this.uid,component,action,args)},init:function(){var container;container=this.getShimContainer();container.innerHTML='<object id="'+this.uid+'" data="data:application/x-silverlight," type="application/x-silverlight-2" width="100%" height="100%" style="outline:none;">'+'<param name="source" value="'+options.xap_url+'"/>'+'<param name="background" value="Transparent"/>'+'<param name="windowless" value="true"/>'+'<param name="enablehtmlaccess" value="true"/>'+'<param name="initParams" value="uid='+this.uid+',target='+Env.global_event_dispatcher+'"/>'+'</object>';initTimer=setTimeout(function(){if(I&&!I.initialized){I.trigger("Error",new x.RuntimeError(x.RuntimeError.NOT_INIT_ERR))}},Env.OS!=='Windows'?10000:5000)},destroy:(function(destroy){return function(){destroy.call(I);clearTimeout(initTimer);options=initTimer=destroy=I=null}}(this.destroy))},extensions)}Runtime.addConstructor(type,SilverlightRuntime);return extensions});define("moxie/runtime/silverlight/file/Blob",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/Blob"],function(extensions,Basic,Blob){return(extensions.Blob=Basic.extend({},Blob))});define("moxie/runtime/silverlight/file/FileInput",["moxie/runtime/silverlight/Runtime"],function(extensions){var FileInput={init:function(options){function toFilters(accept){var filter='';for(var i=0;i<accept.length;i++){filter+=(filter!==''?'|':'')+accept[i].title+" | *."+accept[i].extensions.replace(/,/g,';*.')}return filter}this.getRuntime().shimExec.call(this,'FileInput','init',toFilters(options.accept),options.name,options.multiple);this.trigger('ready')}};return(extensions.FileInput=FileInput)});define("moxie/runtime/silverlight/file/FileDrop",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Dom","moxie/core/utils/Events"],function(extensions,Dom,Events){var FileDrop={init:function(){var comp=this,self=comp.getRuntime(),dropZone;dropZone=self.getShimContainer();Events.addEvent(dropZone,'dragover',function(e){e.preventDefault();e.stopPropagation();e.dataTransfer.dropEffect='copy'},comp.uid);Events.addEvent(dropZone,'dragenter',function(e){e.preventDefault();var flag=Dom.get(self.uid).dragEnter(e);if(flag){e.stopPropagation()}},comp.uid);Events.addEvent(dropZone,'drop',function(e){e.preventDefault();var flag=Dom.get(self.uid).dragDrop(e);if(flag){e.stopPropagation()}},comp.uid);return self.shimExec.call(this,'FileDrop','init')}};return(extensions.FileDrop=FileDrop)});define("moxie/runtime/silverlight/file/FileReader",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReader"],function(extensions,Basic,FileReader){return(extensions.FileReader=Basic.extend({},FileReader))});define("moxie/runtime/silverlight/file/FileReaderSync",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReaderSync"],function(extensions,Basic,FileReaderSync){return(extensions.FileReaderSync=Basic.extend({},FileReaderSync))});define("moxie/runtime/silverlight/xhr/XMLHttpRequest",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/xhr/XMLHttpRequest"],function(extensions,Basic,XMLHttpRequest){return(extensions.XMLHttpRequest=Basic.extend({},XMLHttpRequest))});define("moxie/runtime/silverlight/runtime/Transporter",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/runtime/Transporter"],function(extensions,Basic,Transporter){return(extensions.Transporter=Basic.extend({},Transporter))});define("moxie/runtime/silverlight/image/Image",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/image/Image"],function(extensions,Basic,Image){return(extensions.Image=Basic.extend({},Image,{getInfo:function(){var self=this.getRuntime(),grps=['tiff','exif','gps'],info={meta:{}},rawInfo=self.shimExec.call(this,'Image','getInfo');if(rawInfo.meta){Basic.each(grps,function(grp){var meta=rawInfo.meta[grp],tag,i,length,value;if(meta&&meta.keys){info.meta[grp]={};for(i=0,length=meta.keys.length;i<length;i++){tag=meta.keys[i];value=meta[tag];if(value){if(/^(\d|[1-9]\d+)$/.test(value)){value=parseInt(value,10)}else if(/^\d*\.\d+$/.test(value)){value=parseFloat(value)}info.meta[grp][tag]=value}}}})}info.width=parseInt(rawInfo.width,10);info.height=parseInt(rawInfo.height,10);info.size=parseInt(rawInfo.size,10);info.type=rawInfo.type;info.name=rawInfo.name;return info}}))});define("moxie/runtime/html4/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(Basic,x,Runtime,Env){var type='html4',extensions={};function Html4Runtime(options){var I=this,Test=Runtime.capTest,True=Runtime.capTrue;Runtime.call(this,options,type,{access_binary:Test(window.FileReader||window.File&&File.getAsDataURL),access_image_binary:false,display_media:Test(extensions.Image&&(Env.can('create_canvas')||Env.can('use_data_uri_over32kb'))),do_cors:false,drag_and_drop:false,filter_by_extension:Test(function(){return(Env.browser==='Chrome'&&Env.version>=28)||(Env.browser==='IE'&&Env.version>=10)}()),resize_image:function(){return extensions.Image&&I.can('access_binary')&&Env.can('create_canvas')},report_upload_progress:false,return_response_headers:false,return_response_type:function(responseType){if(responseType==='json'&&!!window.JSON){return true}return!!~Basic.inArray(responseType,['text','document',''])},return_status_code:function(code){return!Basic.arrayDiff(code,[200,404])},select_file:function(){return Env.can('use_fileinput')},select_multiple:false,send_binary_string:false,send_custom_headers:false,send_multipart:true,slice_blob:false,stream_upload:function(){return I.can('select_file')},summon_file_dialog:Test(function(){return(Env.browser==='Firefox'&&Env.version>=4)||(Env.browser==='Opera'&&Env.version>=12)||!!~Basic.inArray(Env.browser,['Chrome','Safari'])}()),upload_filesize:True,use_http_method:function(methods){return!Basic.arrayDiff(methods,['GET','POST'])}});Basic.extend(this,{init:function(){this.trigger("Init")},destroy:(function(destroy){return function(){destroy.call(I);destroy=I=null}}(this.destroy))});Basic.extend(this.getShim(),extensions)}Runtime.addConstructor(type,Html4Runtime);return extensions});define("moxie/runtime/html4/file/FileInput",["moxie/runtime/html4/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime","moxie/core/utils/Env"],function(extensions,Basic,Dom,Events,Mime,Env){function FileInput(){var _uid,_files=[],_mimes=[],_options;function addInput(){var comp=this,I=comp.getRuntime(),shimContainer,browseButton,currForm,form,input,uid;uid=Basic.guid('uid_');shimContainer=I.getShimContainer();if(_uid){currForm=Dom.get(_uid+'_form');if(currForm){Basic.extend(currForm.style,{top:'100%'})}}form=document.createElement('form');form.setAttribute('id',uid+'_form');form.setAttribute('method','post');form.setAttribute('enctype','multipart/form-data');form.setAttribute('encoding','multipart/form-data');Basic.extend(form.style,{overflow:'hidden',position:'absolute',top:0,left:0,width:'100%',height:'100%'});input=document.createElement('input');input.setAttribute('id',uid);input.setAttribute('type','file');input.setAttribute('name',_options.name||'Filedata');input.setAttribute('accept',_mimes.join(','));Basic.extend(input.style,{fontSize:'999px',opacity:0});form.appendChild(input);shimContainer.appendChild(form);Basic.extend(input.style,{position:'absolute',top:0,left:0,width:'100%',height:'100%'});if(Env.browser==='IE'&&Env.version<10){Basic.extend(input.style,{filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"})}input.onchange=function(){var file;if(!this.value){return}if(this.files){file=this.files[0]}else{file={name:this.value}}_files=[file];this.onchange=function(){};addInput.call(comp);comp.bind('change',function onChange(){var input=Dom.get(uid),form=Dom.get(uid+'_form'),file;comp.unbind('change',onChange);if(comp.files.length&&input&&form){file=comp.files[0];input.setAttribute('id',file.uid);form.setAttribute('id',file.uid+'_form');form.setAttribute('target',file.uid+'_iframe')}input=form=null},998);input=form=null;comp.trigger('change')};if(I.can('summon_file_dialog')){browseButton=Dom.get(_options.browse_button);Events.removeEvent(browseButton,'click',comp.uid);Events.addEvent(browseButton,'click',function(e){if(input&&!input.disabled){input.click()}e.preventDefault()},comp.uid)}_uid=uid;shimContainer=currForm=browseButton=null}Basic.extend(this,{init:function(options){var comp=this,I=comp.getRuntime(),shimContainer;_options=options;_mimes=options.accept.mimes||Mime.extList2mimes(options.accept,I.can('filter_by_extension'));shimContainer=I.getShimContainer();(function(){var browseButton,zIndex,top;browseButton=Dom.get(options.browse_button);if(I.can('summon_file_dialog')){if(Dom.getStyle(browseButton,'position')==='static'){browseButton.style.position='relative'}zIndex=parseInt(Dom.getStyle(browseButton,'z-index'),10)||1;browseButton.style.zIndex=zIndex;shimContainer.style.zIndex=zIndex-1}top=I.can('summon_file_dialog')?browseButton:shimContainer;Events.addEvent(top,'mouseover',function(){comp.trigger('mouseenter')},comp.uid);Events.addEvent(top,'mouseout',function(){comp.trigger('mouseleave')},comp.uid);Events.addEvent(top,'mousedown',function(){comp.trigger('mousedown')},comp.uid);Events.addEvent(Dom.get(options.container),'mouseup',function(){comp.trigger('mouseup')},comp.uid);browseButton=null}());addInput.call(this);shimContainer=null;comp.trigger({type:'ready',async:true})},getFiles:function(){return _files},disable:function(state){var input;if((input=Dom.get(_uid))){input.disabled=!!state}},destroy:function(){var I=this.getRuntime(),shim=I.getShim(),shimContainer=I.getShimContainer();Events.removeAllEvents(shimContainer,this.uid);Events.removeAllEvents(_options&&Dom.get(_options.container),this.uid);Events.removeAllEvents(_options&&Dom.get(_options.browse_button),this.uid);if(shimContainer){shimContainer.innerHTML=''}shim.removeInstance(this.uid);_uid=_files=_mimes=_options=shimContainer=shim=null}})}return(extensions.FileInput=FileInput)});define("moxie/runtime/html4/file/FileReader",["moxie/runtime/html4/Runtime","moxie/runtime/html5/file/FileReader"],function(extensions,FileReader){return(extensions.FileReader=FileReader)});define("moxie/runtime/html4/xhr/XMLHttpRequest",["moxie/runtime/html4/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Url","moxie/core/Exceptions","moxie/core/utils/Events","moxie/file/Blob","moxie/xhr/FormData"],function(extensions,Basic,Dom,Url,x,Events,Blob,FormData){function XMLHttpRequest(){var _status,_response,_iframe;function cleanup(cb){var target=this,uid,form,inputs,i,hasFile=false;if(!_iframe){return}uid=_iframe.id.replace(/_iframe$/,'');form=Dom.get(uid+'_form');if(form){inputs=form.getElementsByTagName('input');i=inputs.length;while(i--){switch(inputs[i].getAttribute('type')){case'hidden':inputs[i].parentNode.removeChild(inputs[i]);break;case'file':hasFile=true;break}}inputs=[];if(!hasFile){form.parentNode.removeChild(form)}form=null}setTimeout(function(){Events.removeEvent(_iframe,'load',target.uid);if(_iframe.parentNode){_iframe.parentNode.removeChild(_iframe)}var shimContainer=target.getRuntime().getShimContainer();if(!shimContainer.children.length){shimContainer.parentNode.removeChild(shimContainer)}shimContainer=_iframe=null;cb()},1)}Basic.extend(this,{send:function(meta,data){var target=this,I=target.getRuntime(),uid,form,input,blob;_status=_response=null;function createIframe(){var container=I.getShimContainer()||document.body,temp=document.createElement('div');temp.innerHTML='<iframe id="'+uid+'_iframe" name="'+uid+'_iframe" src="javascript:&quot;&quot;" style="display:none"></iframe>';_iframe=temp.firstChild;container.appendChild(_iframe);Events.addEvent(_iframe,'load',function(){var el;try{el=_iframe.contentWindow.document||_iframe.contentDocument||window.frames[_iframe.id].document;if(/^4(0[0-9]|1[0-7]|2[2346])\s/.test(el.title)){_status=el.title.replace(/^(\d+).*$/,'$1')}else{_status=200;_response=Basic.trim(el.body.innerHTML);target.trigger({type:'progress',loaded:_response.length,total:_response.length});if(blob){target.trigger({type:'uploadprogress',loaded:blob.size||1025,total:blob.size||1025})}}}catch(ex){if(Url.hasSameOrigin(meta.url)){_status=404}else{cleanup.call(target,function(){target.trigger('error')});return}}cleanup.call(target,function(){target.trigger('load')})},target.uid)}if(data instanceof FormData&&data.hasBlob()){blob=data.getBlob();uid=blob.uid;input=Dom.get(uid);form=Dom.get(uid+'_form');if(!form){throw new x.DOMException(x.DOMException.NOT_FOUND_ERR);}}else{uid=Basic.guid('uid_');form=document.createElement('form');form.setAttribute('id',uid+'_form');form.setAttribute('method',meta.method);form.setAttribute('enctype','multipart/form-data');form.setAttribute('encoding','multipart/form-data');form.setAttribute('target',uid+'_iframe');I.getShimContainer().appendChild(form)}if(data instanceof FormData){data.each(function(value,name){if(value instanceof Blob){if(input){input.setAttribute('name',name)}}else{var hidden=document.createElement('input');Basic.extend(hidden,{type:'hidden',name:name,value:value});if(input){form.insertBefore(hidden,input)}else{form.appendChild(hidden)}}})}form.setAttribute("action",meta.url);createIframe();form.submit();target.trigger('loadstart')},getStatus:function(){return _status},getResponse:function(responseType){if('json'===responseType){if(Basic.typeOf(_response)==='string'&&!!window.JSON){try{return JSON.parse(_response.replace(/^\s*<pre[^>]*>/,'').replace(/<\/pre>\s*$/,''))}catch(ex){return null}}}else if('document'===responseType){}return _response},abort:function(){var target=this;if(_iframe&&_iframe.contentWindow){if(_iframe.contentWindow.stop){_iframe.contentWindow.stop()}else if(_iframe.contentWindow.document.execCommand){_iframe.contentWindow.document.execCommand('Stop')}else{_iframe.src="about:blank"}}cleanup.call(this,function(){target.dispatchEvent('abort')})}})}return(extensions.XMLHttpRequest=XMLHttpRequest)});define("moxie/runtime/html4/image/Image",["moxie/runtime/html4/Runtime","moxie/runtime/html5/image/Image"],function(extensions,Image){return(extensions.Image=Image)});expose(["moxie/core/utils/Basic","moxie/core/I18n","moxie/core/utils/Mime","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/core/EventTarget","moxie/core/utils/Encode","moxie/runtime/Runtime","moxie/runtime/RuntimeClient","moxie/file/Blob","moxie/file/File","moxie/file/FileInput","moxie/file/FileDrop","moxie/runtime/RuntimeTarget","moxie/file/FileReader","moxie/core/utils/Url","moxie/file/FileReaderSync","moxie/xhr/FormData","moxie/xhr/XMLHttpRequest","moxie/runtime/Transporter","moxie/image/Image","moxie/core/utils/Events"])})(this);(function(){"use strict";var o={},inArray=moxie.core.utils.Basic.inArray;(function addAlias(ns){var name,itemType;for(name in ns){itemType=typeof(ns[name]);if(itemType==='object'&&!~inArray(name,['Exceptions','Env','Mime'])){addAlias(ns[name])}else if(itemType==='function'){o[name]=ns[name]}}})(window.moxie);o.Env=window.moxie.core.utils.Env;o.Mime=window.moxie.core.utils.Mime;o.Exceptions=window.moxie.core.Exceptions;window.mOxie=o;if(!window.o){window.o=o}return o})();;(function(window,o,undef){var delay=window.setTimeout,fileFilters={};function normalizeCaps(settings){var features=settings.required_features,caps={};function resolve(feature,value,strict){var map={chunks:'slice_blob',jpgresize:'send_binary_string',pngresize:'send_binary_string',progress:'report_upload_progress',multi_selection:'select_multiple',dragdrop:'drag_and_drop',drop_element:'drag_and_drop',headers:'send_custom_headers',canSendBinary:'send_binary',triggerDialog:'summon_file_dialog'};if(map[feature]){caps[map[feature]]=value}else if(!strict){caps[feature]=value}}if(typeof(features)==='string'){plupload.each(features.split(/\s*,\s*/),function(feature){resolve(feature,true)})}else if(typeof(features)==='object'){plupload.each(features,function(value,feature){resolve(feature,value)})}else if(features===true){if(!settings.multipart){caps.send_binary_string=true}if(settings.chunk_size>0){caps.slice_blob=true}if(settings.resize.enabled){caps.send_binary_string=true}plupload.each(settings,function(value,feature){resolve(feature,!!value,true)})}return caps}var plupload={VERSION:'2.1.1',STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,IMAGE_MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:o.mimes,ua:o.ua,typeOf:o.typeOf,extend:o.extend,guid:o.guid,get:function get(ids){var els=[],el;if(o.typeOf(ids)!=='array'){ids=[ids]}var i=ids.length;while(i--){el=o.get(ids[i]);if(el){els.push(el)}}return els.length?els:null},each:o.each,getPos:o.getPos,getSize:o.getSize,xmlEncode:function(str){var xmlEncodeChars={'<':'lt','>':'gt','&':'amp','"':'quot','\'':'#39'},xmlEncodeRegExp=/[<>&\"\']/g;return str?(''+str).replace(xmlEncodeRegExp,function(chr){return xmlEncodeChars[chr]?'&'+xmlEncodeChars[chr]+';':chr}):str},toArray:o.toArray,inArray:o.inArray,addI18n:o.addI18n,translate:o.translate,isEmptyObj:o.isEmptyObj,hasClass:o.hasClass,addClass:o.addClass,removeClass:o.removeClass,getStyle:o.getStyle,addEvent:o.addEvent,removeEvent:o.removeEvent,removeAllEvents:o.removeAllEvents,cleanName:function(name){var i,lookup;lookup=[/[\300-\306]/g,'A',/[\340-\346]/g,'a',/\307/g,'C',/\347/g,'c',/[\310-\313]/g,'E',/[\350-\353]/g,'e',/[\314-\317]/g,'I',/[\354-\357]/g,'i',/\321/g,'N',/\361/g,'n',/[\322-\330]/g,'O',/[\362-\370]/g,'o',/[\331-\334]/g,'U',/[\371-\374]/g,'u'];for(i=0;i<lookup.length;i+=2){name=name.replace(lookup[i],lookup[i+1])}name=name.replace(/\s+/g,'_');name=name.replace(/[^a-z0-9_\-\.]+/gi,'');return name},buildUrl:function(url,items){var query='';plupload.each(items,function(value,name){query+=(query?'&':'')+encodeURIComponent(name)+'='+encodeURIComponent(value)});if(query){url+=(url.indexOf('?')>0?'&':'?')+query}return url},formatSize:function(size){if(size===undef||/\D/.test(size)){return plupload.translate('N/A')}function round(num,precision){return Math.round(num*Math.pow(10,precision))/Math.pow(10,precision)}var boundary=Math.pow(1024,4);if(size>boundary){return round(size/boundary,1)+" "+plupload.translate('tb')}if(size>(boundary/=1024)){return round(size/boundary,1)+" "+plupload.translate('gb')}if(size>(boundary/=1024)){return round(size/boundary,1)+" "+plupload.translate('mb')}if(size>1024){return Math.round(size/1024)+" "+plupload.translate('kb')}return size+" "+plupload.translate('b')},parseSize:o.parseSizeStr,predictRuntime:function(config,runtimes){var up,runtime;up=new plupload.Uploader(config);runtime=o.Runtime.thatCan(up.getOption().required_features,runtimes||config.runtimes);up.destroy();return runtime},addFileFilter:function(name,cb){fileFilters[name]=cb}};plupload.addFileFilter('mime_types',function(filters,file,cb){if(filters.length&&!filters.regexp.test(file.name)){this.trigger('Error',{code:plupload.FILE_EXTENSION_ERROR,message:plupload.translate('File extension error.'),file:file});cb(false)}else{cb(true)}});plupload.addFileFilter('max_file_size',function(maxSize,file,cb){var undef;maxSize=plupload.parseSize(maxSize);if(file.size!==undef&&maxSize&&file.size>maxSize){this.trigger('Error',{code:plupload.FILE_SIZE_ERROR,message:plupload.translate('File size error.'),file:file});cb(false)}else{cb(true)}});plupload.addFileFilter('prevent_duplicates',function(value,file,cb){if(value){var ii=this.files.length;while(ii--){if(file.name===this.files[ii].name&&file.size===this.files[ii].size){this.trigger('Error',{code:plupload.FILE_DUPLICATE_ERROR,message:plupload.translate('Duplicate file error.'),file:file});cb(false);return}}}cb(true)});plupload.Uploader=function(options){var uid=plupload.guid(),settings,files=[],preferred_caps={},fileInputs=[],fileDrops=[],startTime,total,disabled=false,xhr;function uploadNext(){var file,count=0,i;if(this.state==plupload.STARTED){for(i=0;i<files.length;i++){if(!file&&files[i].status==plupload.QUEUED){file=files[i];if(this.trigger("BeforeUpload",file)){file.status=plupload.UPLOADING;this.trigger("UploadFile",file)}}else{count++}}if(count==files.length){if(this.state!==plupload.STOPPED){this.state=plupload.STOPPED;this.trigger("StateChanged")}this.trigger("UploadComplete",files)}}}function calcFile(file){file.percent=file.size>0?Math.ceil(file.loaded/file.size*100):100;calc()}function calc(){var i,file;total.reset();for(i=0;i<files.length;i++){file=files[i];if(file.size!==undef){total.size+=file.origSize;total.loaded+=file.loaded*file.origSize/file.size}else{total.size=undef}if(file.status==plupload.DONE){total.uploaded++}else if(file.status==plupload.FAILED){total.failed++}else{total.queued++}}if(total.size===undef){total.percent=files.length>0?Math.ceil(total.uploaded/files.length*100):0}else{total.bytesPerSec=Math.ceil(total.loaded/((+new Date()-startTime||1)/1000.0));total.percent=total.size>0?Math.ceil(total.loaded/total.size*100):0}}function getRUID(){var ctrl=fileInputs[0]||fileDrops[0];if(ctrl){return ctrl.getRuntime().uid}return false}function runtimeCan(file,cap){if(file.ruid){var info=o.Runtime.getInfo(file.ruid);if(info){return info.can(cap)}}return false}function bindEventListeners(){this.bind('FilesAdded',onFilesAdded);this.bind('CancelUpload',onCancelUpload);this.bind('BeforeUpload',onBeforeUpload);this.bind('UploadFile',onUploadFile);this.bind('UploadProgress',onUploadProgress);this.bind('StateChanged',onStateChanged);this.bind('QueueChanged',calc);this.bind('Error',onError);this.bind('FileUploaded',onFileUploaded);this.bind('Destroy',onDestroy)}function initControls(settings,cb){var self=this,inited=0,queue=[];var options={accept:settings.filters.mime_types,runtime_order:settings.runtimes,required_caps:settings.required_features,preferred_caps:preferred_caps,swf_url:settings.flash_swf_url,xap_url:settings.silverlight_xap_url};plupload.each(settings.runtimes.split(/\s*,\s*/),function(runtime){if(settings[runtime]){options[runtime]=settings[runtime]}});if(settings.browse_button){plupload.each(settings.browse_button,function(el){queue.push(function(cb){var fileInput=new o.FileInput(plupload.extend({},options,{name:settings.file_data_name,multiple:settings.multi_selection,container:settings.container,browse_button:el}));fileInput.onready=function(){var info=o.Runtime.getInfo(this.ruid);o.extend(self.features,{chunks:info.can('slice_blob'),multipart:info.can('send_multipart'),multi_selection:info.can('select_multiple')});inited++;fileInputs.push(this);cb()};fileInput.onchange=function(){self.addFile(this.files)};fileInput.bind('mouseenter mouseleave mousedown mouseup',function(e){if(!disabled){if(settings.browse_button_hover){if('mouseenter'===e.type){o.addClass(el,settings.browse_button_hover)}else if('mouseleave'===e.type){o.removeClass(el,settings.browse_button_hover)}}if(settings.browse_button_active){if('mousedown'===e.type){o.addClass(el,settings.browse_button_active)}else if('mouseup'===e.type){o.removeClass(el,settings.browse_button_active)}}}});fileInput.bind('error runtimeerror',function(){fileInput=null;cb()});fileInput.init()})})}if(settings.drop_element){plupload.each(settings.drop_element,function(el){queue.push(function(cb){var fileDrop=new o.FileDrop(plupload.extend({},options,{drop_zone:el}));fileDrop.onready=function(){var info=o.Runtime.getInfo(this.ruid);self.features.dragdrop=info.can('drag_and_drop');inited++;fileDrops.push(this);cb()};fileDrop.ondrop=function(){self.addFile(this.files)};fileDrop.bind('error runtimeerror',function(){fileDrop=null;cb()});fileDrop.init()})})}o.inSeries(queue,function(){if(typeof(cb)==='function'){cb(inited)}})}function resizeImage(blob,params,cb){var img=new o.Image();try{img.onload=function(){img.downsize(params.width,params.height,params.crop,params.preserve_headers)};img.onresize=function(){cb(this.getAsBlob(blob.type,params.quality));this.destroy()};img.onerror=function(){cb(blob)};img.load(blob)}catch(ex){cb(blob)}}function setOption(option,value,init){var self=this,reinitRequired=false;function _setOption(option,value,init){var oldValue=settings[option];switch(option){case'max_file_size':if(option==='max_file_size'){settings.max_file_size=settings.filters.max_file_size=value}break;case'chunk_size':if(value=plupload.parseSize(value)){settings[option]=value}break;case'filters':if(plupload.typeOf(value)==='array'){value={mime_types:value}}if(init){plupload.extend(settings.filters,value)}else{settings.filters=value}if(value.mime_types){settings.filters.mime_types.regexp=(function(filters){var extensionsRegExp=[];plupload.each(filters,function(filter){plupload.each(filter.extensions.split(/,/),function(ext){if(/^\s*\*\s*$/.test(ext)){extensionsRegExp.push('\\.*')}else{extensionsRegExp.push('\\.'+ext.replace(new RegExp('['+('/^$.*+?|()[]{}\\'.replace(/./g,'\\$&'))+']','g'),'\\$&'))}})});return new RegExp('('+extensionsRegExp.join('|')+')$','i')}(settings.filters.mime_types))}break;case'resize':if(init){plupload.extend(settings.resize,value,{enabled:true})}else{settings.resize=value}break;case'prevent_duplicates':settings.prevent_duplicates=settings.filters.prevent_duplicates=!!value;break;case'browse_button':case'drop_element':value=plupload.get(value);case'container':case'runtimes':case'multi_selection':case'flash_swf_url':case'silverlight_xap_url':settings[option]=value;if(!init){reinitRequired=true}break;default:settings[option]=value}if(!init){self.trigger('OptionChanged',option,value,oldValue)}}if(typeof(option)==='object'){plupload.each(option,function(value,option){_setOption(option,value,init)})}else{_setOption(option,value,init)}if(init){settings.required_features=normalizeCaps(plupload.extend({},settings));preferred_caps=normalizeCaps(plupload.extend({},settings,{required_features:true}))}else if(reinitRequired){self.trigger('Destroy');initControls.call(self,settings,function(inited){if(inited){self.runtime=o.Runtime.getInfo(getRUID()).type;self.trigger('Init',{runtime:self.runtime});self.trigger('PostInit')}else{self.trigger('Error',{code:plupload.INIT_ERROR,message:plupload.translate('Init error.')})}})}}function onFilesAdded(up,filteredFiles){[].push.apply(files,filteredFiles);up.trigger('QueueChanged');up.refresh()}function onBeforeUpload(up,file){if(settings.unique_names){var matches=file.name.match(/\.([^.]+)$/),ext="part";if(matches){ext=matches[1]}file.target_name=file.id+'.'+ext}}function onUploadFile(up,file){var url=up.settings.url,chunkSize=up.settings.chunk_size,retries=up.settings.max_retries,features=up.features,offset=0,blob;if(file.loaded){offset=file.loaded=chunkSize*Math.floor(file.loaded/chunkSize)}function handleError(){if(retries-->0){delay(uploadNextChunk,1000)}else{file.loaded=offset;up.trigger('Error',{code:plupload.HTTP_ERROR,message:plupload.translate('HTTP Error.'),file:file,response:xhr.responseText,status:xhr.status,responseHeaders:xhr.getAllResponseHeaders()})}}function uploadNextChunk(){var chunkBlob,formData,args,curChunkSize;if(file.status==plupload.DONE||file.status==plupload.FAILED||up.state==plupload.STOPPED){return}args={name:file.target_name||file.name};if(chunkSize&&features.chunks&&blob.size>chunkSize){curChunkSize=Math.min(chunkSize,blob.size-offset);chunkBlob=blob.slice(offset,offset+curChunkSize)}else{curChunkSize=blob.size;chunkBlob=blob}if(chunkSize&&features.chunks){if(up.settings.send_chunk_number){args.chunk=Math.ceil(offset/chunkSize);args.chunks=Math.ceil(blob.size/chunkSize)}else{args.offset=offset;args.total=blob.size}}xhr=new o.XMLHttpRequest();if(xhr.upload){xhr.upload.onprogress=function(e){file.loaded=Math.min(file.size,offset+e.loaded);up.trigger('UploadProgress',file)}}xhr.onload=function(){if(xhr.status>=400){handleError();return}retries=up.settings.max_retries;if(curChunkSize<blob.size){chunkBlob.destroy();offset+=curChunkSize;file.loaded=Math.min(offset,blob.size);up.trigger('ChunkUploaded',file,{offset:file.loaded,total:blob.size,response:xhr.responseText,status:xhr.status,responseHeaders:xhr.getAllResponseHeaders()});if(o.Env.browser==='Android Browser'){up.trigger('UploadProgress',file)}}else{file.loaded=file.size}chunkBlob=formData=null;if(!offset||offset>=blob.size){if(file.size!=file.origSize){blob.destroy();blob=null}up.trigger('UploadProgress',file);file.status=plupload.DONE;up.trigger('FileUploaded',file,{response:xhr.responseText,status:xhr.status,responseHeaders:xhr.getAllResponseHeaders()})}else{delay(uploadNextChunk,1)}};xhr.onerror=function(){handleError()};xhr.onloadend=function(){this.destroy();xhr=null};if(up.settings.multipart&&features.multipart){args.name=file.target_name||file.name;xhr.open("post",url,true);plupload.each(up.settings.headers,function(value,name){xhr.setRequestHeader(name,value)});formData=new o.FormData();plupload.each(plupload.extend(args,up.settings.multipart_params),function(value,name){formData.append(name,value)});formData.append(up.settings.file_data_name,chunkBlob);xhr.send(formData,{runtime_order:up.settings.runtimes,required_caps:up.settings.required_features,preferred_caps:preferred_caps,swf_url:up.settings.flash_swf_url,xap_url:up.settings.silverlight_xap_url})}else{url=plupload.buildUrl(up.settings.url,plupload.extend(args,up.settings.multipart_params));xhr.open("post",url,true);xhr.setRequestHeader('Content-Type','application/octet-stream');plupload.each(up.settings.headers,function(value,name){xhr.setRequestHeader(name,value)});xhr.send(chunkBlob,{runtime_order:up.settings.runtimes,required_caps:up.settings.required_features,preferred_caps:preferred_caps,swf_url:up.settings.flash_swf_url,xap_url:up.settings.silverlight_xap_url})}}blob=file.getSource();if(up.settings.resize.enabled&&runtimeCan(blob,'send_binary_string')&&!!~o.inArray(blob.type,['image/jpeg','image/png'])){resizeImage.call(this,blob,up.settings.resize,function(resizedBlob){blob=resizedBlob;file.size=resizedBlob.size;uploadNextChunk()})}else{uploadNextChunk()}}function onUploadProgress(up,file){calcFile(file)}function onStateChanged(up){if(up.state==plupload.STARTED){startTime=(+new Date())}else if(up.state==plupload.STOPPED){for(var i=up.files.length-1;i>=0;i--){if(up.files[i].status==plupload.UPLOADING){up.files[i].status=plupload.QUEUED;calc()}}}}function onCancelUpload(){if(xhr){xhr.abort()}}function onFileUploaded(up){calc();delay(function(){uploadNext.call(up)},1)}function onError(up,err){if(err.file){err.file.status=plupload.FAILED;calcFile(err.file);if(up.state==plupload.STARTED){up.trigger('CancelUpload');delay(function(){uploadNext.call(up)},1)}}}function onDestroy(up){up.stop();plupload.each(files,function(file){file.destroy()});files=[];if(fileInputs.length){plupload.each(fileInputs,function(fileInput){fileInput.destroy()});fileInputs=[]}if(fileDrops.length){plupload.each(fileDrops,function(fileDrop){fileDrop.destroy()});fileDrops=[]}preferred_caps={};disabled=false;startTime=xhr=null;total.reset()}settings={runtimes:o.Runtime.order,max_retries:0,chunk_size:0,multipart:true,multi_selection:true,file_data_name:'file',flash_swf_url:'js/Moxie.swf',silverlight_xap_url:'js/Moxie.xap',filters:{mime_types:[],prevent_duplicates:false,max_file_size:0},resize:{enabled:false,preserve_headers:true,crop:false},send_chunk_number:true};setOption.call(this,options,null,true);total=new plupload.QueueProgress();plupload.extend(this,{id:uid,uid:uid,state:plupload.STOPPED,features:{},runtime:null,files:files,settings:settings,total:total,init:function(){var self=this;if(typeof(settings.preinit)=="function"){settings.preinit(self)}else{plupload.each(settings.preinit,function(func,name){self.bind(name,func)})}if(!settings.browse_button||!settings.url){this.trigger('Error',{code:plupload.INIT_ERROR,message:plupload.translate('Init error.')});return}bindEventListeners.call(this);initControls.call(this,settings,function(inited){if(typeof(settings.init)=="function"){settings.init(self)}else{plupload.each(settings.init,function(func,name){self.bind(name,func)})}if(inited){self.runtime=o.Runtime.getInfo(getRUID()).type;self.trigger('Init',{runtime:self.runtime});self.trigger('PostInit')}else{self.trigger('Error',{code:plupload.INIT_ERROR,message:plupload.translate('Init error.')})}})},setOption:function(option,value){setOption.call(this,option,value,!this.runtime)},getOption:function(option){if(!option){return settings}return settings[option]},refresh:function(){if(fileInputs.length){plupload.each(fileInputs,function(fileInput){fileInput.trigger('Refresh')})}this.trigger('Refresh')},start:function(){if(this.state!=plupload.STARTED){this.state=plupload.STARTED;this.trigger('StateChanged');uploadNext.call(this)}},stop:function(){if(this.state!=plupload.STOPPED){this.state=plupload.STOPPED;this.trigger('StateChanged');this.trigger('CancelUpload')}},disableBrowse:function(){disabled=arguments[0]!==undef?arguments[0]:true;if(fileInputs.length){plupload.each(fileInputs,function(fileInput){fileInput.disable(disabled)})}this.trigger('DisableBrowse',disabled)},getFile:function(id){var i;for(i=files.length-1;i>=0;i--){if(files[i].id===id){return files[i]}}},addFile:function(file,fileName){var self=this,queue=[],files=[],ruid;function filterFile(file,cb){var queue=[];o.each(self.settings.filters,function(rule,name){if(fileFilters[name]){queue.push(function(cb){fileFilters[name].call(self,rule,file,function(res){cb(!res)})})}});o.inSeries(queue,cb)}function resolveFile(file){var type=o.typeOf(file);if(file instanceof o.File){if(!file.ruid&&!file.isDetached()){if(!ruid){return false}file.ruid=ruid;file.connectRuntime(ruid)}resolveFile(new plupload.File(file))}else if(file instanceof o.Blob){resolveFile(file.getSource());file.destroy()}else if(file instanceof plupload.File){if(fileName){file.name=fileName}queue.push(function(cb){filterFile(file,function(err){if(!err){files.push(file);self.trigger("FileFiltered",file)}delay(cb,1)})})}else if(o.inArray(type,['file','blob'])!==-1){resolveFile(new o.File(null,file))}else if(type==='node'&&o.typeOf(file.files)==='filelist'){o.each(file.files,resolveFile)}else if(type==='array'){fileName=null;o.each(file,resolveFile)}}ruid=getRUID();resolveFile(file);if(queue.length){o.inSeries(queue,function(){if(files.length){self.trigger("FilesAdded",files)}})}},removeFile:function(file){var id=typeof(file)==='string'?file:file.id;for(var i=files.length-1;i>=0;i--){if(files[i].id===id){return this.splice(i,1)[0]}}},splice:function(start,length){var removed=files.splice(start===undef?0:start,length===undef?files.length:length);var restartRequired=false;if(this.state==plupload.STARTED){restartRequired=true;this.stop()}this.trigger("FilesRemoved",removed);plupload.each(removed,function(file){file.destroy()});this.trigger("QueueChanged");this.refresh();if(restartRequired){this.start()}return removed},bind:function(name,func,scope){var self=this;plupload.Uploader.prototype.bind.call(this,name,function(){var args=[].slice.call(arguments);args.splice(0,1,self);return func.apply(this,args)},0,scope)},destroy:function(){this.trigger('Destroy');settings=total=null;this.unbindAll()}})};plupload.Uploader.prototype=o.EventTarget.instance;plupload.File=(function(){var filepool={};function PluploadFile(file){plupload.extend(this,{id:plupload.guid(),name:file.name||file.fileName,type:file.type||'',size:file.size||file.fileSize,origSize:file.size||file.fileSize,loaded:0,percent:0,status:plupload.QUEUED,lastModifiedDate:file.lastModifiedDate||(new Date()).toLocaleString(),getNative:function(){var file=this.getSource().getSource();return o.inArray(o.typeOf(file),['blob','file'])!==-1?file:null},getSource:function(){if(!filepool[this.id]){return null}return filepool[this.id]},destroy:function(){var src=this.getSource();if(src){src.destroy();delete filepool[this.id]}}});filepool[this.id]=file}return PluploadFile}());plupload.QueueProgress=function(){var self=this;self.size=0;self.loaded=0;self.uploaded=0;self.failed=0;self.queued=0;self.percent=0;self.bytesPerSec=0;self.reset=function(){self.size=self.loaded=self.uploaded=self.failed=self.queued=self.percent=self.bytesPerSec=0}};window.plupload=plupload}(window,mOxie));;(function(global){function createCookie(key,value,exp){var date=new Date();date.setTime(date.getTime()+(exp*24*60*60*1000));var expires="; expires="+date.toGMTString();document.cookie=key+"="+value+expires+"; path=/"}function readCookie(key){var nameEQ=key+"=";var ca=document.cookie.split(';');for(var i=0,max=ca.length;i<max;i++){var c=ca[i];while(c.charAt(0)===' '){c=c.substring(1,c.length)}if(c.indexOf(nameEQ)===0){return c.substring(nameEQ.length,c.length)}}return null}if(!window.localStorage){window.localStorage={setItem:function(key,value){createCookie(key,value,30)},getItem:function(key){return readCookie(key)},removeItem:function(key){createCookie(key,'',-1)}}}function QiniuJsSDK(){var that=this;this.detectIEVersion=function(){var v=4,div=document.createElement('div'),all=div.getElementsByTagName('i');while(div.innerHTML='<!--[if gt IE '+v+']><i></i><![endif]-->',all[0]){v++}return v>4?v:false};var logger={MUTE:0,FATA:1,ERROR:2,WARN:3,INFO:4,DEBUG:5,TRACE:6,level:0};function log(type,args){var header="[qiniu-js-sdk]["+type+"]";var msg=header;for(var i=0;i<args.length;i++){if(typeof args[i]==="string"){msg+=" "+args[i]}else{msg+=" "+that.stringifyJSON(args[i])}}if(that.detectIEVersion()){console.log(msg)}else{args.unshift(header);console.log.apply(console,args)}if(document.getElementById('qiniu-js-sdk-log')){document.getElementById('qiniu-js-sdk-log').innerHTML+='<p>'+msg+'</p>'}}function makeLogFunc(code){var func=code.toLowerCase();logger[func]=function(){if(window.console&&window.console.log&&logger.level>=logger[code]){var args=Array.prototype.slice.call(arguments);log(func,args)}}}for(var property in logger){if(logger.hasOwnProperty(property)&&(typeof logger[property])==="number"&&!logger.hasOwnProperty(property.toLowerCase())){makeLogFunc(property)}}var qiniuUploadUrl;if(window.location.protocol==='https:'){qiniuUploadUrl='https://up.qbox.me'}else{qiniuUploadUrl='http://upload.qiniu.com'}var qiniuUploadUrls=["http://upload.qiniu.com","http://up.qiniu.com"];var qiniuUpHosts={"http":["http://upload.qiniu.com","http://up.qiniu.com"],"https":["https://up.qbox.me"]};var changeUrlTimes=0;this.resetUploadUrl=function(){var hosts=window.location.protocol==='https:'?qiniuUpHosts.https:qiniuUpHosts.http;var i=changeUrlTimes%hosts.length;qiniuUploadUrl=hosts[i];changeUrlTimes++;logger.debug('resetUploadUrl: '+qiniuUploadUrl)};this.isImage=function(url){url=url.split(/[?#]/)[0];return(/\.(png|jpg|jpeg|gif|bmp)$/i).test(url)};this.getFileExtension=function(filename){var tempArr=filename.split(".");var ext;if(tempArr.length===1||(tempArr[0]===""&&tempArr.length===2)){ext=""}else{ext=tempArr.pop().toLowerCase()}return ext};this.utf8_encode=function(argString){if(argString===null||typeof argString==='undefined'){return''}var string=(argString+'');var utftext='',start,end,stringl=0;start=end=0;stringl=string.length;for(var n=0;n<stringl;n++){var c1=string.charCodeAt(n);var enc=null;if(c1<128){end++}else if(c1>127&&c1<2048){enc=String.fromCharCode((c1>>6)|192,(c1&63)|128)}else if(c1&0xF800^0xD800>0){enc=String.fromCharCode((c1>>12)|224,((c1>>6)&63)|128,(c1&63)|128)}else{if(c1&0xFC00^0xD800>0){throw new RangeError('Unmatched trail surrogate at '+n);}var c2=string.charCodeAt(++n);if(c2&0xFC00^0xDC00>0){throw new RangeError('Unmatched lead surrogate at '+(n-1));}c1=((c1&0x3FF)<<10)+(c2&0x3FF)+0x10000;enc=String.fromCharCode((c1>>18)|240,((c1>>12)&63)|128,((c1>>6)&63)|128,(c1&63)|128)}if(enc!==null){if(end>start){utftext+=string.slice(start,end)}utftext+=enc;start=end=n+1}}if(end>start){utftext+=string.slice(start,stringl)}return utftext};this.base64_decode=function(data){var b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,dec="",tmp_arr=[];if(!data){return data}data+='';do{h1=b64.indexOf(data.charAt(i++));h2=b64.indexOf(data.charAt(i++));h3=b64.indexOf(data.charAt(i++));h4=b64.indexOf(data.charAt(i++));bits=h1<<18|h2<<12|h3<<6|h4;o1=bits>>16&0xff;o2=bits>>8&0xff;o3=bits&0xff;if(h3===64){tmp_arr[ac++]=String.fromCharCode(o1)}else if(h4===64){tmp_arr[ac++]=String.fromCharCode(o1,o2)}else{tmp_arr[ac++]=String.fromCharCode(o1,o2,o3)}}while(i<data.length);dec=tmp_arr.join('');return dec};this.base64_encode=function(data){var b64='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,enc='',tmp_arr=[];if(!data){return data}data=this.utf8_encode(data+'');do{o1=data.charCodeAt(i++);o2=data.charCodeAt(i++);o3=data.charCodeAt(i++);bits=o1<<16|o2<<8|o3;h1=bits>>18&0x3f;h2=bits>>12&0x3f;h3=bits>>6&0x3f;h4=bits&0x3f;tmp_arr[ac++]=b64.charAt(h1)+b64.charAt(h2)+b64.charAt(h3)+b64.charAt(h4)}while(i<data.length);enc=tmp_arr.join('');switch(data.length%3){case 1:enc=enc.slice(0,-2)+'==';break;case 2:enc=enc.slice(0,-1)+'=';break}return enc};this.URLSafeBase64Encode=function(v){v=this.base64_encode(v);return v.replace(/\//g,'_').replace(/\+/g,'-')};this.URLSafeBase64Decode=function(v){v=v.replace(/_/g,'/').replace(/-/g,'+');return this.base64_decode(v)};this.createAjax=function(argument){var xmlhttp={};if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest()}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}return xmlhttp};this.parseJSON=function(data){if(window.JSON&&window.JSON.parse){return window.JSON.parse(data)}var rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;var text=String(data);rx_dangerous.lastIndex=0;if(rx_dangerous.test(text)){text=text.replace(rx_dangerous,function(a){return'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4)})}return eval('('+text+')')};this.stringifyJSON=function(obj){if(window.JSON&&window.JSON.stringify){return window.JSON.stringify(obj)}switch(typeof(obj)){case'string':return'"'+obj.replace(/(["\\])/g,'\\$1')+'"';case'array':return'['+obj.map(that.stringifyJSON).join(',')+']';case'object':if(obj instanceof Array){var strArr=[];var len=obj.length;for(var i=0;i<len;i++){strArr.push(that.stringifyJSON(obj[i]))}return'['+strArr.join(',')+']'}else if(obj===null){return'null'}else{var string=[];for(var property in obj){if(obj.hasOwnProperty(property)){string.push(that.stringifyJSON(property)+':'+that.stringifyJSON(obj[property]))}}return'{'+string.join(',')+'}'}break;case'number':return obj;case false:return obj;case'boolean':return obj}};this.trim=function(text){return text===null?"":text.replace(/^\s+|\s+$/g,'')};this.uploader=function(op){var reset_chunk_size=function(){var ie=that.detectIEVersion();var BLOCK_BITS,MAX_CHUNK_SIZE,chunk_size;var isSpecialSafari=(mOxie.Env.browser==="Safari"&&mOxie.Env.version<=5&&mOxie.Env.os==="Windows"&&mOxie.Env.osVersion==="7")||(mOxie.Env.browser==="Safari"&&mOxie.Env.os==="iOS"&&mOxie.Env.osVersion==="7");if(ie&&ie<9&&op.chunk_size&&op.runtimes.indexOf('flash')>=0){op.chunk_size=0}else if(isSpecialSafari){op.chunk_size=0}else{BLOCK_BITS=20;MAX_CHUNK_SIZE=4<<BLOCK_BITS;chunk_size=plupload.parseSize(op.chunk_size);if(chunk_size>MAX_CHUNK_SIZE){op.chunk_size=MAX_CHUNK_SIZE}}};var getHosts=function(hosts){var result=[];for(var i=0;i<hosts.length;i++){var host=hosts[i];if(host.indexOf('-H')===0){result.push(host.split(' ')[2])}else{result.push(host)}}return result};var getPutPolicy=function(uptoken){var segments=uptoken.split(":");var ak=segments[0];var putPolicy=that.parseJSON(that.URLSafeBase64Decode(segments[2]));putPolicy.ak=ak;if(putPolicy.scope.indexOf(":")>=0){putPolicy.bucket=putPolicy.scope.split(":")[0];putPolicy.key=putPolicy.scope.split(":")[1]}else{putPolicy.bucket=putPolicy.scope}return putPolicy};var getUpHosts=function(uptoken){var putPolicy=getPutPolicy(uptoken);var uphosts_url=window.location.protocol+"//uc.qbox.me/v1/query?ak="+putPolicy.ak+"&bucket="+putPolicy.bucket;logger.debug("putPolicy: ",putPolicy);logger.debug("get uphosts from: ",uphosts_url);var ie=that.detectIEVersion();var ajax;if(ie&&ie<=9){ajax=new mOxie.XMLHttpRequest();mOxie.Env.swf_url=op.flash_swf_url}else{ajax=that.createAjax()}ajax.open('GET',uphosts_url,true);var onreadystatechange=function(){logger.debug("ajax.readyState: ",ajax.readyState);if(ajax.readyState===4){logger.debug("ajax.status: ",ajax.status);if(ajax.status<400){var res=that.parseJSON(ajax.responseText);qiniuUpHosts.http=getHosts(res.http.up);qiniuUpHosts.https=getHosts(res.https.up);logger.debug("get new uphosts: ",qiniuUpHosts);that.resetUploadUrl()}else{logger.error("get uphosts error: ",ajax.responseText)}}};if(ie&&ie<=9){ajax.bind('readystatechange',onreadystatechange)}else{ajax.onreadystatechange=onreadystatechange}ajax.send();return};var getUptoken=function(file){if(!that.token||that.tokenInfo.isExpired()){return getNewUpToken(file)}else{return that.token}};var getNewUpToken=function(file){if(op.uptoken){that.token=op.uptoken}else if(op.uptoken_url){logger.debug("get uptoken from: ",that.uptoken_url);var ajax=that.createAjax();ajax.open('GET',that.uptoken_url,false);ajax.setRequestHeader("If-Modified-Since","0");ajax.send();if(ajax.status===200){var res=that.parseJSON(ajax.responseText);that.token=res.uptoken;var segments=that.token.split(":");var putPolicy=that.parseJSON(that.URLSafeBase64Decode(segments[2]));if(!that.tokenMap){that.tokenMap={}}var getTimestamp=function(time){return Math.ceil(time.getTime()/1000)};var serverTime=getTimestamp(new Date(ajax.getResponseHeader("date")));var clientTime=getTimestamp(new Date());that.tokenInfo={serverDelay:clientTime-serverTime,deadline:putPolicy.deadline,isExpired:function(){var leftTime=this.deadline-getTimestamp(new Date())+this.serverDelay;return leftTime<600}};logger.debug("get new uptoken: ",that.token);logger.debug("get token info: ",that.tokenInfo)}else{logger.error("get uptoken error: ",ajax.responseText)}}else if(op.uptoken_func){logger.debug("get uptoken from uptoken_func");that.token=op.uptoken_func(file);logger.debug("get new uptoken: ",that.token)}else{logger.error("one of [uptoken, uptoken_url, uptoken_func] settings in options is required!")}if(that.token){getUpHosts(that.token)}return that.token};var getFileKey=function(up,file,func){var key='',unique_names=false;if(!op.save_key){unique_names=up.getOption&&up.getOption('unique_names');unique_names=unique_names||(up.settings&&up.settings.unique_names);if(unique_names){var ext=that.getFileExtension(file.name);key=ext?file.id+'.'+ext:file.id}else if(typeof func==='function'){key=func(up,file)}else{key=file.name}}return key};if(op.log_level){logger.level=op.log_level}if(!op.domain){throw'domain setting in options is required!';}if(!op.browse_button){throw'browse_button setting in options is required!';}if(!op.uptoken&&!op.uptoken_url&&!op.uptoken_func){throw'one of [uptoken, uptoken_url, uptoken_func] settings in options is required!';}logger.debug("init uploader start");logger.debug("environment: ",mOxie.Env);logger.debug("userAgent: ",navigator.userAgent);var option={};var _Error_Handler=op.init&&op.init.Error;var _FileUploaded_Handler=op.init&&op.init.FileUploaded;op.init.Error=function(){};op.init.FileUploaded=function(){};that.uptoken_url=op.uptoken_url;that.token='';that.key_handler=typeof op.init.Key==='function'?op.init.Key:'';this.domain=op.domain;var ctx='';var speedCalInfo={isResumeUpload:false,resumeFilesize:0,startTime:'',currentTime:''};reset_chunk_size();logger.debug("invoke reset_chunk_size()");logger.debug("op.chunk_size: ",op.chunk_size);var defaultSetting={url:qiniuUploadUrl,multipart_params:{token:''}};var ie=that.detectIEVersion();if(ie&&ie<=9){defaultSetting.multipart_params.accept='text/plain; charset=utf-8';logger.debug("add accept text/plain in multipart params")}plupload.extend(option,op,defaultSetting);logger.debug("option: ",option);var uploader=new plupload.Uploader(option);logger.debug("new plupload.Uploader(option)");uploader.bind('Init',function(up,params){logger.debug("Init event activated");if(!op.get_new_uptoken){getNewUpToken(null)}});logger.debug("bind Init event");uploader.bind('FilesAdded',function(up,files){logger.debug("FilesAdded event activated");var auto_start=up.getOption&&up.getOption('auto_start');auto_start=auto_start||(up.settings&&up.settings.auto_start);logger.debug("auto_start: ",auto_start);logger.debug("files: ",files);var is_ios=function(){if(mOxie.Env.OS.toLowerCase()==="ios"){return true}else{return false}};if(is_ios()){for(var i=0;i<files.length;i++){var file=files[i];var ext=that.getFileExtension(file.name);file.name=file.id+"."+ext}}if(auto_start){setTimeout(function(){up.start();logger.debug("invoke up.start()")},0)}up.refresh()});logger.debug("bind FilesAdded event");uploader.bind('BeforeUpload',function(up,file){logger.debug("BeforeUpload event activated");file.speed=file.speed||0;ctx='';if(op.get_new_uptoken){getNewUpToken(file)}var directUpload=function(up,file,func){speedCalInfo.startTime=new Date().getTime();var multipart_params_obj;if(op.save_key){multipart_params_obj={'token':that.token}}else{multipart_params_obj={'key':getFileKey(up,file,func),'token':that.token}}var ie=that.detectIEVersion();if(ie&&ie<=9){multipart_params_obj.accept='text/plain; charset=utf-8';logger.debug("add accept text/plain in multipart params")}logger.debug("directUpload multipart_params_obj: ",multipart_params_obj);var x_vars=op.x_vars;if(x_vars!==undefined&&typeof x_vars==='object'){for(var x_key in x_vars){if(x_vars.hasOwnProperty(x_key)){if(typeof x_vars[x_key]==='function'){multipart_params_obj['x:'+x_key]=x_vars[x_key](up,file)}else if(typeof x_vars[x_key]!=='object'){multipart_params_obj['x:'+x_key]=x_vars[x_key]}}}}up.setOption({'url':qiniuUploadUrl,'multipart':true,'chunk_size':is_android_weixin_or_qq()?op.max_file_size:undefined,'multipart_params':multipart_params_obj})};var is_android_weixin_or_qq=function(){var ua=navigator.userAgent.toLowerCase();if((ua.match(/MicroMessenger/i)||mOxie.Env.browser==="QQBrowser"||ua.match(/V1_AND_SQ/i))&&mOxie.Env.OS.toLowerCase()==="android"){return true}else{return false}};var chunk_size=up.getOption&&up.getOption('chunk_size');chunk_size=chunk_size||(up.settings&&up.settings.chunk_size);logger.debug("uploader.runtime: ",uploader.runtime);logger.debug("chunk_size: ",chunk_size);if((uploader.runtime==='html5'||uploader.runtime==='flash')&&chunk_size){if(file.size<chunk_size||is_android_weixin_or_qq()){logger.debug("directUpload because file.size < chunk_size || is_android_weixin_or_qq()");directUpload(up,file,that.key_handler)}else{var localFileInfo=localStorage.getItem(file.name);var blockSize=chunk_size;if(localFileInfo){localFileInfo=that.parseJSON(localFileInfo);var now=(new Date()).getTime();var before=localFileInfo.time||0;var aDay=24*60*60*1000;if(now-before<aDay){if(localFileInfo.percent!==100){if(file.size===localFileInfo.total){file.percent=localFileInfo.percent;file.loaded=localFileInfo.offset;ctx=localFileInfo.ctx;speedCalInfo.isResumeUpload=true;speedCalInfo.resumeFilesize=localFileInfo.offset;if(localFileInfo.offset+blockSize>file.size){blockSize=file.size-localFileInfo.offset}}else{localStorage.removeItem(file.name)}}else{localStorage.removeItem(file.name)}}else{localStorage.removeItem(file.name)}}speedCalInfo.startTime=new Date().getTime();var multipart_params_obj={};var ie=that.detectIEVersion();if(ie&&ie<=9){multipart_params_obj.accept='text/plain; charset=utf-8';logger.debug("add accept text/plain in multipart params")}up.setOption({'url':qiniuUploadUrl+'/mkblk/'+blockSize,'multipart':false,'chunk_size':chunk_size,'required_features':"chunks",'headers':{'Authorization':'UpToken '+getUptoken(file)},'multipart_params':multipart_params_obj})}}else{logger.debug("directUpload because uploader.runtime !== 'html5' || uploader.runtime !== 'flash' || !chunk_size");directUpload(up,file,that.key_handler)}});logger.debug("bind BeforeUpload event");uploader.bind('UploadProgress',function(up,file){logger.trace("UploadProgress event activated");speedCalInfo.currentTime=new Date().getTime();var timeUsed=speedCalInfo.currentTime-speedCalInfo.startTime;var fileUploaded=file.loaded||0;if(speedCalInfo.isResumeUpload){fileUploaded=file.loaded-speedCalInfo.resumeFilesize}file.speed=(fileUploaded/timeUsed*1000).toFixed(0)||0});logger.debug("bind UploadProgress event");uploader.bind('ChunkUploaded',function(up,file,info){logger.debug("ChunkUploaded event activated");logger.debug("file: ",file);logger.debug("info: ",info);var res=that.parseJSON(info.response);logger.debug("res: ",res);ctx=ctx?ctx+','+res.ctx:res.ctx;var leftSize=info.total-info.offset;var chunk_size=up.getOption&&up.getOption('chunk_size');chunk_size=chunk_size||(up.settings&&up.settings.chunk_size);if(leftSize<chunk_size){up.setOption({'url':qiniuUploadUrl+'/mkblk/'+leftSize});logger.debug("up.setOption url: ",qiniuUploadUrl+'/mkblk/'+leftSize)}up.setOption({'headers':{'Authorization':'UpToken '+getUptoken(file)}});localStorage.setItem(file.name,that.stringifyJSON({ctx:ctx,percent:file.percent,total:info.total,offset:info.offset,time:(new Date()).getTime()}))});logger.debug("bind ChunkUploaded event");var retries=qiniuUploadUrls.length;var unknow_error_retry=function(file){if(retries-->0){setTimeout(function(){that.resetUploadUrl();file.status=plupload.QUEUED;uploader.stop();uploader.start()},0);return true}else{retries=qiniuUploadUrls.length;return false}};uploader.bind('Error',(function(_Error_Handler){return function(up,err){logger.error("Error event activated");logger.error("err: ",err);var errTip='';var file=err.file;if(file){switch(err.code){case plupload.FAILED:errTip='上传失败。请稍后再试。';break;case plupload.FILE_SIZE_ERROR:var max_file_size=up.getOption&&up.getOption('max_file_size');max_file_size=max_file_size||(up.settings&&up.settings.max_file_size);errTip='浏览器最大可上传'+max_file_size+'。更大文件请使用命令行工具。';break;case plupload.FILE_EXTENSION_ERROR:errTip='文件验证失败。请稍后重试。';break;case plupload.HTTP_ERROR:if(err.response===''){errTip=err.message||'未知网络错误。';if(!unknow_error_retry(file)){return}break}var errorObj=that.parseJSON(err.response);var errorText=errorObj.error;switch(err.status){case 400:errTip="请求报文格式错误。";break;case 401:errTip="客户端认证授权失败。请重试或提交反馈。";break;case 405:errTip="客户端请求错误。请重试或提交反馈。";break;case 579:errTip="资源上传成功，但回调失败。";break;case 599:errTip="网络连接异常。请重试或提交反馈。";if(!unknow_error_retry(file)){return}break;case 614:errTip="文件已存在。";try{errorObj=that.parseJSON(errorObj.error);errorText=errorObj.error||'file exists'}catch(e){errorText=errorObj.error||'file exists'}break;case 631:errTip="指定空间不存在。";break;case 701:errTip="上传数据块校验出错。请重试或提交反馈。";break;default:errTip="未知错误。";if(!unknow_error_retry(file)){return}break}errTip=errTip+'('+err.status+'：'+errorText+')';break;case plupload.SECURITY_ERROR:errTip='安全配置错误。请联系网站管理员。';break;case plupload.GENERIC_ERROR:errTip='上传失败。请稍后再试。';break;case plupload.IO_ERROR:errTip='上传失败。请稍后再试。';break;case plupload.INIT_ERROR:errTip='网站配置错误。请联系网站管理员。';uploader.destroy();break;default:errTip=err.message+err.details;if(!unknow_error_retry(file)){return}break}if(_Error_Handler){_Error_Handler(up,err,errTip)}}up.refresh()}})(_Error_Handler));logger.debug("bind Error event");uploader.bind('FileUploaded',(function(_FileUploaded_Handler){return function(up,file,info){logger.debug("FileUploaded event activated");logger.debug("file: ",file);logger.debug("info: ",info);var last_step=function(up,file,info){if(op.downtoken_url){var ajax_downtoken=that.createAjax();ajax_downtoken.open('POST',op.downtoken_url,true);ajax_downtoken.setRequestHeader('Content-type','application/x-www-form-urlencoded');ajax_downtoken.onreadystatechange=function(){if(ajax_downtoken.readyState===4){if(ajax_downtoken.status===200){var res_downtoken;try{res_downtoken=that.parseJSON(ajax_downtoken.responseText)}catch(e){throw('invalid json format');}var info_extended={};plupload.extend(info_extended,that.parseJSON(info),res_downtoken);if(_FileUploaded_Handler){_FileUploaded_Handler(up,file,that.stringifyJSON(info_extended))}}else{uploader.trigger('Error',{status:ajax_downtoken.status,response:ajax_downtoken.responseText,file:file,code:plupload.HTTP_ERROR})}}};ajax_downtoken.send('key='+that.parseJSON(info).key+'&domain='+op.domain)}else if(_FileUploaded_Handler){_FileUploaded_Handler(up,file,info)}};var res=that.parseJSON(info.response);ctx=ctx?ctx:res.ctx;logger.debug("ctx: ",ctx);if(ctx){var key='';logger.debug("save_key: ",op.save_key);if(!op.save_key){key=getFileKey(up,file,that.key_handler);key=key?'/key/'+that.URLSafeBase64Encode(key):''}var fname='/fname/'+that.URLSafeBase64Encode(file.name);logger.debug("op.x_vars: ",op.x_vars);var x_vars=op.x_vars,x_val='',x_vars_url='';if(x_vars!==undefined&&typeof x_vars==='object'){for(var x_key in x_vars){if(x_vars.hasOwnProperty(x_key)){if(typeof x_vars[x_key]==='function'){x_val=that.URLSafeBase64Encode(x_vars[x_key](up,file))}else if(typeof x_vars[x_key]!=='object'){x_val=that.URLSafeBase64Encode(x_vars[x_key])}x_vars_url+='/x:'+x_key+'/'+x_val}}}var url=qiniuUploadUrl+'/mkfile/'+file.size+key+fname+x_vars_url;var ie=that.detectIEVersion();var ajax;if(ie&&ie<=9){ajax=new mOxie.XMLHttpRequest();mOxie.Env.swf_url=op.flash_swf_url}else{ajax=that.createAjax()}ajax.open('POST',url,true);ajax.setRequestHeader('Content-Type','text/plain;charset=UTF-8');ajax.setRequestHeader('Authorization','UpToken '+that.token);var onreadystatechange=function(){logger.debug("ajax.readyState: ",ajax.readyState);if(ajax.readyState===4){localStorage.removeItem(file.name);var info;if(ajax.status===200){info=ajax.responseText;logger.debug("mkfile is success: ",info);last_step(up,file,info)}else{info={status:ajax.status,response:ajax.responseText,file:file,code:-200};logger.debug("mkfile is error: ",info);uploader.trigger('Error',info)}}};if(ie&&ie<=9){ajax.bind('readystatechange',onreadystatechange)}else{ajax.onreadystatechange=onreadystatechange}ajax.send(ctx);logger.debug("mkfile: ",url)}else{last_step(up,file,info.response)}}})(_FileUploaded_Handler));logger.debug("bind FileUploaded event");uploader.init();logger.debug("invoke uploader.init()");logger.debug("init uploader end");return uploader};this.getUrl=function(key){if(!key){return false}key=encodeURI(key);var domain=this.domain;if(domain.slice(domain.length-1)!=='/'){domain=domain+'/'}return domain+key};this.imageView2=function(op,key){var mode=op.mode||'',w=op.w||'',h=op.h||'',q=op.q||'',format=op.format||'';if(!mode){return false}if(!w&&!h){return false}var imageUrl='imageView2/'+mode;imageUrl+=w?'/w/'+w:'';imageUrl+=h?'/h/'+h:'';imageUrl+=q?'/q/'+q:'';imageUrl+=format?'/format/'+format:'';if(key){imageUrl=this.getUrl(key)+'?'+imageUrl}return imageUrl};this.imageMogr2=function(op,key){var auto_orient=op['auto-orient']||'',thumbnail=op.thumbnail||'',strip=op.strip||'',gravity=op.gravity||'',crop=op.crop||'',quality=op.quality||'',rotate=op.rotate||'',format=op.format||'',blur=op.blur||'';var imageUrl='imageMogr2';imageUrl+=auto_orient?'/auto-orient':'';imageUrl+=thumbnail?'/thumbnail/'+thumbnail:'';imageUrl+=strip?'/strip':'';imageUrl+=gravity?'/gravity/'+gravity:'';imageUrl+=quality?'/quality/'+quality:'';imageUrl+=crop?'/crop/'+crop:'';imageUrl+=rotate?'/rotate/'+rotate:'';imageUrl+=format?'/format/'+format:'';imageUrl+=blur?'/blur/'+blur:'';if(key){imageUrl=this.getUrl(key)+'?'+imageUrl}return imageUrl};this.watermark=function(op,key){var mode=op.mode;if(!mode){return false}var imageUrl='watermark/'+mode;if(mode===1){var image=op.image||'';if(!image){return false}imageUrl+=image?'/image/'+this.URLSafeBase64Encode(image):''}else if(mode===2){var text=op.text?op.text:'',font=op.font?op.font:'',fontsize=op.fontsize?op.fontsize:'',fill=op.fill?op.fill:'';if(!text){return false}imageUrl+=text?'/text/'+this.URLSafeBase64Encode(text):'';imageUrl+=font?'/font/'+this.URLSafeBase64Encode(font):'';imageUrl+=fontsize?'/fontsize/'+fontsize:'';imageUrl+=fill?'/fill/'+this.URLSafeBase64Encode(fill):''}else{return false}var dissolve=op.dissolve||'',gravity=op.gravity||'',dx=op.dx||'',dy=op.dy||'';imageUrl+=dissolve?'/dissolve/'+dissolve:'';imageUrl+=gravity?'/gravity/'+gravity:'';imageUrl+=dx?'/dx/'+dx:'';imageUrl+=dy?'/dy/'+dy:'';if(key){imageUrl=this.getUrl(key)+'?'+imageUrl}return imageUrl};this.imageInfo=function(key){if(!key){return false}var url=this.getUrl(key)+'?imageInfo';var xhr=this.createAjax();var info;var that=this;xhr.open('GET',url,false);xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){info=that.parseJSON(xhr.responseText)}};xhr.send();return info};this.exif=function(key){if(!key){return false}var url=this.getUrl(key)+'?exif';var xhr=this.createAjax();var info;var that=this;xhr.open('GET',url,false);xhr.onreadystatechange=function(){if(xhr.readyState===4&&xhr.status===200){info=that.parseJSON(xhr.responseText)}};xhr.send();return info};this.get=function(type,key){if(!key||!type){return false}if(type==='exif'){return this.exif(key)}else if(type==='imageInfo'){return this.imageInfo(key)}return false};this.pipeline=function(arr,key){var isArray=Object.prototype.toString.call(arr)==='[object Array]';var option,errOp,imageUrl='';if(isArray){for(var i=0,len=arr.length;i<len;i++){option=arr[i];if(!option.fop){return false}switch(option.fop){case'watermark':imageUrl+=this.watermark(option)+'|';break;case'imageView2':imageUrl+=this.imageView2(option)+'|';break;case'imageMogr2':imageUrl+=this.imageMogr2(option)+'|';break;default:errOp=true;break}if(errOp){return false}}if(key){imageUrl=this.getUrl(key)+'?'+imageUrl;var length=imageUrl.length;if(imageUrl.slice(length-1)==='|'){imageUrl=imageUrl.slice(0,length-1)}}return imageUrl}return false}}var Qiniu=new QiniuJsSDK();global.Qiniu=Qiniu;global.QiniuJsSDK=QiniuJsSDK})(window);(function(){!function(){var t,e,a;return t=$("#block-first"),e=t.find("div.form:eq(0)"),a=!1,e.data().allowAddTag=0,e.find("div.r div.switch").on("click",function(){var t;return t=$(this),t.hasClass("active")?(t.removeClass("active"),e.data().allowAddTag=1):(t.addClass("active"),e.data().allowAddTag=0)}),$.require("editor",function(){var i,r,n,s;return $.extend(window.UMEDITOR_CONFIG,{initialFrameHeight:320,autoFloatEnabled:!0,topOffset:46,toolbar:["source | undo redo | emotion image | bold italic underline strikethrough | forecolor backcolor | superscript subscript | removeformat |","insertorderedlist insertunorderedlist | selectall cleardoc | fontfamily fontsize paragraph","| justifyleft justifycenter justifyright justifyjustify |","link unlink ","| horizontal print preview fullscreen","drafts"],funcCtrlEnter:function(){return e.find("a.do").eq(0).click()}}),UM.delEditor("editor-cont-post"),s=$("#style-post-article").html(),i=UM.getEditor("editor-cont-post"),i.miniImagetype="article","msie"===(null!=(n=system.browser)?n.name:void 0)&&setTimeout(function(){return t.append("<style>"+s+"</style>")},50),t.find("span.hint-hover").each(function(){return $(this).hoverInfo({type:"info",text:$(this).attr("title").toString().replace(/[\r\n]+/g,"\n").replace(/\n/g,"<br />"),fadeout:0}).removeAttr("title")}),$("#ipt-channel-post").change(function(){var t;return t=$(this),e.data().channel=t.val()}),$("#btn-preview-post").click(function(){var t,i;return t=$(this),t.hasClass("disabled")?(i="warning::正处于本地图片上传不应期。",$.info(i),t.info(i)):(t.addClass("disabled"),setTimeout(function(){return t.removeClass("disabled")},5e3),t.unfold({src:"member/children/win-upload-preview",id:"win-upload-preview","class":"win-children",title:"上传封面图片",icon:"upload",width:420,height:"auto",start:function(){var t;return t=$("#win-upload-preview"),t.data().callback=function(t,i){return $.info("success::封面图片上传完毕。"),a=!0,$("#img-preview-post").attr({src:i}),e.data().preview=i,e.data().bigCover=t,$$("#curtain").click()}}}))}),r=(new Date).getHours(),e.data().preview=system.path["short"]+"/style/image/cover"+(r>=18||9>r?"-night":"-day")+".png",$("#img-preview-post").attr({src:e.data().preview}).click(function(){return $("#btn-preview-post").click()}),e.setup({callback:function(){var t,n;return $.trim(i.getContentTxt()).length>9?(null!=(t=system.port.post)&&t.abort(),system.port.post=$.post("/member/contributeSave.aspx",{title:$.parseSafe(e.data().title),description:e.data().desc,body:i.getContent(),tags:e.data().tag.replace(/\s/g,","),channelId:e.data().channel||110,allowAddTag:e.data().allowAddTag,titleImg:a?$.parseSafe($("#img-preview-post").attr("src")):system.path.cdn+"/dotnet/20120923/style/image/cover"+(r>=18||9>r?"-night":"-day")+".png"}).done(function(t){var a;return t.success?($(window).off("beforeunload"),a='<p class="alert alert-success"> 您的文章[<a class="title" href="/a/ac'+t.contentId+'" target="_blank">'+$.parseSafe(e.data().title)+"(ac"+t.contentId+')</a>]已经发布成功。<br /> 经过管理员的审核后，您的文章便会出现于[<a href="/v/list'+$("#ipt-channel-post").val()+'/index.htm" target="_blank">'+$.parseChannel(parseInt($("#ipt-channel-post").val()))+'</a>]频道的列表中。请稍事等待。<br /> 衷心感谢您对acfun.cn的关注与支持。 </p> <p class="divider"></p> <div class="unit-tool"> <div class="l"> <a class="btn primary" onclick="m.refreshPart();"> <i class="icon icon-repeat"></i>继续投稿 </a> <a class="btn primary" href="page/post-history.jsp"> <i class="icon icon-list"></i>返回稿件列表 </a> </div> <div class="r"> <a class="btn info" href="/feedback.aspx#from=/member/index.aspx" target="_blank"> <i class="icon icon-arrow-circle-right"></i>意见反馈 </a> </div> <span class="clearfix"></span> </div>',e.html(a)):$.info("error::"+t.result)}).fail(function(){return $.info("error::文章发布失败。请于稍后重试。")})):(n="warning::文章正文长度应在10到65535个字符之间。",$.info(n),$("#editor-cont-post").info({direction:"top",text:n}),i.focus())}})})}()}).call(this);</script>
						</div>
					</div>
					<span class="clearfix"></span>
				</div>
			</div>
		</div>
		<span class="clearfix"></span>
		<div id="footer">
			<div id="footer-inner">
				<div class="top-footer">
					<div class="l">
						<div class="unit unit-0">
							<div class="a">合作</div>
							<div class="b">
								<a id="" target="_blank"
									href="http://www.acfun.cn/info/#page=about" class="a-0">关于我们</a><a
									id="" target="_blank"
									href="http://www.acfun.cn/info/#page=contact" class="a-1">联系我们</a><a
									id="" target="_blank"
									href="http://www.acfun.cn/info/#page=joinus" class="a-2">AC招聘</a><span
									class="clearfix"></span>
							</div>
						</div>
						<div class="unit unit-1">
							<div class="a">官方</div>
							<div class="b">
								<a id="" target="_blank" href="http://weibo.com/danmushipin/"
									class="a-0">新浪微博</a><a id="" target="_blank"
									href="http://tb.am/cbaz8" class="a-1">官方网店</a><a id=""
									target="_blank" href="javascript:void(0);" class="a-2">微信公众号</a><span
									class="clearfix"></span>
							</div>
						</div>
						<div class="unit unit-2">
							<div class="a">下载</div>
							<div class="b">
								<a id="app-footer-link" target="_blank"
									href="http://www.acfun.cn/app/">移动客户端<span
									class="bg-new-app"></span></a><a id="" target="_blank"
									href="http://www.acfun.cn/emot/" class="a-1">AC娘表情包</a><span
									class="clearfix"></span>
							</div>
						</div>
						<div class="unit unit-3">
							<div class="a">友情链接</div>
							<div class="b">
								<a id="" target="_blank" href="http://www.douyu.tv/" class="a-0">斗鱼直播</a><a
									id="" target="_blank" href="http://h.nimingban.com/"
									class="a-1">匿名版</a><a id="" target="_blank"
									href="http://lg.dianbo.me/index.php" class="a-2">AC大逃杀</a><span
									class="clearfix"></span>
							</div>
						</div>
						<div class="unit unit-4">
							<div class="a">反馈</div>
							<div class="b">
								<a id="" target="_blank" href="http://www.acfun.cn/feedback/"
									class="a-0">意见反馈</a><a id="" target="_blank"
									href="http://www.acfun.cn/report/" class="a-1">举报</a><a id=""
									target="_blank" href="http://www.acfun.cn/about/help/"
									class="a-2">帮助中心</a><a id="" target="_blank"
									href="http://www.acfun.cn/info/#page=disclaimer" class="a-3">免责声明</a><a
									id="" target="_blank"
									href="http://www.acfun.cn/info/#page=agreement" class="a-4">用户协议</a><span
									class="clearfix"></span>
							</div>
						</div>
						<span class="clearfix"></span>
						<div class="arrow-right"></div>
						<div class="erweima">
							<div class="arrow-top"></div>
							<img src="img/erweima.jpg" height="140px" width="140px">
						</div>
					</div>
					<div class="r">
						<div id="avatar-ac-footer" class="">
							<img src="img/20.gif">
						</div>
					</div>
					<span class="clearfix"></span>
				</div>
				<div class="bottom-footer">
					<ul id="explain">
						<li><p class="report">
								<span class="reportImg"></span><a href="http://www.12377.cn/"
									target="_blank">中国互联网举报中心</a>
							</p>
							<p class="inter">
								<span class="reportImg"></span><span>网络文化经营单位</span>
							</p></li>
						<li><p>
								<span>京ICP备15067359号</span>
							</p>
							<p>
								<a href="http://www.bjjubao.org/" target="_blank">北京互联网举报中心</a>
							</p>
							<p>
								<a href="http://www.bjwhzf.gov.cn/accuse.do" target="_blank">北京12318文化市场举报热线</a>
							</p></li>
						<li><p>
								<span>节目制作经营许可证（京）字第05158号</span>
							</p>
							<p>
								<a href="http://www.bj.cyberpolice.cn/index.jsp" target="_blank">网络110报警服务</a>
							</p></li>
						<li><p>
								<a href="http://www.miitbeian.gov.cn/" target="_blank">
									京ICP证161323号</a>
							</p>
							<p>
								<a href="http://www.acfun.cn/about/qualification"
									target="_blank">京网文[2016]0948-099号</a>
							</p>
							<p class="hidden">
								<a target="_blank" key="58807ce2efbfb0190275685d"
									logo_size="83x30" logo_type="business"
									href="http://v.pinpaibao.com.cn/authenticate/cert/?site=www.acfun.cn&amp;at=business"><script
										src="css/aq_auth.js"></script><b id="aqLogoXJROC"
									style="display: none;"></b><img style="border: none;"
									alt="安全联盟认证" src="css/hy_83x30.png" height="30" width="83"></a>
							</p></li>
						<div style="clear: both"></div>
					</ul>
					<a id="a-logo-footer" href="http://www.acfun.cn/"></a>
					<p>本站不提供任何视听上传服务，所有内容均来自视频分享站点所提供的公开引用资源。Copyright © 2007-2017
						AcFun. 保留所有权利</p>
					<p id="hint-time-released" data-time="2017.2.13 11:26:13"
						class="hidden">Released at 2017.2.13 11:26:13.</p>
				</div>
			</div>
		</div>
	</div>

	<script>(function () {
    var updateTime = +new Date(2015, 6, 21);
    if ($.now() - updateTime < 5 * 24 * 60 * 60 * 1000) {
        $('#app-footer-link .bg-new-app').addClass('new');
    }
})();</script>
	<script type="text/javascript" src="js/jquery-1.12.4.js"></script>
	<script type="text/javascript" src="js/click.js"></script>
	<script type="text/javascript" src="js/userinfo.js"></script>
	<script type="text/javascript" src="js/post-article.js"></script>
</body>
</html>