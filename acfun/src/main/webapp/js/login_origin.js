(function(){$(function(){return $.require("ready",function(){var i,n,t,a,r,e;return i=$$("#area-login"),r=$$("#form-login"),n=r.find("a.btn-login"),e=window.Worker?["ease-in","ease-out"]:["linear","linear"],a=0|$.cookie("ac_login_error")||0,a>3?($$("#form-login div.area-captcha").removeClass("hidden"),$$("#ipt-captcha-login").attr({disabled:!1}),t=!0,$$("#ipt-captcha-switch").click(function(){return $(this).prev().click()})):t=!1,r.setup({finish:function(){return $$("#ipt-captcha-login").val(""),$$("#ipt-pwd-login").on("keydown",function(i){return 13!==i.which&&10!==i.which||t?void 0:$("#form-login a.btn.do").click()})},callback:function(){var o,c;if(t){if(o=$.trim(r.data().captcha),!o.length)return void $$("#ipt-captcha-login").info({text:"warning::请输入验证码。",direction:"bottom"}).focus()}else o=void 0;return $.info("info::登录中..."),null!=(c=system.port.login)&&c.abort(),system.port.login=$.post("/login.aspx",{username:$.trim(r.data().name),password:$.trim(r.data().password),captcha:o}).done(function(r){var o,c,s;return r.success?($.info("success::登录成功。"),$.user("clear"),$.preload(r.img,function(){return i.find("div.area-login a.thumb img.avatar").css({opacity:0}).attr({src:r.img}).transition({opacity:1},300)}),o=location.host.split("."),$.cookie("ac_userimg",r.img,{path:"/",expires:30,domain:"."+o[1]+"."+o[2]}),i.find("p.welcom span.username").text(r.username),c=$("#area-login .r .area-login"),c.transition({opacity:0,rotateY:180},700,e[0],function(){var n,t,a;return i.find("div.area-login").addClass("login-success"),c.transition({opacity:1,rotateY:360},700,e[1]),t=i.find("p.notice span"),n=3,system.timer.login=setInterval(function(){return n--,t.text(n),0>=n?clearInterval(system.timer.login):void 0},1e3),a=system.param.returnUrl||system.hash.returnUrl||"/",setTimeout(function(){return location.href=$.parseSafe(a)},2e3)})):(t&&$$("#form-login div.area-captcha img.captcha-pic").click(),a++,$.cookie("ac_login_error",a,{expires:1}),(a>3||-1!==r.result.search("captcha"))&&($$("#form-login div.area-captcha").removeClass("hidden"),$$("#ipt-captcha-login").attr({disabled:!1}),t||setTimeout(function(){return location.reload()},1e3),t=!0),-1!==r.result.search("captcha")?(3>=a&&(a=4,$.cookie("ac_login_error",a,{expires:1})),$.info(s="warning::请输入验证码。"),$$("#ipt-captcha-login").info(s)):($.info(s="warning::"+r.result),n.info(s)))}).fail(function(){var i;return $.info(i="error::通信失败。请稍后重试。"),n.info(i)})}})})})}).call(this);